var nt=Object.defineProperty,at=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var Oe=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var ye=(i,t,e)=>t in i?nt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,F=(i,t)=>{for(var e in t||(t={}))ot.call(t,e)&&ye(i,e,t[e]);if(Oe)for(var e of Oe(t))ht.call(t,e)&&ye(i,e,t[e]);return i},ce=(i,t)=>at(i,rt(t));var f=(i,t,e)=>(ye(i,typeof t!="symbol"?t+"":t,e),e),$e=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var Ee=(i,t,e)=>($e(i,t,"read from private field"),e?e.call(i):t.get(i)),W=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},ee=(i,t,e,s)=>($e(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);var C=(i,t,e)=>($e(i,t,"access private method"),e);import{v as xe,t as Me,S as b,i as j,s as X,e as M,a as U,b as S,c as q,d as A,f as m,g as te,n as se,h as z,j as O,m as R,k as H,l as D,o as I,p as lt,w as ct,q as ut,r as ge,u as G,x as Ne,y as Be,z as Ge,A as Re,B as Pe,R as gt,C as ue}from"./vendor.34d41056.js";const ft=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}};ft();var B;(function(i){i.LightKing="\u2654",i.LightQueen="\u2655",i.LightRook="\u2656",i.LightBishop="\u2657",i.LightKnight="\u2658",i.LightPawn="\u2659",i.DarkKing="\u265A",i.DarkQueen="\u265B",i.DarkRook="\u265C",i.DarkBishop="\u265D",i.DarkKnight="\u265E",i.DarkPawn="\u265F"})(B||(B={}));function We(i,t){var s;const e=this.shade==="dark"?i.lightKing:i.darkKing;if(e){let n=!1;for(const a of t)if(((s=a.piece)==null?void 0:s.uuid)===e.uuid){n=!0;break}n&&(this.pathToEnemyKing=t)}return t}var d;(function(i){i[i.NORTH=0]="NORTH",i[i.NE=1]="NE",i[i.EAST=2]="EAST",i[i.SE=3]="SE",i[i.SOUTH=4]="SOUTH",i[i.SW=5]="SW",i[i.WEST=6]="WEST",i[i.NW=7]="NW"})(d||(d={}));function Fe(i){switch(i){case d.NORTH:return{rank:1,file:0};case d.NE:return{rank:1,file:1};case d.EAST:return{rank:0,file:1};case d.SE:return{rank:-1,file:1};case d.SOUTH:return{rank:-1,file:0};case d.SW:return{rank:-1,file:-1};case d.WEST:return{rank:0,file:-1};case d.NW:return{rank:1,file:-1}}}function Qe(i,t){return be(this,i,t)}function Ue(i,t){return be(this,i,t)}function be(i,t,e){var r,o;const s=[],n=Fe(t);let a=e.getSquare((r=i.pos)==null?void 0:r.rank,(o=i.pos)==null?void 0:o.file);for(;a&&(a=e.getSquare(a.pos.rank+n.rank,a.pos.file+n.file));)s.push(a);return s}class je{constructor(t,e){f(this,"piece",null);f(this,"shade");f(this,"pos");f(this,"chessPosition");this.shade=t,this.pos=e,this.chessPosition=this.getChessPosition()}getChessPosition(){const e=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:e}}}var ne,fe,Xe;class Y{constructor(t,e,s,n,a){W(this,fe);f(this,"type");f(this,"shade");f(this,"pos");f(this,"unicodeChar");f(this,"fenChar");f(this,"defaultMoves",[]);f(this,"legalMoves",[]);f(this,"coverage",[]);f(this,"threatens",new Set);f(this,"threatenedBy",new Set);f(this,"protects",new Set);f(this,"protectedBy",new Set);f(this,"uuid",xe());f(this,"myKingIsUnderCheck",!1);W(this,ne,[]);f(this,"timesMoved",0);f(this,"canBeEaten",!0);this.type=t,this.shade=e,this.pos=n;const{unicode:r,fenChar:o}=C(this,fe,Xe).call(this);this.unicodeChar=r,this.fenChar=o,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=a||[]}get initialSquares(){return Ee(this,ne)}set initialSquares(t){ee(this,ne,t)}getDefaultMoves(t){return[]}getLegalMoves(t){return[]}getCoverageMoves(t){return this.legalMoves}moveConditions(t){return!1}isMoveLegal(t){return this.legalMoves.includes(t)}threaten(){this.coverage.forEach(t=>{t.piece&&t.piece.shade!==this.shade&&(this.threatens.add(t.piece),t.piece.threatenedBy.add(this))})}doIIntersect(){const t=this.threatenedBy;for(const e of t)if(e.type==="Bishop"||e.type==="Queen"||e.type==="Rook"){const s=e;for(const n of s.pathToEnemyKing)if(n.piece===this)return!0}return!1}findMovesToProtectKing(t){const e=this.shade==="dark"?t.darkKing:t.lightKing;if(e&&e.threatenedBy.size<=1)for(const s of e.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(n=>{var a;return s.pathToEnemyKing.includes(n)||n.pos.rank===((a=s.pos)==null?void 0:a.rank)&&n.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(n=>{var a;return n.pos.rank===((a=s.pos)==null?void 0:a.rank)&&n.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(t,e,s){if(t instanceof je){let n=!1;return t.piece?(n=!1,t.piece.shade!==this.shade?n=!0:(n=!1,this.protects.add(t.piece),t.piece.protectedBy.add(this))):n=!0,s&&(n=s()),n}else{const n=[];for(const a of t)if(!a.piece)n.push(a);else if(a.piece.shade!==this.shade){n.push(a);break}else{this.protects.add(a.piece),a.piece.protectedBy.add(this);break}return n}}move(t,e){var u,g,h,c,l,p,y,E,P,$,v,T,K,N,k,J;let s=`${this.type==="Pawn"?"":this.fenChar.toUpperCase()}`;const n=this.shade==="dark"?-1:1,a=e.getSquare(t.rank,t.file);if(!a)return!1;const r=a==null?void 0:a.piece;if(a&&!this.isMoveLegal(a)||r&&!(r!=null&&r.canBeEaten))return!1;if(this.pos&&e.setPiece(null,this.pos.rank,this.pos.file),r&&r.canBeEaten){const L=e.getPiece(t.rank,t.file);e.pieces=e.pieces.filter(x=>x!==L),e.setPiece(null,t.rank,t.file),s+=`x${a.chessPosition.file.toLowerCase()}${a.chessPosition.rank}`}else if(this.type==="Pawn"){const L=this;if(((g=(u=L.canTakeEnPassant)==null?void 0:u.pos)==null?void 0:g.file)===t.file&&L.canTakeEnPassant.pos.rank===t.rank-n){const x=e.getSquare((h=L.pos)==null?void 0:h.rank,(c=L.pos)==null?void 0:c.file);e.setPiece(null,L.canTakeEnPassant.pos.rank,L.canTakeEnPassant.pos.file),e.pieces=e.pieces.filter(w=>w!==L.canTakeEnPassant),L.canTakeEnPassant=null,L.timesEnPassant=L.timesEnPassant+1,s=`${x==null?void 0:x.chessPosition.file.toLowerCase()}x${a.chessPosition.file.toLowerCase()}${a.chessPosition.rank} e.p`}else s=`${a.chessPosition.file.toLowerCase()}${a.chessPosition.rank}`}else if(this.type==="King"&&this.timesMoved===0){const L=this.legalMoves.find(w=>{var V,Z;return w.pos.file===((V=this.pos)==null?void 0:V.file)+2&&w.pos.rank===((Z=this.pos)==null?void 0:Z.rank)}),x=this.legalMoves.find(w=>{var V,Z;return w.pos.file===((V=this.pos)==null?void 0:V.file)-2&&w.pos.rank===((Z=this.pos)==null?void 0:Z.rank)});if(L||x){if(L){const w=e.getPiece((l=this.pos)==null?void 0:l.rank,((p=this.pos)==null?void 0:p.file)+3);w&&(e.setPiece(null,(y=w.pos)==null?void 0:y.rank,(E=w.pos)==null?void 0:E.file),e.setPiece(w,(P=this.pos)==null?void 0:P.rank,(($=this.pos)==null?void 0:$.file)+1),s="O-O")}if(x){const w=e.getPiece((v=this.pos)==null?void 0:v.rank,((T=this.pos)==null?void 0:T.file)-4);w&&(e.setPiece(null,(K=w.pos)==null?void 0:K.rank,(N=w.pos)==null?void 0:N.file),e.setPiece(w,(k=this.pos)==null?void 0:k.rank,((J=this.pos)==null?void 0:J.file)-1),s="O-O-O")}}else s+=`${a.chessPosition.file.toLowerCase()}${a.chessPosition.rank}`}else s+=`${a.chessPosition.file.toLowerCase()}${a.chessPosition.rank}`;e.setPiece(this,t.rank,t.file),this.timesMoved++;let o=e.pieceHistory.get(this.uuid);return e.pieceHistory.set(this.uuid,o+1),e.totalMoves++,e.history.push({uuid:this.uuid,an:s}),!0}}ne=new WeakMap,fe=new WeakSet,Xe=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:B.DarkKing,fenChar:"k"};case"Queen":return{unicode:B.DarkQueen,fenChar:"q"};case"Rook":return{unicode:B.DarkRook,fenChar:"r"};case"Bishop":return{unicode:B.DarkBishop,fenChar:"b"};case"Knight":return{unicode:B.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:B.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:B.LightKing,fenChar:"K"};case"Queen":return{unicode:B.LightQueen,fenChar:"Q"};case"Rook":return{unicode:B.LightRook,fenChar:"R"};case"Bishop":return{unicode:B.LightBishop,fenChar:"B"};case"Knight":return{unicode:B.LightKnight,fenChar:"N"};case"Pawn":return{unicode:B.LightPawn,fenChar:"P"}}}};class Ye extends Y{constructor(e,s,n){const a=e==="dark"?7:0;super("Rook",e,s,n,[{rank:a,file:0},{rank:a,file:7}]);f(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}straightMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(d.NORTH,e))),n=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(d.EAST,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(d.SOUTH,e))),r=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(d.WEST,e)));return[...s,...n,...a,...r]}getDefaultMoves(e){const s=this.straightMove(d.NORTH,e),n=this.straightMove(d.EAST,e),a=this.straightMove(d.SOUTH,e),r=this.straightMove(d.WEST,e);return[...s,...n,...a,...r]}}Object.assign(Ye.prototype,{straightMove:Ue,getPathToEnemyKing:We});class Je extends Y{constructor(e,s,n){const a=e==="dark"?7:0;super("Bishop",e,s,n,[{rank:a,file:2},{rank:a,file:5}]);f(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}diagonalMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(d.NE,e))),n=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(d.SE,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(d.SW,e))),r=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(d.NW,e)));return[...s,...n,...a,...r]}getDefaultMoves(e){const s=this.diagonalMove(d.NE,e),n=this.diagonalMove(d.SE,e),a=this.diagonalMove(d.SW,e),r=this.diagonalMove(d.NW,e);return[...s,...n,...a,...r]}}Object.assign(Je.prototype,{diagonalMove:Qe,getPathToEnemyKing:We});var pe,Ve,de,Ze,me,et,ve,tt;class He extends Y{constructor(e,s,n){super("King",e,s,n,[{rank:e==="dark"?7:0,file:4}]);W(this,pe);W(this,de);W(this,me);W(this,ve);this.canBeEaten=!1}getLegalMoves(e){const s=this.shade==="dark"?e.lightCoverage:e.darkCoverage,n=[];return this.defaultMoves.forEach(a=>{this.checkMoveLegality(a)&&!s.has(a)&&!C(this,pe,Ve).call(this,a.piece)&&!C(this,de,Ze).call(this,a)&&(C(this,ve,tt).call(this,a)?C(this,me,et).call(this,a)&&n.push(a):n.push(a))}),n}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var a,r,o,u,g,h,c,l,p,y,E,P,$,v;const s=[],n=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let T=0;T<8;T++){const K=Fe(d[n[T]]),N=e.getSquare(((a=this.pos)==null?void 0:a.rank)+K.rank,((r=this.pos)==null?void 0:r.file)+K.file);N&&s.push(N)}if(this.timesMoved===0){const T=e.getPiece((o=this.pos)==null?void 0:o.rank,((u=this.pos)==null?void 0:u.file)+3),K=e.getPiece((g=this.pos)==null?void 0:g.rank,((h=this.pos)==null?void 0:h.file)-4);if(T&&T.type==="Rook"&&T.shade===this.shade){let N=!0;for(let k=1;k<3;k++)if(e.getPiece((c=this.pos)==null?void 0:c.rank,((l=this.pos)==null?void 0:l.file)+k)){N=!1;break}if(N){const k=e.getSquare((p=this.pos)==null?void 0:p.rank,((y=this.pos)==null?void 0:y.file)+2);k&&s.push(k)}}if(K&&K.type==="Rook"&&K.shade===this.shade){let N=!0;for(let k=1;k<4;k++)if(e.getPiece((E=this.pos)==null?void 0:E.rank,((P=this.pos)==null?void 0:P.file)-k)){N=!1;break}if(N){const k=e.getSquare(($=this.pos)==null?void 0:$.rank,((v=this.pos)==null?void 0:v.file)-2);k&&s.push(k)}}}return s}}pe=new WeakSet,Ve=function(e){return e?e.protectedBy.size>0:!1},de=new WeakSet,Ze=function(e){for(const s of this.threatenedBy)if("getPathToEnemyKing"in s)return s.pathToEnemyKing.includes(e);return!1},me=new WeakSet,et=function(e){return this.timesMoved===0&&this.threatenedBy.size===0},ve=new WeakSet,tt=function(e){var s;return e&&e.pos.rank===((s=this.pos)==null?void 0:s.rank)&&(this.pos.file+2===e.pos.file||this.pos.file-2===e.pos.file)};class Se extends Y{constructor(e,s,n){super("Queen",e,s,n,[{rank:e==="dark"?7:0,file:3}]);f(this,"pathToEnemyKing",[])}diagonalMove(e,s){return[]}straightMove(e,s){return[]}getPathToEnemyKing(e,s){return[]}getLegalMoves(e){const s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(d.NORTH,e)),e),n=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(d.EAST,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(d.SOUTH,e)),e),r=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(d.WEST,e)),e),o=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(d.NE,e)),e),u=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(d.SE,e)),e),g=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(d.SW,e)),e),h=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(d.NW,e)),e);return[...s,...o,...n,...u,...a,...g,...r,...h]}getDefaultMoves(e){const s=this.straightMove(d.NORTH,e),n=this.straightMove(d.EAST,e),a=this.straightMove(d.SOUTH,e),r=this.straightMove(d.WEST,e),o=this.diagonalMove(d.NE,e),u=this.diagonalMove(d.SE,e),g=this.diagonalMove(d.SW,e),h=this.diagonalMove(d.NW,e);return[...s,...o,...n,...u,...a,...g,...r,...h]}}Object.assign(Se.prototype,{diagonalMove:Qe,straightMove:Ue,getPathToEnemyKing:We});class pt extends Y{constructor(t,e,s){const n=t==="dark"?7:0,a=[{rank:n,file:1},{rank:n,file:6}];super("Knight",t,e,s,a)}getDefaultMoves(t){const e=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(n=>{const a=t.getSquare(this.pos.rank+n[0],this.pos.file+n[1]);a&&e.push(a)}),e}getLegalMoves(t){const e=this.defaultMoves,s=[];return e.forEach(n=>{n&&this.checkMoveLegality(n)&&s.push(n)}),s}}var ae,_e;const ke=class extends Y{constructor(e,s,n){const a=e==="light"?1:6,o=[0,1,2,3,4,5,6,7].map(u=>({rank:a,file:u}));super("Pawn",e,s,n,o);W(this,ae);f(this,"canTakeEnPassant",null);f(this,"timesEnPassant",0)}getLegalMoves(e){const s=this.defaultMoves,n=[];return s.forEach(a=>{a&&this.checkMoveLegality(a,e,()=>this.moveConditions(a))&&n.push(a)}),n}moveConditions(e){var n,a,r,o,u,g;const s=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-s===((n=this.canTakeEnPassant.pos)==null?void 0:n.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((a=this.pos)==null?void 0:a.rank)+s||e.pos.rank===((r=this.pos)==null?void 0:r.rank)+s*2?e.pos.rank!==((o=this.pos)==null?void 0:o.rank)+s*2&&(e.pos.file===((u=this.pos)==null?void 0:u.file)+s||e.pos.file===((g=this.pos)==null?void 0:g.file)-s)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const s=this.shade==="light"?1:-1;return this.defaultMoves.filter(n=>{var a,r;return!(n.pos.file===((a=this.pos)==null?void 0:a.file)&&(n.pos.rank===((r=this.pos)==null?void 0:r.rank)+s||n.pos.rank===this.pos.rank+s*2))})}getDefaultMoves(e){const s=[];if(this.pos){this.canTakeEnPassant=null;const n=this.shade==="light"?1:-1,a=e.getSquare(this.pos.rank+n,this.pos.file),r=e.getSquare(this.pos.rank+n*2,this.pos.file),o=e.getSquare(this.pos.rank+n,this.pos.file+n),u=e.getSquare(this.pos.rank+n,this.pos.file-n);if(a&&!(a!=null&&a.piece)&&(s.push(a),this.timesMoved===0&&this.initialSquares.find(g=>{var h,c;return g.rank===((h=this.pos)==null?void 0:h.rank)&&g.file===((c=this.pos)==null?void 0:c.file)})&&r&&!(r!=null&&r.piece)&&s.push(r)),o&&s.push(o),u&&s.push(u),this.timesEnPassant===0){const g=e.getSquare(this.pos.rank,this.pos.file+n),h=e.getSquare(this.pos.rank,this.pos.file-n);o&&!o.piece&&g&&g.piece instanceof ke&&C(this,ae,_e).call(this,g.piece,e)&&(s.includes(o)||s.push(o)),u&&!u.piece&&h&&h.piece instanceof ke&&C(this,ae,_e).call(this,h.piece,e)&&(s.includes(u)||s.push(u))}}return s}};let Te=ke;ae=new WeakSet,_e=function(e,s){const n=e.shade==="dark"?-1:1;return e.shade!==this.shade&&e.timesMoved===1&&e.initialSquares[0].rank===e.pos.rank-n*2&&s.history[s.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,console.log(e),!0):!1};var Q,re,we,oe,Ke,he,Ce,le,Le;class dt{constructor(t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){W(this,re);W(this,oe);W(this,he);W(this,le);f(this,"board");W(this,Q,void 0);f(this,"pieces",[]);f(this,"lightKing",null);f(this,"darkKing",null);f(this,"darkCoverage",new Set);f(this,"lightCoverage",new Set);f(this,"pieceHistory",new Map);f(this,"totalMoves",0);f(this,"history",[]);f(this,"game",null);f(this,"strict",!0);this.board=C(this,he,Ce).call(this),ee(this,Q,t)}get fen(){return Ee(this,Q)}set fen(t){this.legalFEN(t)&&(ee(this,Q,t),this.emptyBoard(),this.loadPieces())}legalFEN(t){let e=0,s=0;for(const n of t){const a=parseInt(n);n==="/"?e++:isNaN(a)?s++:s+=a}return e===7&&s===64}emptyBoard(){this.pieces=[],this.board=C(this,he,Ce).call(this)}loadPieces(t){t&&this.legalFEN(t)&&(this.fen=t);let e=this.board.length-1,s=0,n=0,a="";for(;e>=0&&(a=this.fen[n]);){const r=parseInt(a);if(a==="/")e--,s=0;else if(isNaN(r)){let o=null;switch(a){case"K":this.lightKing=o=new He("light",this);break;case"k":this.darkKing=o=new He("dark",this);break;case"Q":case"q":o=new Se(a==="q"?"dark":"light",this);break;case"R":case"r":o=new Ye(a==="r"?"dark":"light",this);break;case"N":case"n":o=new pt(a==="n"?"dark":"light",this);break;case"B":case"b":o=new Je(a==="b"?"dark":"light",this);break;case"P":case"p":o=new Te(a==="p"?"dark":"light",this);break}this.board[e][s].piece=o,o&&(o.pos=this.board[e][s].pos,this.pieces.push(o),this.pieceHistory.set(o.uuid,0)),s++}else s+=r;n++}C(this,re,we).call(this)}getKing(t){return this.pieces.find(s=>s.shade===t&&s.type==="King")||null}generateFEN(){let t="",e=0;return this.forEach((s,n,a)=>{!s||!s.piece?e++:(e>0&&(t+=e,e=0),t+=s.piece.fenChar),a===this.board[n].length-1&&(e>0&&(t+=e,e=0),n!=0&&(t+="/"))}),t}forEach(t){for(let e=this.board.length-1;e>=0;e--)for(let s=0;s<this.board[e].length;s++)t(this.getSquare(e,s),e,s)}setPiece(t,e,s){return C(this,le,Le).call(this,e,s)?(this.board[e][s].piece=t,t&&(t.pos=this.board[e][s].pos),ee(this,Q,this.generateFEN()),!0):!1}getPiece(t,e){const s=this.getSquare(t,e);return s?s.piece:null}getSquare(t,e){return C(this,le,Le).call(this,t,e)?this.board[t][e]:null}movePiece(t,e){var s,n,a,r,o;if(((s=this.game)==null?void 0:s.hasStarted)&&!((n=this.game)!=null&&n.isPaused)&&e){if(this.strict&&this.game&&e.shade!==this.game.currentPlayer.shade)return!1;const u=F({},e.pos),g=e.move(t,this);g&&(this.history.length===1&&this.game.start(),(a=this.game)==null||a.switch());const h=e.shade==="dark"?-1:1;if(e.type==="Pawn"&&t.rank===u.rank+h&&t.rank===(e.shade==="dark"?0:7)){const c=new Se(e.shade,this,e.pos);c.uuid=e.uuid,this.setPiece(c,(r=c.pos)==null?void 0:r.rank,(o=c.pos)==null?void 0:o.file),this.pieces=this.pieces.filter(l=>l!==e),this.pieces.push(c)}return C(this,re,we).call(this),g}return!1}displayInConsole(){const t="\u2502",e="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",n="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",a=["a","b","c","d","e","f","g","h"];for(let r=this.board.length-1;r>=0;r--){let o=`${r+1} ${t} `;for(let u=0;u<this.board[r].length;u++){const g=this.getPiece(r,u);g?o+=g.unicodeChar:o+=" ",o+=` ${t} `}console.log(r===7?e:s),console.log(o),r===0&&console.log(n)}console.log(`  ${t} `+a.join(` ${t} `)+` ${t}`)}}Q=new WeakMap,re=new WeakSet,we=function(){this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(t=>{t.threatenedBy.clear(),t.threatens.clear(),t.protects.clear(),t.protectedBy.clear(),t.myKingIsUnderCheck=!1,"pathToEnemyKing"in t&&(t.pathToEnemyKing=[])}),this.pieces.forEach(t=>{t.defaultMoves=t.getDefaultMoves(this),t.legalMoves=t.getLegalMoves(this),t.coverage=t.getCoverageMoves(this),t.threaten()}),this.pieces.forEach(t=>{t.doIIntersect()&&t.threatenedBy.forEach(e=>{t.legalMoves=t.legalMoves.filter(s=>s.piece===e),t.coverage=t.getCoverageMoves(this)}),t.shade==="light"?t.coverage.forEach(e=>this.lightCoverage.add(e)):t.coverage.forEach(e=>this.darkCoverage.add(e))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.coverage=this.darkKing.getCoverageMoves(this),this.darkKing.isUnderCheck&&C(this,oe,Ke).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.coverage=this.lightKing.getCoverageMoves(this),this.lightKing.isUnderCheck&&C(this,oe,Ke).call(this,this.lightKing)),this.game&&(this.darkCoverage.size===0&&(this.game.whoWon="light"),this.lightCoverage.size===0&&(this.game.whoWon="dark"),(this.darkCoverage.size===0||this.lightCoverage.size===0)&&(this.history[this.history.length-1].an+="#",this.game.pause()))},oe=new WeakSet,Ke=function(t){const e=t.shade==="dark"?this.darkCoverage:this.lightCoverage;this.pieces.forEach(s=>{s.shade===t.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this),s.type==="Pawn"&&s.legalMoves.length===0?s.coverage=[]:s.coverage=s.getCoverageMoves(this))}),e.clear(),this.pieces.forEach(s=>{s.shade===t.shade&&s.coverage.forEach(n=>{e.add(n)})})},he=new WeakSet,Ce=function(){const t=new Array(8);for(let e=0;e<t.length;e++)t[e]=new Array(8);for(let e=t.length-1;e>=0;e--)for(let s=0;s<t[e].length;s++)t[e][s]=new je((s+e)%2===1?"light":"dark",{rank:e,file:s});return t},le=new WeakSet,Le=function(t,e){return 0<=t&&t<this.board.length&&0<=e&&e<this.board[t].length};class De{constructor(t,e,s){f(this,"shade");f(this,"name","Default Name");f(this,"uuid",xe());f(this,"intervalID",null);f(this,"isPaused",!0);f(this,"game");f(this,"currentTime",Me.Duration.from({minutes:30}));f(this,"events",{ontimechanged(){}});this.shade=e,this.name=t,this.game=s,this.currentTime=Me.Duration.from(this.game.initialTime)}start(){return this.isPaused=!1,this.intervalID=setInterval(()=>{this.currentTime=this.currentTime.subtract({seconds:1}),this.events.ontimechanged(this.shade,this.currentTime)},1e3),this}pause(){return this.intervalID&&(clearInterval(this.intervalID),this.isPaused=!0),this}}class mt{constructor(){f(this,"board");f(this,"initialTime",Me.Duration.from({minutes:30}));f(this,"light",new De("light","light",this));f(this,"dark",new De("dark","dark",this));f(this,"isPaused",!1);f(this,"hasStarted",!1);f(this,"currentPlayer",this.light);f(this,"events",{light:F({},this.light.events),dark:F({},this.dark.events)});f(this,"whoWon",null);this.board=new dt,this.board.game=this}addLightPlayer(t){return this.light.name=t,this}addDarkPlayer(t){return this.dark.name=t,this}start(){return this.isPaused=!1,this.hasStarted=!0,this.currentPlayer.start(),this}pause(){return this.isPaused=!0,this.light.pause(),this.dark.pause(),this}reset(){return this.pause(),this}switch(){this.currentPlayer.pause(),this.currentPlayer=this.currentPlayer.shade==="dark"?this.light:this.dark,this.currentPlayer.start()}}const _={canvasSize:900,canvasParent:"app",game:new mt},qe={onpiecemove:(i,t,e,s)=>{}},st=i=>{const{board:t}=_.game;let e=null,s=!1;i.setup=()=>{i.createCanvas(_.canvasSize,_.canvasSize).parent(_.canvasParent),i.background(0,0,0),t.loadPieces()};const n=(c,l=!1)=>{const p=i.width,y=i.height,E=8;let P=c.file*p/E,$=(c.rank+7-c.rank*2)*y/E;return l&&(P+=p/(E*2),$+=y/(E*2)),[P,$]},a=(c,l)=>{if(c.pos){let p,y;if(l)p=l.x,y=l.y;else{const[E,P]=n(c.pos,!0);p=E,y=P}i.push(),i.fill(0,0,255),i.textSize(50),i.textAlign(i.CENTER,i.CENTER),i.text(c.unicodeChar,p,y),i.pop()}},r=(c,l,p,y)=>{i.fill(...p),i.square(c,l,i.width/8),i.fill(255,0,0),i.text(`${y.file}${y.rank}`,c,l+i.height/8)},o=(c,l=r)=>{const[p,y]=n(c.pos),E=c.shade==="dark"?[0,0,0]:[255,255,255],{rank:P,file:$}=c.chessPosition;i.push(),i.noStroke(),l(p,y,E,{rank:P,file:$}),i.pop()},u=c=>{c.forEach(l=>{l&&o(l)}),e&&e.piece&&(o(e,(l,p)=>{i.fill(0,0,120,175),i.square(l,p,i.width/8)}),e.piece.legalMoves.forEach(l=>{o(l,(p,y)=>{i.fill(0,255,0,150),l.piece&&!l.piece.canBeEaten&&i.fill(255,0,0,150),i.square(p,y,i.width/8)})})),c.pieces.forEach(l=>{l===(e==null?void 0:e.piece)&&s?a(l,{x:i.mouseX,y:i.mouseY}):a(l)})},g=c=>{const[l,p]=n(c.pos);return[i.mouseX>=l&&i.mouseX<=l+i.width/8&&i.mouseY>=p&&i.mouseY<=p+i.height/8,l,p]},h=()=>{var c;(c=e==null?void 0:e.piece)==null||c.legalMoves.forEach(l=>{const[p]=g(l);if(p){const y=e.piece;t.movePiece(l.pos,e.piece)&&(qe.onpiecemove(y,l,e,_.game.board.history.length),e=null)}}),t.forEach(l=>{l&&g(l)[0]&&(e=l)})};i.mousePressed=()=>{switch(i.mouseButton){case i.LEFT:h();break}},i.mouseDragged=()=>{switch(i.mouseButton){case i.LEFT:e&&e.piece?s=!0:h();break}},i.mouseReleased=()=>{s=!1,e&&h()},i.draw=()=>{u(t)}};function vt(i){let t,e=i[0].name+"",s,n,a=`${i[1].minutes}:${i[1].seconds}`,r;return{c(){t=M("div"),s=U(e),n=S(),r=U(a),q(t,"id","player")},m(o,u){A(o,t,u),m(t,s),m(t,n),m(t,r)},p(o,[u]){u&1&&e!==(e=o[0].name+"")&&te(s,e),u&2&&a!==(a=`${o[1].minutes}:${o[1].seconds}`)&&te(r,a)},i:se,o:se,d(o){o&&z(t)}}}function kt(i,t,e){let s,{player:n}=t;return n.events.ontimechanged=(a,r)=>{e(1,s=r)},i.$$set=a=>{"player"in a&&e(0,n=a.player)},i.$$.update=()=>{i.$$.dirty&1&&e(1,s=n.currentTime)},[n,s]}class Ie extends b{constructor(t){super(),j(this,t,kt,vt,X,{player:0})}}function Ae(i,t,e){const s=i.slice();return s[2]=t[e],s[4]=e,s}function ze(i){let t,e,s=i[4]+1+"",n,a,r,o=i[2].an+"",u,g;return{c(){t=M("tr"),e=M("td"),n=U(s),a=S(),r=M("td"),u=U(o),g=S()},m(h,c){A(h,t,c),m(t,e),m(e,n),m(t,a),m(t,r),m(r,u),m(t,g)},p(h,c){c&1&&o!==(o=h[2].an+"")&&te(u,o)},d(h){h&&z(t)}}}function yt(i){let t,e,s,n,a,r,o,u,g,h,c,l,p,y,E;s=new Ie({props:{player:i[0].dark}}),o=new Ie({props:{player:i[0].light}});let P=i[0].board.history,$=[];for(let v=0;v<P.length;v+=1)$[v]=ze(Ae(i,P,v));return{c(){t=M("section"),e=M("div"),O(s.$$.fragment),n=S(),a=M("div"),r=S(),O(o.$$.fragment),u=S(),g=M("div"),h=M("table"),c=M("tr"),c.innerHTML=`<th>Num. of Moves</th> 
        <th>Desc.</th>`,l=S();for(let v=0;v<$.length;v+=1)$[v].c();p=S(),y=U(i[1]),q(a,"id","game"),q(e,"id","game-wrapper"),q(e,"class","svelte-1xamruw"),q(h,"class","svelte-1xamruw"),q(g,"id","history"),q(g,"class","svelte-1xamruw"),q(t,"id","main"),q(t,"class","svelte-1xamruw")},m(v,T){A(v,t,T),m(t,e),R(s,e,null),m(e,n),m(e,a),m(e,r),R(o,e,null),m(t,u),m(t,g),m(g,h),m(h,c),m(h,l);for(let K=0;K<$.length;K+=1)$[K].m(h,null);m(t,p),m(t,y),E=!0},p(v,[T]){const K={};T&1&&(K.player=v[0].dark),s.$set(K);const N={};if(T&1&&(N.player=v[0].light),o.$set(N),T&1){P=v[0].board.history;let k;for(k=0;k<P.length;k+=1){const J=Ae(v,P,k);$[k]?$[k].p(J,T):($[k]=ze(J),$[k].c(),$[k].m(h,null))}for(;k<$.length;k+=1)$[k].d(1);$.length=P.length}(!E||T&2)&&te(y,v[1])},i(v){E||(H(s.$$.fragment,v),H(o.$$.fragment,v),E=!0)},o(v){D(s.$$.fragment,v),D(o.$$.fragment,v),E=!1},d(v){v&&z(t),I(s),I(o),lt($,v)}}}function $t(i,t,e){let s,{game:n}=t;return i.$$set=a=>{"game"in a&&e(0,n=a.game)},i.$$.update=()=>{i.$$.dirty&1&&e(1,s=n.whoWon)},[n,s]}class it extends b{constructor(t){super(),j(this,t,$t,yt,X,{game:0})}}const ie=ct({io:ut(),id:""});function Et(i){let t,e,s,n,a,r,o,u,g;return e=new it({props:{game:i[1]}}),{c(){t=M("main"),O(e.$$.fragment),s=S(),n=M("button"),n.textContent="Start",a=S(),r=M("button"),r.textContent="Pause",ge(t,"--game-height",i[0].canvasSize+"px"),q(t,"class","svelte-1910pwy")},m(h,c){A(h,t,c),R(e,t,null),m(t,s),m(t,n),m(t,a),m(t,r),o=!0,u||(g=[G(n,"click",i[4]),G(r,"click",i[5])],u=!0)},p(h,[c]){const l={};c&2&&(l.game=h[1]),e.$set(l),(!o||c&1)&&ge(t,"--game-height",h[0].canvasSize+"px")},i(h){o||(H(e.$$.fragment,h),o=!0)},o(h){D(e.$$.fragment,h),o=!1},d(h){h&&z(t),I(e),u=!1,Ne(g)}}}function Mt(i,t,e){let s,n;Be(i,ie,h=>e(7,n=h));let a=n.io;_.canvasParent="game",_.canvasSize=700,qe.onpiecemove=(h,c,l,p)=>{e(1,s=_.game),a.emit("piecemove",{gameID:n.id,fen:s.board.fen,current:ce(F({},c),{piece:null}),previous:ce(F({},l),{piece:null}),move:p})},a.on("onpiecemoved",({fen:h,current:c,previous:l})=>{const p=s.board.getPiece(l.pos.rank,l.pos.file);console.log(p),_.game.board.movePiece(c.pos,p),e(1,s=_.game)});function r(){s.pause(),a.emit("pausegame",n.id)}function o(){s.start(),a.emit("startgame",n.id)}a.on("pausegame",()=>{s.pause()}),a.on("startgame",()=>{s.start()}),new Ge(st);const u=h=>e(1,s.hasStarted=!0,s),g=h=>s.isPaused?o():r();return i.$$.update=()=>{i.$$.dirty&1&&e(1,s=_.game)},[_,s,r,o,u,g]}class Pt extends b{constructor(t){super(),j(this,t,Mt,Et,X,{})}}function St(i){let t,e,s,n,a,r,o,u,g;return e=new it({props:{game:i[1]}}),{c(){t=M("main"),O(e.$$.fragment),s=S(),n=M("button"),n.textContent="Start",a=S(),r=M("button"),r.textContent="Pause",ge(t,"--game-height",i[0].canvasSize+"px"),q(t,"class","svelte-1910pwy")},m(h,c){A(h,t,c),R(e,t,null),m(t,s),m(t,n),m(t,a),m(t,r),o=!0,u||(g=[G(n,"click",i[2]),G(r,"click",i[3])],u=!0)},p(h,[c]){const l={};c&2&&(l.game=h[1]),e.$set(l),(!o||c&1)&&ge(t,"--game-height",h[0].canvasSize+"px")},i(h){o||(H(e.$$.fragment,h),o=!0)},o(h){D(e.$$.fragment,h),o=!1},d(h){h&&z(t),I(e),u=!1,Ne(g)}}}function Tt(i,t,e){let s;const n=new URL(location.href);n.searchParams.get("fen")&&(_.game.board.fen=n.searchParams.get("fen")),_.canvasParent="game",_.canvasSize=700,qe.onpiecemove=()=>{e(1,s=_.game)},new Ge(st);const a=o=>e(1,s.hasStarted=!0,s),r=o=>s.isPaused?s.start():s.pause();return i.$$.update=()=>{i.$$.dirty&1&&e(1,s=_.game)},[_,s,a,r]}class _t extends b{constructor(t){super(),j(this,t,Tt,St,X,{})}}function wt(i){let t,e,s,n=i[0].id+"",a,r,o;return{c(){t=M("div"),e=M("button"),e.textContent="Create game",s=S(),a=U(n)},m(u,g){A(u,t,g),m(t,e),m(t,s),m(t,a),r||(o=G(e,"click",i[1]),r=!0)},p(u,[g]){g&1&&n!==(n=u[0].id+"")&&te(a,n)},i:se,o:se,d(u){u&&z(t),r=!1,o()}}}function Kt(){return"game:"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function Ct(i,t,e){let s;return Be(i,ie,a=>e(0,s=a)),[s,()=>{ie.update(a=>ce(F({},a),{id:Kt()})),s.io.emit("createGame",s.id)}]}class Lt extends b{constructor(t){super(),j(this,t,Ct,wt,X,{})}}function Nt(i){let t,e,s,n,a,r,o,u,g,h,c;return s=new Lt({}),{c(){t=M("button"),t.textContent="Single Player",e=S(),O(s.$$.fragment),n=S(),a=M("form"),r=M("input"),o=S(),u=M("button"),u.textContent="Join",q(r,"type","text"),q(u,"type","submit")},m(l,p){A(l,t,p),A(l,e,p),R(s,l,p),A(l,n,p),A(l,a,p),m(a,r),Re(r,i[0].id),m(a,o),m(a,u),g=!0,h||(c=[G(t,"click",i[1]),G(r,"input",i[2]),G(a,"submit",i[3])],h=!0)},p(l,[p]){p&1&&r.value!==l[0].id&&Re(r,l[0].id)},i(l){g||(H(s.$$.fragment,l),g=!0)},o(l){D(s.$$.fragment,l),g=!1},d(l){l&&z(t),l&&z(e),I(s,l),l&&z(n),l&&z(a),h=!1,Ne(c)}}}function Bt(i,t,e){let s;Be(i,ie,o=>e(0,s=o));const n=()=>{Pe("/game/offline",{replace:!0})};s.io.on("joinedGame",()=>Pe("/game/online",{replace:!0}));function a(){s.id=this.value,ie.set(s)}return[s,n,a,o=>{o.preventDefault(),s.io.emit("joinGame",s.id)}]}class Wt extends b{constructor(t){super(),j(this,t,Bt,Nt,X,{})}}function qt(i){let t,e;return t=new Wt({}),{c(){O(t.$$.fragment)},m(s,n){R(t,s,n),e=!0},i(s){e||(H(t.$$.fragment,s),e=!0)},o(s){D(t.$$.fragment,s),e=!1},d(s){I(t,s)}}}function Ot(i){let t=Pe("/",{replace:!0})+"",e;return{c(){e=U(t)},m(s,n){A(s,e,n)},p:se,d(s){s&&z(e)}}}function Rt(i){let t,e;return t=new _t({}),{c(){O(t.$$.fragment)},m(s,n){R(t,s,n),e=!0},i(s){e||(H(t.$$.fragment,s),e=!0)},o(s){D(t.$$.fragment,s),e=!1},d(s){I(t,s)}}}function Ht(i){let t,e;return t=new Pt({}),{c(){O(t.$$.fragment)},m(s,n){R(t,s,n),e=!0},i(s){e||(H(t.$$.fragment,s),e=!0)},o(s){D(t.$$.fragment,s),e=!1},d(s){I(t,s)}}}function Dt(i){let t,e,s,n,a,r,o,u,g;return e=new ue({props:{path:"/",$$slots:{default:[qt]},$$scope:{ctx:i}}}),n=new ue({props:{path:"/game",$$slots:{default:[Ot]},$$scope:{ctx:i}}}),r=new ue({props:{path:"/game/offline",$$slots:{default:[Rt]},$$scope:{ctx:i}}}),u=new ue({props:{path:"/game/online",$$slots:{default:[Ht]},$$scope:{ctx:i}}}),{c(){t=M("div"),O(e.$$.fragment),s=S(),O(n.$$.fragment),a=S(),O(r.$$.fragment),o=S(),O(u.$$.fragment)},m(h,c){A(h,t,c),R(e,t,null),m(t,s),R(n,t,null),m(t,a),R(r,t,null),m(t,o),R(u,t,null),g=!0},p(h,c){const l={};c&1&&(l.$$scope={dirty:c,ctx:h}),e.$set(l);const p={};c&1&&(p.$$scope={dirty:c,ctx:h}),n.$set(p);const y={};c&1&&(y.$$scope={dirty:c,ctx:h}),r.$set(y);const E={};c&1&&(E.$$scope={dirty:c,ctx:h}),u.$set(E)},i(h){g||(H(e.$$.fragment,h),H(n.$$.fragment,h),H(r.$$.fragment,h),H(u.$$.fragment,h),g=!0)},o(h){D(e.$$.fragment,h),D(n.$$.fragment,h),D(r.$$.fragment,h),D(u.$$.fragment,h),g=!1},d(h){h&&z(t),I(e),I(n),I(r),I(u)}}}function It(i){let t,e;return t=new gt({props:{$$slots:{default:[Dt]},$$scope:{ctx:i}}}),{c(){O(t.$$.fragment)},m(s,n){R(t,s,n),e=!0},p(s,[n]){const a={};n&1&&(a.$$scope={dirty:n,ctx:s}),t.$set(a)},i(s){e||(H(t.$$.fragment,s),e=!0)},o(s){D(t.$$.fragment,s),e=!1},d(s){I(t,s)}}}class At extends b{constructor(t){super(),j(this,t,null,It,X,{})}}new At({target:document.getElementById("app")});
