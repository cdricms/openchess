var re=Object.defineProperty;var j=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Q=(n,e,t)=>e in n?re(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,X=(n,e)=>{for(var t in e||(e={}))ce.call(e,t)&&Q(n,t,e[t]);if(j)for(var t of j(e))le.call(e,t)&&Q(n,t,e[t]);return n};var l=(n,e,t)=>(Q(n,typeof e!="symbol"?e+"":e,t),t),D=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var U=(n,e,t)=>(D(n,e,"read from private field"),t?t.call(n):e.get(n)),m=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},C=(n,e,t,s)=>(D(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);var T=(n,e,t)=>(D(n,e,"access private method"),t);import{v as ge,p as fe}from"./vendor.ada7163b.js";const ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};ue();var P;(function(n){n.LightKing="\u2654",n.LightQueen="\u2655",n.LightRook="\u2656",n.LightBishop="\u2657",n.LightKnight="\u2658",n.LightPawn="\u2659",n.DarkKing="\u265A",n.DarkQueen="\u265B",n.DarkRook="\u265C",n.DarkBishop="\u265D",n.DarkKnight="\u265E",n.DarkPawn="\u265F"})(P||(P={}));function _(n,e){var s;const t=this.shade==="dark"?n.lightKing:n.darkKing;if(t){let i=!1;for(const o of e)if(((s=o.piece)==null?void 0:s.uuid)===t.uuid){i=!0;break}i&&(this.pathToEnemyKing=e)}return e}var r;(function(n){n[n.NORTH=0]="NORTH",n[n.NE=1]="NE",n[n.EAST=2]="EAST",n[n.SE=3]="SE",n[n.SOUTH=4]="SOUTH",n[n.SW=5]="SW",n[n.WEST=6]="WEST",n[n.NW=7]="NW"})(r||(r={}));function ee(n){switch(n){case r.NORTH:return{rank:1,file:0};case r.NE:return{rank:1,file:1};case r.EAST:return{rank:0,file:1};case r.SE:return{rank:-1,file:1};case r.SOUTH:return{rank:-1,file:0};case r.SW:return{rank:-1,file:-1};case r.WEST:return{rank:0,file:-1};case r.NW:return{rank:1,file:-1}}}function te(n,e){return ie(this,n,e)}function se(n,e){return ie(this,n,e)}function ie(n,e,t){var h,a;const s=[],i=ee(e);let o=t.getSquare((h=n.pos)==null?void 0:h.rank,(a=n.pos)==null?void 0:a.file);for(;o&&(o=t.getSquare(o.pos.rank+i.rank,o.pos.file+i.file));)s.push(o);return s}class ne{constructor(e,t){l(this,"piece",null);l(this,"shade");l(this,"pos");l(this,"chessPosition");this.shade=e,this.pos=t,this.chessPosition=this.getChessPosition()}getChessPosition(){const t=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:t}}}var B,A,pe;class w{constructor(e,t,s,i,o){m(this,A);l(this,"type");l(this,"shade");l(this,"pos");l(this,"unicodeChar");l(this,"fenChar");l(this,"defaultMoves",[]);l(this,"legalMoves",[]);l(this,"coverage",[]);l(this,"threatens",new Set);l(this,"threatenedBy",new Set);l(this,"protects",new Set);l(this,"protectedBy",new Set);l(this,"uuid",ge());l(this,"myKingIsUnderCheck",!1);m(this,B,[]);l(this,"timesMoved",0);l(this,"canBeEaten",!0);this.type=e,this.shade=t,this.pos=i;const{unicode:h,fenChar:a}=T(this,A,pe).call(this);this.unicodeChar=h,this.fenChar=a,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=o||[]}get initialSquares(){return U(this,B)}set initialSquares(e){C(this,B,e)}getDefaultMoves(e){return[]}getLegalMoves(e){return[]}getCoverageMoves(e){return this.legalMoves}moveConditions(e){return!1}isMoveLegal(e){return this.legalMoves.includes(e)}threaten(){this.coverage.forEach(e=>{e.piece&&e.piece.shade!==this.shade&&(this.threatens.add(e.piece),e.piece.threatenedBy.add(this))})}doIIntersect(){const e=this.threatenedBy;for(const t of e)if(t.type==="Bishop"||t.type==="Queen"||t.type==="Rook"){const s=t;for(const i of s.pathToEnemyKing)if(i.piece===this)return!0}return!1}findMovesToProtectKing(e){const t=this.shade==="dark"?e.darkKing:e.lightKing;if(t&&t.threatenedBy.size<=1)for(const s of t.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(i=>{var o;return s.pathToEnemyKing.includes(i)||i.pos.rank===((o=s.pos)==null?void 0:o.rank)&&i.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(i=>{var o;return i.pos.rank===((o=s.pos)==null?void 0:o.rank)&&i.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(e,t,s){if(e instanceof ne){let i=!1;return e.piece?(i=!1,e.piece.shade!==this.shade?i=!0:(i=!1,this.protects.add(e.piece),e.piece.protectedBy.add(this))):i=!0,s&&(i=s()),i}else{const i=[];for(const o of e)if(!o.piece)i.push(o);else if(o.piece.shade!==this.shade){i.push(o);break}else{this.protects.add(o.piece),o.piece.protectedBy.add(this);break}return i}}move(e,t){var a,f,k,K,L,g,c,u,d,y;const s=this.shade==="dark"?-1:1,i=t.getSquare(e.rank,e.file);if(!i)return;const o=i==null?void 0:i.piece;if(i&&!this.isMoveLegal(i)||o&&!(o!=null&&o.canBeEaten))return;if(this.pos&&t.setPiece(null,this.pos.rank,this.pos.file),o&&o.canBeEaten){const p=t.getPiece(e.rank,e.file);t.pieces=t.pieces.filter(E=>E!==p),t.setPiece(null,e.rank,e.file)}else if(this.type==="Pawn"){const p=this;((f=(a=p.canTakeEnPassant)==null?void 0:a.pos)==null?void 0:f.file)===e.file&&p.canTakeEnPassant.pos.rank===e.rank-s&&(t.setPiece(null,p.canTakeEnPassant.pos.rank,p.canTakeEnPassant.pos.file),t.pieces=t.pieces.filter(E=>E!==p.canTakeEnPassant),p.canTakeEnPassant=null,p.timesEnPassant=p.timesEnPassant+1)}else if(this.type==="King"&&this.timesMoved===0){const p=this.legalMoves.find(M=>{var S,v;return M.pos.file===((S=this.pos)==null?void 0:S.file)+2&&M.pos.rank===((v=this.pos)==null?void 0:v.rank)}),E=this.legalMoves.find(M=>{var S,v;return M.pos.file===((S=this.pos)==null?void 0:S.file)-2&&M.pos.rank===((v=this.pos)==null?void 0:v.rank)});if(p){const M=t.getPiece((k=this.pos)==null?void 0:k.rank,((K=this.pos)==null?void 0:K.file)+3);M&&t.setPiece(M,(L=this.pos)==null?void 0:L.rank,((g=this.pos)==null?void 0:g.file)+1)}if(E){const M=t.getPiece((c=this.pos)==null?void 0:c.rank,((u=this.pos)==null?void 0:u.file)-4);t.setPiece(M,(d=this.pos)==null?void 0:d.rank,((y=this.pos)==null?void 0:y.file)-1)}}t.setPiece(this,e.rank,e.file),this.timesMoved++;let h=t.pieceHistory.get(this.uuid);t.pieceHistory.set(this.uuid,h+1),t.totalMoves++,t.history.push({uuid:this.uuid})}}B=new WeakMap,A=new WeakSet,pe=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:P.DarkKing,fenChar:"k"};case"Queen":return{unicode:P.DarkQueen,fenChar:"q"};case"Rook":return{unicode:P.DarkRook,fenChar:"r"};case"Bishop":return{unicode:P.DarkBishop,fenChar:"b"};case"Knight":return{unicode:P.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:P.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:P.LightKing,fenChar:"K"};case"Queen":return{unicode:P.LightQueen,fenChar:"Q"};case"Rook":return{unicode:P.LightRook,fenChar:"R"};case"Bishop":return{unicode:P.LightBishop,fenChar:"B"};case"Knight":return{unicode:P.LightKnight,fenChar:"N"};case"Pawn":return{unicode:P.LightPawn,fenChar:"P"}}}};class oe extends w{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:0},{rank:i,file:7}];super("Rook",e,t,s,o);l(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,t){return[]}straightMove(e,t){return[]}getLegalMoves(e){const t=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.NORTH,e))),s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.EAST,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.SOUTH,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.WEST,e)));return[...t,...s,...i,...o]}getDefaultMoves(e){const t=this.straightMove(r.NORTH,e),s=this.straightMove(r.EAST,e),i=this.straightMove(r.SOUTH,e),o=this.straightMove(r.WEST,e);return[...t,...s,...i,...o]}}Object.assign(oe.prototype,{straightMove:se,getPathToEnemyKing:_});class ae extends w{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:2},{rank:i,file:5}];super("Bishop",e,t,s,o);l(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,t){return[]}diagonalMove(e,t){return[]}getLegalMoves(e){const t=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.NE,e))),s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.SE,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.SW,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.NW,e)));return[...t,...s,...i,...o]}getDefaultMoves(e){const t=this.diagonalMove(r.NE,e),s=this.diagonalMove(r.SE,e),i=this.diagonalMove(r.SW,e),o=this.diagonalMove(r.NW,e);return[...t,...s,...i,...o]}}Object.assign(ae.prototype,{diagonalMove:te,getPathToEnemyKing:_});var x,ke,I,de;class Y extends w{constructor(e,t,s){const o=[{rank:e==="dark"?7:0,file:4}];super("King",e,t,s,o);m(this,x);m(this,I);this.canBeEaten=!1}getLegalMoves(e){const t=this.shade==="dark"?e.lightCoverage:e.darkCoverage,s=[];return this.defaultMoves.forEach(i=>{this.checkMoveLegality(i)&&!t.has(i)&&!T(this,x,ke).call(this,i.piece)&&!T(this,I,de).call(this,i)&&s.push(i)}),s}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var i,o,h,a,f,k,K,L,g,c,u,d,y,p;const t=[],s=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let E=0;E<8;E++){const M=ee(r[s[E]]),S=e.getSquare(((i=this.pos)==null?void 0:i.rank)+M.rank,((o=this.pos)==null?void 0:o.file)+M.file);S&&t.push(S)}if(this.timesMoved===0){const E=e.getPiece((h=this.pos)==null?void 0:h.rank,((a=this.pos)==null?void 0:a.file)+3),M=e.getPiece((f=this.pos)==null?void 0:f.rank,((k=this.pos)==null?void 0:k.file)-4);if(E&&E.type==="Rook"&&E.shade===this.shade){let S=!0;for(let v=1;v<3;v++)if(e.getPiece((K=this.pos)==null?void 0:K.rank,((L=this.pos)==null?void 0:L.file)+v)){S=!1;break}if(S){const v=e.getSquare((g=this.pos)==null?void 0:g.rank,((c=this.pos)==null?void 0:c.file)+2);v&&t.push(v)}}if(M&&M.type==="Rook"&&M.shade===this.shade){let S=!0;for(let v=1;v<4;v++)if(e.getPiece((u=this.pos)==null?void 0:u.rank,((d=this.pos)==null?void 0:d.file)-v)){S=!1;break}if(S){const v=e.getSquare((y=this.pos)==null?void 0:y.rank,((p=this.pos)==null?void 0:p.file)-2);v&&t.push(v)}}}return t}}x=new WeakSet,ke=function(e){return e?this.threatenedBy.has(e)&&e.protectedBy.size>0:!1},I=new WeakSet,de=function(e){for(const t of this.threatenedBy)if("getPathToEnemyKing"in t)return t.pathToEnemyKing.includes(e);return!1};class $ extends w{constructor(e,t,s){const o=[{rank:e==="dark"?7:0,file:3}];super("Queen",e,t,s,o);l(this,"pathToEnemyKing",[])}diagonalMove(e,t){return[]}straightMove(e,t){return[]}getPathToEnemyKing(e,t){return[]}getLegalMoves(e){const t=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.NORTH,e)),e),s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.EAST,e)),e),i=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.SOUTH,e)),e),o=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.WEST,e)),e),h=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.NE,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.SE,e)),e),f=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.SW,e)),e),k=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.NW,e)),e);return[...t,...h,...s,...a,...i,...f,...o,...k]}getDefaultMoves(e){const t=this.straightMove(r.NORTH,e),s=this.straightMove(r.EAST,e),i=this.straightMove(r.SOUTH,e),o=this.straightMove(r.WEST,e),h=this.diagonalMove(r.NE,e),a=this.diagonalMove(r.SE,e),f=this.diagonalMove(r.SW,e),k=this.diagonalMove(r.NW,e);return[...t,...h,...s,...a,...i,...f,...o,...k]}}Object.assign($.prototype,{diagonalMove:te,straightMove:se,getPathToEnemyKing:_});class ve extends w{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:1},{rank:i,file:6}];super("Knight",e,t,s,o)}getDefaultMoves(e){const t=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(i=>{const o=e.getSquare(this.pos.rank+i[0],this.pos.file+i[1]);o&&t.push(o)}),t}getLegalMoves(e){const t=this.defaultMoves,s=[];return t.forEach(i=>{i&&this.checkMoveLegality(i)&&s.push(i)}),s}}var W,G;const F=class extends w{constructor(e,t,s){const i=e==="light"?1:6,h=[0,1,2,3,4,5,6,7].map(a=>({rank:i,file:a}));super("Pawn",e,t,s,h);m(this,W);l(this,"canTakeEnPassant",null);l(this,"timesEnPassant",0)}getLegalMoves(e){const t=this.defaultMoves,s=[];return t.forEach(i=>{i&&this.checkMoveLegality(i,e,()=>this.moveConditions(i))&&s.push(i)}),s}moveConditions(e){var s,i,o,h,a,f;const t=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-t===((s=this.canTakeEnPassant.pos)==null?void 0:s.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((i=this.pos)==null?void 0:i.rank)+t||e.pos.rank===((o=this.pos)==null?void 0:o.rank)+t*2?e.pos.rank!==((h=this.pos)==null?void 0:h.rank)+t*2&&(e.pos.file===((a=this.pos)==null?void 0:a.file)+t||e.pos.file===((f=this.pos)==null?void 0:f.file)-t)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const t=this.shade==="light"?1:-1;return this.defaultMoves.filter(s=>{var i,o;return!(s.pos.file===((i=this.pos)==null?void 0:i.file)&&(s.pos.rank===((o=this.pos)==null?void 0:o.rank)+t||s.pos.rank===this.pos.rank+t*2))})}getDefaultMoves(e){const t=[];if(this.pos){this.canTakeEnPassant=null;const s=this.shade==="light"?1:-1,i=e.getSquare(this.pos.rank+s,this.pos.file),o=e.getSquare(this.pos.rank+s*2,this.pos.file),h=e.getSquare(this.pos.rank+s,this.pos.file+s),a=e.getSquare(this.pos.rank+s,this.pos.file-s);if(i&&!(i!=null&&i.piece)&&(t.push(i),this.timesMoved===0&&this.initialSquares.find(f=>{var k,K;return f.rank===((k=this.pos)==null?void 0:k.rank)&&f.file===((K=this.pos)==null?void 0:K.file)})&&o&&!(o!=null&&o.piece)&&t.push(o)),h&&t.push(h),a&&t.push(a),this.timesEnPassant===0){const f=e.getSquare(this.pos.rank,this.pos.file+s),k=e.getSquare(this.pos.rank,this.pos.file-s);h&&!h.piece&&f&&f.piece instanceof F&&T(this,W,G).call(this,f.piece,e)&&(t.includes(h)||t.push(h)),a&&!a.piece&&k&&k.piece instanceof F&&T(this,W,G).call(this,k.piece,e)&&(t.includes(a)||t.push(a))}}return t}};let he=F;W=new WeakSet,G=function(e,t){return e.timesMoved===1&&t.history[t.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,console.log(e),!0):!1};var N,R,J,q,V,O,Z,H,b;class Ee{constructor(e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){m(this,R);m(this,q);m(this,O);m(this,H);l(this,"board");m(this,N,void 0);l(this,"pieces",[]);l(this,"lightKing",null);l(this,"darkKing",null);l(this,"darkCoverage",new Set);l(this,"lightCoverage",new Set);l(this,"pieceHistory",new Map);l(this,"totalMoves",0);l(this,"whoWon",null);l(this,"history",[]);this.board=T(this,O,Z).call(this),C(this,N,e)}get fen(){return U(this,N)}set fen(e){this.legalFEN(e)&&(C(this,N,e),this.emptyBoard(),this.loadPieces())}legalFEN(e){let t=0,s=0;for(const i of e){const o=parseInt(i);i==="/"?t++:isNaN(o)?s++:s+=o}return t===7&&s===64}emptyBoard(){this.pieces=[],this.board=T(this,O,Z).call(this)}loadPieces(e){e&&this.legalFEN(e)&&(this.fen=e);let t=this.board.length-1,s=0,i=0,o="";for(;t>=0&&(o=this.fen[i]);){const h=parseInt(o);if(o==="/")t--,s=0;else if(isNaN(h)){let a=null;switch(o){case"K":this.lightKing=a=new Y("light",this);break;case"k":this.darkKing=a=new Y("dark",this);break;case"Q":case"q":a=new $(o==="q"?"dark":"light",this);break;case"R":case"r":a=new oe(o==="r"?"dark":"light",this);break;case"N":case"n":a=new ve(o==="n"?"dark":"light",this);break;case"B":case"b":a=new ae(o==="b"?"dark":"light",this);break;case"P":case"p":a=new he(o==="p"?"dark":"light",this);break}this.board[t][s].piece=a,a&&(a.pos=this.board[t][s].pos,this.pieces.push(a),this.pieceHistory.set(a.uuid,0)),s++}else s+=h;i++}T(this,R,J).call(this)}getKing(e){return this.pieces.find(s=>s.shade===e&&s.type==="King")||null}generateFEN(){let e="",t=0;return this.forEach((s,i,o)=>{!s||!s.piece?t++:(t>0&&(e+=t,t=0),e+=s.piece.fenChar),o===this.board[i].length-1&&(t>0&&(e+=t,t=0),i!=0&&(e+="/"))}),e}forEach(e){for(let t=this.board.length-1;t>=0;t--)for(let s=0;s<this.board[t].length;s++)e(this.getSquare(t,s),t,s)}setPiece(e,t,s){return T(this,H,b).call(this,t,s)?(this.board[t][s].piece=e,e&&(e.pos=this.board[t][s].pos),C(this,N,this.generateFEN()),!0):!1}getPiece(e,t){const s=this.getSquare(e,t);return s?s.piece:null}getSquare(e,t){return T(this,H,b).call(this,e,t)?this.board[e][t]:null}movePiece(e,t){var s,i;if(t){const o=X({},t.pos);t.move(e,this);const h=t.shade==="dark"?-1:1;if(t.type==="Pawn"&&e.rank===o.rank+h&&e.rank===(t.shade==="dark"?0:7)){const a=new $(t.shade,this,t.pos);a.uuid=t.uuid,this.setPiece(a,(s=a.pos)==null?void 0:s.rank,(i=a.pos)==null?void 0:i.file),this.pieces=this.pieces.filter(f=>f.uuid!==t.uuid),this.pieces.push(a),console.table(this.pieces)}T(this,R,J).call(this)}}displayInConsole(){const e="\u2502",t="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",i="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",o=["a","b","c","d","e","f","g","h"];for(let h=this.board.length-1;h>=0;h--){let a=`${h+1} ${e} `;for(let f=0;f<this.board[h].length;f++){const k=this.getPiece(h,f);k?a+=k.unicodeChar:a+=" ",a+=` ${e} `}console.log(h===7?t:s),console.log(a),h===0&&console.log(i)}console.log(`  ${e} `+o.join(` ${e} `)+` ${e}`)}}N=new WeakMap,R=new WeakSet,J=function(){console.table(this.history),this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(e=>{e.threatenedBy.clear(),e.threatens.clear(),e.protects.clear(),e.protectedBy.clear(),e.myKingIsUnderCheck=!1,"pathToEnemyKing"in e&&(e.pathToEnemyKing=[])}),this.pieces.forEach(e=>{e.defaultMoves=e.getDefaultMoves(this),e.legalMoves=e.getLegalMoves(this),e.coverage=e.getCoverageMoves(this),e.threaten()}),this.pieces.forEach(e=>{e.doIIntersect()&&e.threatenedBy.forEach(t=>{e.legalMoves=e.legalMoves.filter(s=>s.piece===t)}),e.shade==="light"?e.coverage.forEach(t=>this.lightCoverage.add(t)):e.coverage.forEach(t=>this.darkCoverage.add(t))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.isUnderCheck&&T(this,q,V).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.isUnderCheck&&T(this,q,V).call(this,this.lightKing)),this.darkCoverage.size===0&&(this.whoWon="light"),this.lightCoverage.size===0&&(this.whoWon="dark")},q=new WeakSet,V=function(e){const t=e.shade==="dark"?this.darkCoverage:this.lightCoverage;this.pieces.forEach(s=>{s.shade===e.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this))}),t.clear(),this.pieces.forEach(s=>{s.shade===e.shade&&s.coverage.forEach(i=>{t.add(i)})})},O=new WeakSet,Z=function(){const e=new Array(8);for(let t=0;t<e.length;t++)e[t]=new Array(8);for(let t=e.length-1;t>=0;t--)for(let s=0;s<e[t].length;s++)e[t][s]=new ne((s+t)%2===1?"light":"dark",{rank:t,file:s});return e},H=new WeakSet,b=function(e,t){return 0<=e&&e<this.board.length&&0<=t&&t<this.board[e].length};const z={canvasSize:900,canvasParent:"app"},Me=n=>{const e=new Ee;let t=null,s=!1,i=n.createInput(e.fen,"text");i.style("width","100%"),i.elt.onchange=()=>{const g=new URL(location.href);g.searchParams.set("fen",e.fen),history.replaceState("","",g)},window.onload=()=>{const g=new URL(location.href).searchParams.get("fen");g&&(e.fen=g)},n.setup=()=>{n.createCanvas(z.canvasSize,z.canvasSize).parent(z.canvasParent),n.background(0,0,0),e.loadPieces(),i.input(u=>{e.fen=u.target.value}),n.createButton("Reset FEN").mouseClicked(()=>{e.fen="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",i.elt.value=e.fen,i.elt.onchange()})};const o=(g,c=!1)=>{const u=n.width,d=n.height,y=8;let p=g.file*u/y,E=(g.rank+7-g.rank*2)*d/y;return c&&(p+=u/(y*2),E+=d/(y*2)),[p,E]},h=(g,c)=>{if(g.pos){let u,d;if(c)u=c.x,d=c.y;else{const[y,p]=o(g.pos,!0);u=y,d=p}n.push(),n.fill(0,0,255),n.textSize(50),n.textAlign(n.CENTER,n.CENTER),n.text(g.unicodeChar,u,d),n.pop()}},a=(g,c,u,d)=>{n.fill(...u),n.square(g,c,n.width/8),n.fill(255,0,0),n.text(`${d.file}${d.rank}`,g,c+n.height/8)},f=(g,c=a)=>{const[u,d]=o(g.pos),y=g.shade==="dark"?[0,0,0]:[255,255,255],{rank:p,file:E}=g.chessPosition;n.push(),n.noStroke(),c(u,d,y,{rank:p,file:E}),n.pop()},k=g=>{g.forEach(c=>{c&&f(c)}),t&&t.piece&&(f(t,(c,u)=>{n.fill(0,0,120,175),n.square(c,u,n.width/8)}),t.piece.legalMoves.forEach(c=>{f(c,(u,d)=>{n.fill(0,255,0,150),c.piece&&!c.piece.canBeEaten&&n.fill(255,0,0,150),n.square(u,d,n.width/8)})})),g.pieces.forEach(c=>{c===(t==null?void 0:t.piece)&&s?h(c,{x:n.mouseX,y:n.mouseY}):h(c)})},K=g=>{const[c,u]=o(g.pos);return[n.mouseX>=c&&n.mouseX<=c+n.width/8&&n.mouseY>=u&&n.mouseY<=u+n.height/8,c,u]},L=()=>{var g;(g=t==null?void 0:t.piece)==null||g.legalMoves.forEach(c=>{const[u]=K(c);u&&(e.movePiece(c.pos,t.piece),t=null)}),e.forEach(c=>{c&&K(c)[0]&&(t=c)}),i.elt.value=e.fen,i.elt.onchange()};n.mousePressed=()=>{switch(n.mouseButton){case n.LEFT:L();break}},n.mouseDragged=()=>{switch(n.mouseButton){case n.LEFT:t&&t.piece?s=!0:L();break}},n.mouseReleased=()=>{s=!1,t&&L()},n.draw=()=>{k(e)}};new fe(Me);
