var ye=Object.defineProperty;var ae=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var X=(o,t,e)=>t in o?ye(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,he=(o,t)=>{for(var e in t||(t={}))Me.call(t,e)&&X(o,e,t[e]);if(ae)for(var e of ae(t))Se.call(t,e)&&X(o,e,t[e]);return o};var l=(o,t,e)=>(X(o,typeof t!="symbol"?t+"":t,e),e),Y=(o,t,e)=>{if(!t.has(o))throw TypeError("Cannot "+e)};var G=(o,t,e)=>(Y(o,t,"read from private field"),e?e.call(o):t.get(o)),C=(o,t,e)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,e)},H=(o,t,e,s)=>(Y(o,t,"write to private field"),s?s.call(o,e):t.set(o,e),e);var P=(o,t,e)=>(Y(o,t,"access private method"),e);import{v as Pe,p as Te}from"./vendor.ada7163b.js";const Ke=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}};Ke();var T;(function(o){o.LightKing="\u2654",o.LightQueen="\u2655",o.LightRook="\u2656",o.LightBishop="\u2657",o.LightKnight="\u2658",o.LightPawn="\u2659",o.DarkKing="\u265A",o.DarkQueen="\u265B",o.DarkRook="\u265C",o.DarkBishop="\u265D",o.DarkKnight="\u265E",o.DarkPawn="\u265F"})(T||(T={}));function ne(o,t){var s;const e=this.shade==="dark"?o.lightKing:o.darkKing;if(e){let n=!1;for(const i of t)if(((s=i.piece)==null?void 0:s.uuid)===e.uuid){n=!0;break}n&&(this.pathToEnemyKing=t)}return t}var c;(function(o){o[o.NORTH=0]="NORTH",o[o.NE=1]="NE",o[o.EAST=2]="EAST",o[o.SE=3]="SE",o[o.SOUTH=4]="SOUTH",o[o.SW=5]="SW",o[o.WEST=6]="WEST",o[o.NW=7]="NW"})(c||(c={}));function ce(o){switch(o){case c.NORTH:return{rank:1,file:0};case c.NE:return{rank:1,file:1};case c.EAST:return{rank:0,file:1};case c.SE:return{rank:-1,file:1};case c.SOUTH:return{rank:-1,file:0};case c.SW:return{rank:-1,file:-1};case c.WEST:return{rank:0,file:-1};case c.NW:return{rank:1,file:-1}}}function le(o,t){return fe(this,o,t)}function ge(o,t){return fe(this,o,t)}function fe(o,t,e){var a,h;const s=[],n=ce(t);let i=e.getSquare((a=o.pos)==null?void 0:a.rank,(h=o.pos)==null?void 0:h.file);for(;i&&(i=e.getSquare(i.pos.rank+n.rank,i.pos.file+n.file));)s.push(i);return s}class ue{constructor(t,e){l(this,"piece",null);l(this,"shade");l(this,"pos");l(this,"chessPosition");this.shade=t,this.pos=e,this.chessPosition=this.getChessPosition()}getChessPosition(){const e=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:e}}}var x,D,pe;class q{constructor(t,e,s,n,i){C(this,D);l(this,"type");l(this,"shade");l(this,"pos");l(this,"unicodeChar");l(this,"fenChar");l(this,"defaultMoves",[]);l(this,"legalMoves",[]);l(this,"coverage",[]);l(this,"threatens",new Set);l(this,"threatenedBy",new Set);l(this,"protects",new Set);l(this,"protectedBy",new Set);l(this,"uuid",Pe());l(this,"myKingIsUnderCheck",!1);C(this,x,[]);l(this,"timesMoved",0);l(this,"canBeEaten",!0);this.type=t,this.shade=e,this.pos=n;const{unicode:a,fenChar:h}=P(this,D,pe).call(this);this.unicodeChar=a,this.fenChar=h,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=i||[]}get initialSquares(){return G(this,x)}set initialSquares(t){H(this,x,t)}getDefaultMoves(t){return[]}getLegalMoves(t){return[]}getCoverageMoves(t){return this.legalMoves}moveConditions(t){return!1}isMoveLegal(t){return this.legalMoves.includes(t)}threaten(){this.coverage.forEach(t=>{t.piece&&t.piece.shade!==this.shade&&(this.threatens.add(t.piece),t.piece.threatenedBy.add(this))})}doIIntersect(){const t=this.threatenedBy;for(const e of t)if(e.type==="Bishop"||e.type==="Queen"||e.type==="Rook"){const s=e;for(const n of s.pathToEnemyKing)if(n.piece===this)return!0}return!1}findMovesToProtectKing(t){const e=this.shade==="dark"?t.darkKing:t.lightKing;if(e&&e.threatenedBy.size<=1)for(const s of e.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(n=>{var i;return s.pathToEnemyKing.includes(n)||n.pos.rank===((i=s.pos)==null?void 0:i.rank)&&n.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(n=>{var i;return n.pos.rank===((i=s.pos)==null?void 0:i.rank)&&n.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(t,e,s){if(t instanceof ue){let n=!1;return t.piece?(n=!1,t.piece.shade!==this.shade?n=!0:(n=!1,this.protects.add(t.piece),t.piece.protectedBy.add(this))):n=!0,s&&(n=s()),n}else{const n=[];for(const i of t)if(!i.piece)n.push(i);else if(i.piece.shade!==this.shade){n.push(i);break}else{this.protects.add(i.piece),i.piece.protectedBy.add(this);break}return n}}move(t,e){var f,k,d,K,g,r,u,p,v,M,L,w,N,m,y,oe;let s=`${this.type==="Pawn"?"":this.fenChar.toUpperCase()}`;const n=this.shade==="dark"?-1:1,i=e.getSquare(t.rank,t.file);if(!i)return;const a=i==null?void 0:i.piece;if(i&&!this.isMoveLegal(i)||a&&!(a!=null&&a.canBeEaten))return;if(this.pos&&e.setPiece(null,this.pos.rank,this.pos.file),a&&a.canBeEaten){const S=e.getPiece(t.rank,t.file);e.pieces=e.pieces.filter(B=>B!==S),e.setPiece(null,t.rank,t.file),s+=`x${i.chessPosition.file.toLowerCase()}${i.chessPosition.rank}`}else if(this.type==="Pawn"){const S=this;if(((k=(f=S.canTakeEnPassant)==null?void 0:f.pos)==null?void 0:k.file)===t.file&&S.canTakeEnPassant.pos.rank===t.rank-n){const B=e.getSquare((d=S.pos)==null?void 0:d.rank,(K=S.pos)==null?void 0:K.file);e.setPiece(null,S.canTakeEnPassant.pos.rank,S.canTakeEnPassant.pos.file),e.pieces=e.pieces.filter(E=>E!==S.canTakeEnPassant),S.canTakeEnPassant=null,S.timesEnPassant=S.timesEnPassant+1,s=`${B==null?void 0:B.chessPosition.file.toLowerCase()}x${i.chessPosition.file.toLowerCase()}${i.chessPosition.rank} e.p`}else s=`${i.chessPosition.file.toLowerCase()}${i.chessPosition.rank}`}else if(this.type==="King"&&this.timesMoved===0){const S=this.legalMoves.find(E=>{var R,O;return E.pos.file===((R=this.pos)==null?void 0:R.file)+2&&E.pos.rank===((O=this.pos)==null?void 0:O.rank)}),B=this.legalMoves.find(E=>{var R,O;return E.pos.file===((R=this.pos)==null?void 0:R.file)-2&&E.pos.rank===((O=this.pos)==null?void 0:O.rank)});if(S||B){if(S){const E=e.getPiece((g=this.pos)==null?void 0:g.rank,((r=this.pos)==null?void 0:r.file)+3);E&&(e.setPiece(null,(u=E.pos)==null?void 0:u.rank,(p=E.pos)==null?void 0:p.file),e.setPiece(E,(v=this.pos)==null?void 0:v.rank,((M=this.pos)==null?void 0:M.file)+1),s="O-O")}if(B){const E=e.getPiece((L=this.pos)==null?void 0:L.rank,((w=this.pos)==null?void 0:w.file)-4);E&&(e.setPiece(null,(N=E.pos)==null?void 0:N.rank,(m=E.pos)==null?void 0:m.file),e.setPiece(E,(y=this.pos)==null?void 0:y.rank,((oe=this.pos)==null?void 0:oe.file)-1),s="O-O-O")}}else s+=`${i.chessPosition.file.toLowerCase()}${i.chessPosition.rank}`}else s+=`${i.chessPosition.file.toLowerCase()}${i.chessPosition.rank}`;e.setPiece(this,t.rank,t.file),this.timesMoved++;let h=e.pieceHistory.get(this.uuid);e.pieceHistory.set(this.uuid,h+1),e.totalMoves++,e.history.push({uuid:this.uuid,an:s})}}x=new WeakMap,D=new WeakSet,pe=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:T.DarkKing,fenChar:"k"};case"Queen":return{unicode:T.DarkQueen,fenChar:"q"};case"Rook":return{unicode:T.DarkRook,fenChar:"r"};case"Bishop":return{unicode:T.DarkBishop,fenChar:"b"};case"Knight":return{unicode:T.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:T.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:T.LightKing,fenChar:"K"};case"Queen":return{unicode:T.LightQueen,fenChar:"Q"};case"Rook":return{unicode:T.LightRook,fenChar:"R"};case"Bishop":return{unicode:T.LightBishop,fenChar:"B"};case"Knight":return{unicode:T.LightKnight,fenChar:"N"};case"Pawn":return{unicode:T.LightPawn,fenChar:"P"}}}};class ke extends q{constructor(e,s,n){const i=e==="dark"?7:0;super("Rook",e,s,n,[{rank:i,file:0},{rank:i,file:7}]);l(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}straightMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(c.NORTH,e))),n=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(c.EAST,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(c.SOUTH,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(c.WEST,e)));return[...s,...n,...i,...a]}getDefaultMoves(e){const s=this.straightMove(c.NORTH,e),n=this.straightMove(c.EAST,e),i=this.straightMove(c.SOUTH,e),a=this.straightMove(c.WEST,e);return[...s,...n,...i,...a]}}Object.assign(ke.prototype,{straightMove:ge,getPathToEnemyKing:ne});class de extends q{constructor(e,s,n){const i=e==="dark"?7:0;super("Bishop",e,s,n,[{rank:i,file:2},{rank:i,file:5}]);l(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}diagonalMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(c.NE,e))),n=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(c.SE,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(c.SW,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(c.NW,e)));return[...s,...n,...i,...a]}getDefaultMoves(e){const s=this.diagonalMove(c.NE,e),n=this.diagonalMove(c.SE,e),i=this.diagonalMove(c.SW,e),a=this.diagonalMove(c.NW,e);return[...s,...n,...i,...a]}}Object.assign(de.prototype,{diagonalMove:le,getPathToEnemyKing:ne});var z,ve,_,Ee;class re extends q{constructor(e,s,n){super("King",e,s,n,[{rank:e==="dark"?7:0,file:4}]);C(this,z);C(this,_);this.canBeEaten=!1}getLegalMoves(e){const s=this.shade==="dark"?e.lightCoverage:e.darkCoverage,n=[];return this.defaultMoves.forEach(i=>{this.checkMoveLegality(i)&&!s.has(i)&&!P(this,z,ve).call(this,i.piece)&&!P(this,_,Ee).call(this,i)&&n.push(i)}),n}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var i,a,h,f,k,d,K,g,r,u,p,v,M,L;const s=[],n=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let w=0;w<8;w++){const N=ce(c[n[w]]),m=e.getSquare(((i=this.pos)==null?void 0:i.rank)+N.rank,((a=this.pos)==null?void 0:a.file)+N.file);m&&s.push(m)}if(this.timesMoved===0){const w=e.getPiece((h=this.pos)==null?void 0:h.rank,((f=this.pos)==null?void 0:f.file)+3),N=e.getPiece((k=this.pos)==null?void 0:k.rank,((d=this.pos)==null?void 0:d.file)-4);if(w&&w.type==="Rook"&&w.shade===this.shade){let m=!0;for(let y=1;y<3;y++)if(e.getPiece((K=this.pos)==null?void 0:K.rank,((g=this.pos)==null?void 0:g.file)+y)){m=!1;break}if(m){const y=e.getSquare((r=this.pos)==null?void 0:r.rank,((u=this.pos)==null?void 0:u.file)+2);y&&s.push(y)}}if(N&&N.type==="Rook"&&N.shade===this.shade){let m=!0;for(let y=1;y<4;y++)if(e.getPiece((p=this.pos)==null?void 0:p.rank,((v=this.pos)==null?void 0:v.file)-y)){m=!1;break}if(m){const y=e.getSquare((M=this.pos)==null?void 0:M.rank,((L=this.pos)==null?void 0:L.file)-2);y&&s.push(y)}}}return s}}z=new WeakSet,ve=function(e){return e?this.threatenedBy.has(e)&&e.protectedBy.size>0:!1},_=new WeakSet,Ee=function(e){for(const s of this.threatenedBy)if("getPathToEnemyKing"in s)return s.pathToEnemyKing.includes(e);return!1};class V extends q{constructor(e,s,n){super("Queen",e,s,n,[{rank:e==="dark"?7:0,file:3}]);l(this,"pathToEnemyKing",[])}diagonalMove(e,s){return[]}straightMove(e,s){return[]}getPathToEnemyKing(e,s){return[]}getLegalMoves(e){const s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(c.NORTH,e)),e),n=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(c.EAST,e)),e),i=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(c.SOUTH,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(c.WEST,e)),e),h=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(c.NE,e)),e),f=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(c.SE,e)),e),k=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(c.SW,e)),e),d=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(c.NW,e)),e);return[...s,...h,...n,...f,...i,...k,...a,...d]}getDefaultMoves(e){const s=this.straightMove(c.NORTH,e),n=this.straightMove(c.EAST,e),i=this.straightMove(c.SOUTH,e),a=this.straightMove(c.WEST,e),h=this.diagonalMove(c.NE,e),f=this.diagonalMove(c.SE,e),k=this.diagonalMove(c.SW,e),d=this.diagonalMove(c.NW,e);return[...s,...h,...n,...f,...i,...k,...a,...d]}}Object.assign(V.prototype,{diagonalMove:le,straightMove:ge,getPathToEnemyKing:ne});class me extends q{constructor(t,e,s){const n=t==="dark"?7:0,i=[{rank:n,file:1},{rank:n,file:6}];super("Knight",t,e,s,i)}getDefaultMoves(t){const e=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(n=>{const i=t.getSquare(this.pos.rank+n[0],this.pos.file+n[1]);i&&e.push(i)}),e}getLegalMoves(t){const e=this.defaultMoves,s=[];return e.forEach(n=>{n&&this.checkMoveLegality(n)&&s.push(n)}),s}}var A,b;const j=class extends q{constructor(e,s,n){const i=e==="light"?1:6,h=[0,1,2,3,4,5,6,7].map(f=>({rank:i,file:f}));super("Pawn",e,s,n,h);C(this,A);l(this,"canTakeEnPassant",null);l(this,"timesEnPassant",0)}getLegalMoves(e){const s=this.defaultMoves,n=[];return s.forEach(i=>{i&&this.checkMoveLegality(i,e,()=>this.moveConditions(i))&&n.push(i)}),n}moveConditions(e){var n,i,a,h,f,k;const s=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-s===((n=this.canTakeEnPassant.pos)==null?void 0:n.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((i=this.pos)==null?void 0:i.rank)+s||e.pos.rank===((a=this.pos)==null?void 0:a.rank)+s*2?e.pos.rank!==((h=this.pos)==null?void 0:h.rank)+s*2&&(e.pos.file===((f=this.pos)==null?void 0:f.file)+s||e.pos.file===((k=this.pos)==null?void 0:k.file)-s)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const s=this.shade==="light"?1:-1;return this.defaultMoves.filter(n=>{var i,a;return!(n.pos.file===((i=this.pos)==null?void 0:i.file)&&(n.pos.rank===((a=this.pos)==null?void 0:a.rank)+s||n.pos.rank===this.pos.rank+s*2))})}getDefaultMoves(e){const s=[];if(this.pos){this.canTakeEnPassant=null;const n=this.shade==="light"?1:-1,i=e.getSquare(this.pos.rank+n,this.pos.file),a=e.getSquare(this.pos.rank+n*2,this.pos.file),h=e.getSquare(this.pos.rank+n,this.pos.file+n),f=e.getSquare(this.pos.rank+n,this.pos.file-n);if(i&&!(i!=null&&i.piece)&&(s.push(i),this.timesMoved===0&&this.initialSquares.find(k=>{var d,K;return k.rank===((d=this.pos)==null?void 0:d.rank)&&k.file===((K=this.pos)==null?void 0:K.file)})&&a&&!(a!=null&&a.piece)&&s.push(a)),h&&s.push(h),f&&s.push(f),this.timesEnPassant===0){const k=e.getSquare(this.pos.rank,this.pos.file+n),d=e.getSquare(this.pos.rank,this.pos.file-n);h&&!h.piece&&k&&k.piece instanceof j&&P(this,A,b).call(this,k.piece,e)&&(s.includes(h)||s.push(h)),f&&!f.piece&&d&&d.piece instanceof j&&P(this,A,b).call(this,d.piece,e)&&(s.includes(f)||s.push(f))}}return s}};let Z=j;A=new WeakSet,b=function(e,s){return e.timesMoved===1&&s.history[s.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,console.log(e),!0):!1};var W,$,ee,I,te,F,se,Q,ie;class Ce{constructor(t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){C(this,$);C(this,I);C(this,F);C(this,Q);l(this,"board");C(this,W,void 0);l(this,"pieces",[]);l(this,"lightKing",null);l(this,"darkKing",null);l(this,"darkCoverage",new Set);l(this,"lightCoverage",new Set);l(this,"pieceHistory",new Map);l(this,"totalMoves",0);l(this,"whoWon",null);l(this,"history",[]);this.board=P(this,F,se).call(this),H(this,W,t)}get fen(){return G(this,W)}set fen(t){this.legalFEN(t)&&(H(this,W,t),this.emptyBoard(),this.loadPieces())}legalFEN(t){let e=0,s=0;for(const n of t){const i=parseInt(n);n==="/"?e++:isNaN(i)?s++:s+=i}return e===7&&s===64}emptyBoard(){this.pieces=[],this.board=P(this,F,se).call(this)}loadPieces(t){t&&this.legalFEN(t)&&(this.fen=t);let e=this.board.length-1,s=0,n=0,i="";for(;e>=0&&(i=this.fen[n]);){const a=parseInt(i);if(i==="/")e--,s=0;else if(isNaN(a)){let h=null;switch(i){case"K":this.lightKing=h=new re("light",this);break;case"k":this.darkKing=h=new re("dark",this);break;case"Q":case"q":h=new V(i==="q"?"dark":"light",this);break;case"R":case"r":h=new ke(i==="r"?"dark":"light",this);break;case"N":case"n":h=new me(i==="n"?"dark":"light",this);break;case"B":case"b":h=new de(i==="b"?"dark":"light",this);break;case"P":case"p":h=new Z(i==="p"?"dark":"light",this);break}this.board[e][s].piece=h,h&&(h.pos=this.board[e][s].pos,this.pieces.push(h),this.pieceHistory.set(h.uuid,0)),s++}else s+=a;n++}P(this,$,ee).call(this)}getKing(t){return this.pieces.find(s=>s.shade===t&&s.type==="King")||null}generateFEN(){let t="",e=0;return this.forEach((s,n,i)=>{!s||!s.piece?e++:(e>0&&(t+=e,e=0),t+=s.piece.fenChar),i===this.board[n].length-1&&(e>0&&(t+=e,e=0),n!=0&&(t+="/"))}),t}forEach(t){for(let e=this.board.length-1;e>=0;e--)for(let s=0;s<this.board[e].length;s++)t(this.getSquare(e,s),e,s)}setPiece(t,e,s){return P(this,Q,ie).call(this,e,s)?(this.board[e][s].piece=t,t&&(t.pos=this.board[e][s].pos),H(this,W,this.generateFEN()),!0):!1}getPiece(t,e){const s=this.getSquare(t,e);return s?s.piece:null}getSquare(t,e){return P(this,Q,ie).call(this,t,e)?this.board[t][e]:null}movePiece(t,e){var s,n;if(e){const i=he({},e.pos);e.move(t,this);const a=e.shade==="dark"?-1:1;if(e.type==="Pawn"&&t.rank===i.rank+a&&t.rank===(e.shade==="dark"?0:7)){const h=new V(e.shade,this,e.pos);h.uuid=e.uuid,this.setPiece(h,(s=h.pos)==null?void 0:s.rank,(n=h.pos)==null?void 0:n.file),this.pieces=this.pieces.filter(f=>f!==e),this.pieces.push(h),console.table(this.pieces)}P(this,$,ee).call(this)}}displayInConsole(){const t="\u2502",e="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",n="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",i=["a","b","c","d","e","f","g","h"];for(let a=this.board.length-1;a>=0;a--){let h=`${a+1} ${t} `;for(let f=0;f<this.board[a].length;f++){const k=this.getPiece(a,f);k?h+=k.unicodeChar:h+=" ",h+=` ${t} `}console.log(a===7?e:s),console.log(h),a===0&&console.log(n)}console.log(`  ${t} `+i.join(` ${t} `)+` ${t}`)}}W=new WeakMap,$=new WeakSet,ee=function(){console.table(this.history),this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(t=>{t.threatenedBy.clear(),t.threatens.clear(),t.protects.clear(),t.protectedBy.clear(),t.myKingIsUnderCheck=!1,"pathToEnemyKing"in t&&(t.pathToEnemyKing=[])}),this.pieces.forEach(t=>{t.defaultMoves=t.getDefaultMoves(this),t.legalMoves=t.getLegalMoves(this),t.coverage=t.getCoverageMoves(this),t.threaten()}),this.pieces.forEach(t=>{t.doIIntersect()&&t.threatenedBy.forEach(e=>{t.legalMoves=t.legalMoves.filter(s=>s.piece===e)}),t.shade==="light"?t.coverage.forEach(e=>this.lightCoverage.add(e)):t.coverage.forEach(e=>this.darkCoverage.add(e))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.isUnderCheck&&P(this,I,te).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.isUnderCheck&&P(this,I,te).call(this,this.lightKing)),this.darkCoverage.size===0&&(this.whoWon="light"),this.lightCoverage.size===0&&(this.whoWon="dark")},I=new WeakSet,te=function(t){const e=t.shade==="dark"?this.darkCoverage:this.lightCoverage;this.pieces.forEach(s=>{s.shade===t.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this))}),e.clear(),this.pieces.forEach(s=>{s.shade===t.shade&&s.coverage.forEach(n=>{e.add(n)})})},F=new WeakSet,se=function(){const t=new Array(8);for(let e=0;e<t.length;e++)t[e]=new Array(8);for(let e=t.length-1;e>=0;e--)for(let s=0;s<t[e].length;s++)t[e][s]=new ue((s+e)%2===1?"light":"dark",{rank:e,file:s});return t},Q=new WeakSet,ie=function(t,e){return 0<=t&&t<this.board.length&&0<=e&&e<this.board[t].length};const U={canvasSize:900,canvasParent:"app",board:new Ce},J=document.getElementById("history"),Le=o=>{const{board:t}=U;let e=null,s=!1,n=o.createInput(t.fen,"text");n.style("width","100%"),n.elt.onchange=()=>{const g=new URL(location.href);g.searchParams.set("fen",t.fen),history.replaceState("","",g)},o.setup=()=>{o.createCanvas(U.canvasSize,U.canvasSize).parent(U.canvasParent),o.background(0,0,0);const r=new URL(location.href).searchParams.get("fen");t.loadPieces(),r&&(t.fen=r),n.elt.value=t.fen,n.input(p=>{t.fen=p.target.value}),o.createButton("Reset FEN").mouseClicked(()=>{t.fen="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",n.elt.value=t.fen,n.elt.onchange()})};const i=(g,r=!1)=>{const u=o.width,p=o.height,v=8;let M=g.file*u/v,L=(g.rank+7-g.rank*2)*p/v;return r&&(M+=u/(v*2),L+=p/(v*2)),[M,L]},a=(g,r)=>{if(g.pos){let u,p;if(r)u=r.x,p=r.y;else{const[v,M]=i(g.pos,!0);u=v,p=M}o.push(),o.fill(0,0,255),o.textSize(50),o.textAlign(o.CENTER,o.CENTER),o.text(g.unicodeChar,u,p),o.pop()}},h=(g,r,u,p)=>{o.fill(...u),o.square(g,r,o.width/8),o.fill(255,0,0),o.text(`${p.file}${p.rank}`,g,r+o.height/8)},f=(g,r=h)=>{const[u,p]=i(g.pos),v=g.shade==="dark"?[0,0,0]:[255,255,255],{rank:M,file:L}=g.chessPosition;o.push(),o.noStroke(),r(u,p,v,{rank:M,file:L}),o.pop()},k=g=>{g.forEach(r=>{r&&f(r)}),e&&e.piece&&(f(e,(r,u)=>{o.fill(0,0,120,175),o.square(r,u,o.width/8)}),e.piece.legalMoves.forEach(r=>{f(r,(u,p)=>{o.fill(0,255,0,150),r.piece&&!r.piece.canBeEaten&&o.fill(255,0,0,150),o.square(u,p,o.width/8)})})),g.pieces.forEach(r=>{r===(e==null?void 0:e.piece)&&s?a(r,{x:o.mouseX,y:o.mouseY}):a(r)})},d=g=>{const[r,u]=i(g.pos);return[o.mouseX>=r&&o.mouseX<=r+o.width/8&&o.mouseY>=u&&o.mouseY<=u+o.height/8,r,u]},K=()=>{var g;(g=e==null?void 0:e.piece)==null||g.legalMoves.forEach(r=>{const[u]=d(r);if(u){t.movePiece(r.pos,e.piece),e=null;const p=document.createElement("tr"),v=document.createElement("th"),M=document.createElement("th");M.textContent=t.history.length.toString(),v.textContent=t.history[t.history.length-1].an,p.appendChild(M),p.appendChild(v),J==null||J.appendChild(p),n.elt.value=t.fen,n.elt.onchange()}}),t.forEach(r=>{r&&d(r)[0]&&(e=r)})};o.mousePressed=()=>{switch(o.mouseButton){case o.LEFT:K();break}},o.mouseDragged=()=>{switch(o.mouseButton){case o.LEFT:e&&e.piece?s=!0:K();break}},o.mouseReleased=()=>{s=!1,e&&K()},o.draw=()=>{k(t)}};new Te(Le);
