var oe=Object.defineProperty;var ae=(n,e,t)=>e in n?oe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>(ae(n,typeof e!="symbol"?e+"":e,t),t),F=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var Q=(n,e,t)=>(F(n,e,"read from private field"),t?t.call(n):e.get(n)),C=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},w=(n,e,t,s)=>(F(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);var S=(n,e,t)=>(F(n,e,"access private method"),t);import{v as he,p as re}from"./vendor.ada7163b.js";const ce=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};ce();var T;(function(n){n.LightKing="\u2654",n.LightQueen="\u2655",n.LightRook="\u2656",n.LightBishop="\u2657",n.LightKnight="\u2658",n.LightPawn="\u2659",n.DarkKing="\u265A",n.DarkQueen="\u265B",n.DarkRook="\u265C",n.DarkBishop="\u265D",n.DarkKnight="\u265E",n.DarkPawn="\u265F"})(T||(T={}));function z(n,e){var s;const t=this.shade==="dark"?n.lightKing:n.darkKing;if(t){let i=!1;for(const o of e)if(((s=o.piece)==null?void 0:s.uuid)===t.uuid){i=!0;break}i&&(this.pathToEnemyKing=e)}return e}var r;(function(n){n[n.NORTH=0]="NORTH",n[n.NE=1]="NE",n[n.EAST=2]="EAST",n[n.SE=3]="SE",n[n.SOUTH=4]="SOUTH",n[n.SW=5]="SW",n[n.WEST=6]="WEST",n[n.NW=7]="NW"})(r||(r={}));function J(n){switch(n){case r.NORTH:return{rank:1,file:0};case r.NE:return{rank:1,file:1};case r.EAST:return{rank:0,file:1};case r.SE:return{rank:-1,file:1};case r.SOUTH:return{rank:-1,file:0};case r.SW:return{rank:-1,file:-1};case r.WEST:return{rank:0,file:-1};case r.NW:return{rank:1,file:-1}}}function V(n,e){return b(this,n,e)}function Z(n,e){return b(this,n,e)}function b(n,e,t){var h,a;const s=[],i=J(e);let o=t.getSquare((h=n.pos)==null?void 0:h.rank,(a=n.pos)==null?void 0:a.file);for(;o&&(o=t.getSquare(o.pos.rank+i.rank,o.pos.file+i.file));)s.push(o);return s}class ee{constructor(e,t){l(this,"piece",null);l(this,"shade");l(this,"pos");l(this,"chessPosition");this.shade=e,this.pos=t,this.chessPosition=this.getChessPosition()}getChessPosition(){const t=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:t}}}var B,A,le;class N{constructor(e,t,s,i,o){C(this,A);l(this,"type");l(this,"shade");l(this,"pos");l(this,"unicodeChar");l(this,"fenChar");l(this,"defaultMoves",[]);l(this,"legalMoves",[]);l(this,"coverage",[]);l(this,"threatens",new Set);l(this,"threatenedBy",new Set);l(this,"protects",new Set);l(this,"protectedBy",new Set);l(this,"uuid",he());l(this,"myKingIsUnderCheck",!1);C(this,B,[]);l(this,"timesMoved",0);l(this,"canBeEaten",!0);this.type=e,this.shade=t,this.pos=i;const{unicode:h,fenChar:a}=S(this,A,le).call(this);this.unicodeChar=h,this.fenChar=a,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=o||[]}get initialSquares(){return Q(this,B)}set initialSquares(e){w(this,B,e)}getDefaultMoves(e){return[]}getLegalMoves(e){return[]}getCoverageMoves(e){return this.legalMoves}moveConditions(e){return!1}isMoveLegal(e){return this.legalMoves.includes(e)}threaten(){this.coverage.forEach(e=>{e.piece&&e.piece.shade!==this.shade&&(this.threatens.add(e.piece),e.piece.threatenedBy.add(this))})}doIIntersect(){const e=this.threatenedBy;for(const t of e)if(t.type==="Bishop"||t.type==="Queen"||t.type==="Rook"){const s=t;for(const i of s.pathToEnemyKing)if(i.piece===this)return!0}return!1}findMovesToProtectKing(e){const t=this.shade==="dark"?e.darkKing:e.lightKing;if(t&&t.threatenedBy.size<=1)for(const s of t.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(i=>{var o;return s.pathToEnemyKing.includes(i)||i.pos.rank===((o=s.pos)==null?void 0:o.rank)&&i.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(i=>{var o;return i.pos.rank===((o=s.pos)==null?void 0:o.rank)&&i.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(e,t,s){if(e instanceof ee){let i=!1;return e.piece?(i=!1,e.piece.shade!==this.shade?i=!0:(i=!1,this.protects.add(e.piece),e.piece.protectedBy.add(this))):i=!0,s&&(i=s()),i}else{const i=[];for(const o of e)if(!o.piece)i.push(o);else if(o.piece.shade!==this.shade){i.push(o);break}else{this.protects.add(o.piece),o.piece.protectedBy.add(this);break}return i}}move(e,t){var h,a,u,p,K,g,c,f,d,M;const s=t.getSquare(e.rank,e.file);if(!s)return;const i=s==null?void 0:s.piece;if(s&&!this.isMoveLegal(s)||i&&!(i!=null&&i.canBeEaten))return;if(this.pos&&t.setPiece(null,this.pos.rank,this.pos.file),i&&i.canBeEaten){const E=t.getPiece(e.rank,e.file);t.pieces=t.pieces.filter(k=>k!==E),t.setPiece(null,e.rank,e.file)}else if(this.type==="Pawn"){const E=this.shade==="dark"?-1:1,k=this;((a=(h=k.canTakeEnPassant)==null?void 0:h.pos)==null?void 0:a.file)===e.file&&k.canTakeEnPassant.pos.rank===e.rank-E&&(t.setPiece(null,k.canTakeEnPassant.pos.rank,k.canTakeEnPassant.pos.file),t.pieces=t.pieces.filter(v=>v!==k.canTakeEnPassant),k.canTakeEnPassant=null,k.timesEnPassant=k.timesEnPassant+1)}else if(this.type==="King"&&this.timesMoved===0){const E=this.legalMoves.find(v=>{var m,y;return v.pos.file===((m=this.pos)==null?void 0:m.file)+2&&v.pos.rank===((y=this.pos)==null?void 0:y.rank)}),k=this.legalMoves.find(v=>{var m,y;return v.pos.file===((m=this.pos)==null?void 0:m.file)-2&&v.pos.rank===((y=this.pos)==null?void 0:y.rank)});if(E){const v=t.getPiece((u=this.pos)==null?void 0:u.rank,((p=this.pos)==null?void 0:p.file)+3);v&&t.setPiece(v,(K=this.pos)==null?void 0:K.rank,((g=this.pos)==null?void 0:g.file)+1)}if(k){const v=t.getPiece((c=this.pos)==null?void 0:c.rank,((f=this.pos)==null?void 0:f.file)-4);t.setPiece(v,(d=this.pos)==null?void 0:d.rank,((M=this.pos)==null?void 0:M.file)-1)}}t.setPiece(this,e.rank,e.file),this.timesMoved++;let o=t.pieceHistory.get(this.uuid);t.pieceHistory.set(this.uuid,o+1),t.totalMoves++,t.history.push({uuid:this.uuid})}}B=new WeakMap,A=new WeakSet,le=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:T.DarkKing,fenChar:"k"};case"Queen":return{unicode:T.DarkQueen,fenChar:"q"};case"Rook":return{unicode:T.DarkRook,fenChar:"r"};case"Bishop":return{unicode:T.DarkBishop,fenChar:"b"};case"Knight":return{unicode:T.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:T.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:T.LightKing,fenChar:"K"};case"Queen":return{unicode:T.LightQueen,fenChar:"Q"};case"Rook":return{unicode:T.LightRook,fenChar:"R"};case"Bishop":return{unicode:T.LightBishop,fenChar:"B"};case"Knight":return{unicode:T.LightKnight,fenChar:"N"};case"Pawn":return{unicode:T.LightPawn,fenChar:"P"}}}};class te extends N{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:0},{rank:i,file:7}];super("Rook",e,t,s,o);l(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,t){return[]}straightMove(e,t){return[]}getLegalMoves(e){const t=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.NORTH,e))),s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.EAST,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.SOUTH,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.WEST,e)));return[...t,...s,...i,...o]}getDefaultMoves(e){const t=this.straightMove(r.NORTH,e),s=this.straightMove(r.EAST,e),i=this.straightMove(r.SOUTH,e),o=this.straightMove(r.WEST,e);return[...t,...s,...i,...o]}}Object.assign(te.prototype,{straightMove:Z,getPathToEnemyKing:z});class se extends N{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:2},{rank:i,file:5}];super("Bishop",e,t,s,o);l(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,t){return[]}diagonalMove(e,t){return[]}getLegalMoves(e){const t=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.NE,e))),s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.SE,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.SW,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.NW,e)));return[...t,...s,...i,...o]}getDefaultMoves(e){const t=this.diagonalMove(r.NE,e),s=this.diagonalMove(r.SE,e),i=this.diagonalMove(r.SW,e),o=this.diagonalMove(r.NW,e);return[...t,...s,...i,...o]}}Object.assign(se.prototype,{diagonalMove:V,getPathToEnemyKing:z});var x,ge,I,fe;class $ extends N{constructor(e,t,s){const o=[{rank:e==="dark"?7:0,file:4}];super("King",e,t,s,o);C(this,x);C(this,I);this.canBeEaten=!1}getLegalMoves(e){const t=this.shade==="dark"?e.lightCoverage:e.darkCoverage,s=[];return this.defaultMoves.forEach(i=>{this.checkMoveLegality(i)&&!t.has(i)&&!S(this,x,ge).call(this,i.piece)&&!S(this,I,fe).call(this,i)&&s.push(i)}),s}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var i,o,h,a,u,p,K,g,c,f,d,M,E,k;const t=[],s=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let v=0;v<8;v++){const m=J(r[s[v]]),y=e.getSquare(((i=this.pos)==null?void 0:i.rank)+m.rank,((o=this.pos)==null?void 0:o.file)+m.file);y&&t.push(y)}if(this.timesMoved===0){const v=e.getPiece((h=this.pos)==null?void 0:h.rank,((a=this.pos)==null?void 0:a.file)+3),m=e.getPiece((u=this.pos)==null?void 0:u.rank,((p=this.pos)==null?void 0:p.file)-4);if(v&&v.type==="Rook"&&v.shade===this.shade){let y=!0;for(let P=1;P<3;P++)if(e.getPiece((K=this.pos)==null?void 0:K.rank,((g=this.pos)==null?void 0:g.file)+P)){y=!1;break}if(y){const P=e.getSquare((c=this.pos)==null?void 0:c.rank,((f=this.pos)==null?void 0:f.file)+2);P&&t.push(P)}}if(m&&m.type==="Rook"&&m.shade===this.shade){let y=!0;for(let P=1;P<4;P++)if(e.getPiece((d=this.pos)==null?void 0:d.rank,((M=this.pos)==null?void 0:M.file)-P)){y=!1;break}if(y){const P=e.getSquare((E=this.pos)==null?void 0:E.rank,((k=this.pos)==null?void 0:k.file)-2);P&&t.push(P)}}}return t}}x=new WeakSet,ge=function(e){return e?this.threatenedBy.has(e)&&e.protectedBy.size>0:!1},I=new WeakSet,fe=function(e){for(const t of this.threatenedBy)if("getPathToEnemyKing"in t)return t.pathToEnemyKing.includes(e);return!1};class ie extends N{constructor(e,t,s){const o=[{rank:e==="dark"?7:0,file:3}];super("Queen",e,t,s,o);l(this,"pathToEnemyKing",[])}diagonalMove(e,t){return[]}straightMove(e,t){return[]}getPathToEnemyKing(e,t){return[]}getLegalMoves(e){const t=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.NORTH,e)),e),s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.EAST,e)),e),i=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.SOUTH,e)),e),o=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.WEST,e)),e),h=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.NE,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.SE,e)),e),u=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.SW,e)),e),p=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.NW,e)),e);return[...t,...h,...s,...a,...i,...u,...o,...p]}getDefaultMoves(e){const t=this.straightMove(r.NORTH,e),s=this.straightMove(r.EAST,e),i=this.straightMove(r.SOUTH,e),o=this.straightMove(r.WEST,e),h=this.diagonalMove(r.NE,e),a=this.diagonalMove(r.SE,e),u=this.diagonalMove(r.SW,e),p=this.diagonalMove(r.NW,e);return[...t,...h,...s,...a,...i,...u,...o,...p]}}Object.assign(ie.prototype,{diagonalMove:V,straightMove:Z,getPathToEnemyKing:z});class ue extends N{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:1},{rank:i,file:6}];super("Knight",e,t,s,o)}getDefaultMoves(e){const t=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(i=>{const o=e.getSquare(this.pos.rank+i[0],this.pos.file+i[1]);o&&t.push(o)}),t}getLegalMoves(e){const t=this.defaultMoves,s=[];return t.forEach(i=>{i&&this.checkMoveLegality(i)&&s.push(i)}),s}}var W,_;const D=class extends N{constructor(e,t,s){const i=e==="light"?1:6,h=[0,1,2,3,4,5,6,7].map(a=>({rank:i,file:a}));super("Pawn",e,t,s,h);C(this,W);l(this,"canTakeEnPassant",null);l(this,"timesEnPassant",0)}getLegalMoves(e){const t=this.defaultMoves,s=[];return t.forEach(i=>{i&&this.checkMoveLegality(i,e,()=>this.moveConditions(i))&&s.push(i)}),s}moveConditions(e){var s,i,o,h,a,u;const t=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-t===((s=this.canTakeEnPassant.pos)==null?void 0:s.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((i=this.pos)==null?void 0:i.rank)+t||e.pos.rank===((o=this.pos)==null?void 0:o.rank)+t*2?e.pos.rank!==((h=this.pos)==null?void 0:h.rank)+t*2&&(e.pos.file===((a=this.pos)==null?void 0:a.file)+t||e.pos.file===((u=this.pos)==null?void 0:u.file)-t)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const t=this.shade==="light"?1:-1;return this.defaultMoves.filter(s=>{var i,o;return!(s.pos.file===((i=this.pos)==null?void 0:i.file)&&(s.pos.rank===((o=this.pos)==null?void 0:o.rank)+t||s.pos.rank===this.pos.rank+t*2))})}getDefaultMoves(e){const t=[];if(this.pos){this.canTakeEnPassant=null;const s=this.shade==="light"?1:-1,i=e.getSquare(this.pos.rank+s,this.pos.file),o=e.getSquare(this.pos.rank+s*2,this.pos.file),h=e.getSquare(this.pos.rank+s,this.pos.file+s),a=e.getSquare(this.pos.rank+s,this.pos.file-s);if(i&&!(i!=null&&i.piece)&&(t.push(i),this.timesMoved===0&&this.initialSquares.find(u=>{var p,K;return u.rank===((p=this.pos)==null?void 0:p.rank)&&u.file===((K=this.pos)==null?void 0:K.file)})&&o&&!(o!=null&&o.piece)&&t.push(o)),h&&t.push(h),a&&t.push(a),this.timesEnPassant===0){const u=e.getSquare(this.pos.rank,this.pos.file+s),p=e.getSquare(this.pos.rank,this.pos.file-s);h&&!h.piece&&u&&u.piece instanceof D&&S(this,W,_).call(this,u.piece,e)&&(t.includes(h)||t.push(h)),a&&!a.piece&&p&&p.piece instanceof D&&S(this,W,_).call(this,p.piece,e)&&(t.includes(a)||t.push(a))}}return t}};let ne=D;W=new WeakSet,_=function(e,t){return e.timesMoved===1&&t.history[t.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,console.log(e),!0):!1};var L,q,j,R,X,O,Y,H,G;class pe{constructor(e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){C(this,q);C(this,R);C(this,O);C(this,H);l(this,"board");C(this,L,void 0);l(this,"pieces",[]);l(this,"lightKing",null);l(this,"darkKing",null);l(this,"darkCoverage",new Set);l(this,"lightCoverage",new Set);l(this,"pieceHistory",new Map);l(this,"totalMoves",0);l(this,"whoWon",null);l(this,"history",[]);this.board=S(this,O,Y).call(this),w(this,L,e)}get fen(){return Q(this,L)}set fen(e){this.legalFEN(e)&&(w(this,L,e),this.emptyBoard(),this.loadPieces())}legalFEN(e){let t=0,s=0;for(const i of e){const o=parseInt(i);i==="/"?t++:isNaN(o)?s++:s+=o}return t===7&&s===64}emptyBoard(){this.board=S(this,O,Y).call(this)}loadPieces(e){e&&this.legalFEN(e)&&(this.fen=e);let t=this.board.length-1,s=0,i=0,o="";for(;t>=0&&(o=this.fen[i]);){const h=parseInt(o);if(o==="/")t--,s=0;else if(isNaN(h)){let a=null;switch(o){case"K":this.lightKing=a=new $("light",this);break;case"k":this.darkKing=a=new $("dark",this);break;case"Q":case"q":a=new ie(o==="q"?"dark":"light",this);break;case"R":case"r":a=new te(o==="r"?"dark":"light",this);break;case"N":case"n":a=new ue(o==="n"?"dark":"light",this);break;case"B":case"b":a=new se(o==="b"?"dark":"light",this);break;case"P":case"p":a=new ne(o==="p"?"dark":"light",this);break}this.board[t][s].piece=a,a&&(a.pos=this.board[t][s].pos,this.pieces.push(a),this.pieceHistory.set(a.uuid,0)),s++}else s+=h;i++}S(this,q,j).call(this)}getKing(e){return this.pieces.find(s=>s.shade===e&&s.type==="King")||null}generateFEN(){let e="",t=0;return this.forEach((s,i,o)=>{!s||!s.piece?t++:(t>0&&(e+=t,t=0),e+=s.piece.fenChar),o===this.board[i].length-1&&(t>0&&(e+=t,t=0),i!=0&&(e+="/"))}),e}forEach(e){for(let t=this.board.length-1;t>=0;t--)for(let s=0;s<this.board[t].length;s++)e(this.getSquare(t,s),t,s)}setPiece(e,t,s){return S(this,H,G).call(this,t,s)?(this.board[t][s].piece=e,e&&(e.pos=this.board[t][s].pos),w(this,L,this.generateFEN()),!0):!1}getPiece(e,t){const s=this.getSquare(e,t);return s?s.piece:null}getSquare(e,t){return S(this,H,G).call(this,e,t)?this.board[e][t]:null}movePiece(e,t){t&&(t.move(e,this),S(this,q,j).call(this))}displayInConsole(){const e="\u2502",t="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",i="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",o=["a","b","c","d","e","f","g","h"];for(let h=this.board.length-1;h>=0;h--){let a=`${h+1} ${e} `;for(let u=0;u<this.board[h].length;u++){const p=this.getPiece(h,u);p?a+=p.unicodeChar:a+=" ",a+=` ${e} `}console.log(h===7?t:s),console.log(a),h===0&&console.log(i)}console.log(`  ${e} `+o.join(` ${e} `)+` ${e}`)}}L=new WeakMap,q=new WeakSet,j=function(){console.table(this.history),this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(e=>{e.threatenedBy.clear(),e.threatens.clear(),e.protects.clear(),e.protectedBy.clear(),e.myKingIsUnderCheck=!1,"pathToEnemyKing"in e&&(e.pathToEnemyKing=[])}),this.pieces.forEach(e=>{e.defaultMoves=e.getDefaultMoves(this),e.legalMoves=e.getLegalMoves(this),e.coverage=e.getCoverageMoves(this),e.threaten()}),this.pieces.forEach(e=>{e.doIIntersect()&&e.threatenedBy.forEach(t=>{e.legalMoves=e.legalMoves.filter(s=>s.piece===t)}),e.shade==="light"?e.coverage.forEach(t=>this.lightCoverage.add(t)):e.coverage.forEach(t=>this.darkCoverage.add(t))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.isUnderCheck&&S(this,R,X).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.isUnderCheck&&S(this,R,X).call(this,this.lightKing)),this.darkCoverage.size===0&&(this.whoWon="light"),this.lightCoverage.size===0&&(this.whoWon="dark")},R=new WeakSet,X=function(e){const t=e.shade==="dark"?this.darkCoverage:this.lightCoverage;this.pieces.forEach(s=>{s.shade===e.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this))}),t.clear(),this.pieces.forEach(s=>{s.shade===e.shade&&s.coverage.forEach(i=>{t.add(i)})})},O=new WeakSet,Y=function(){const e=new Array(8);for(let t=0;t<e.length;t++)e[t]=new Array(8);for(let t=e.length-1;t>=0;t--)for(let s=0;s<e[t].length;s++)e[t][s]=new ee((s+t)%2===1?"light":"dark",{rank:t,file:s});return e},H=new WeakSet,G=function(e,t){return 0<=e&&e<this.board.length&&0<=t&&t<this.board[e].length};const U={canvasSize:900,canvasParent:"app"},ke=n=>{const e=new pe;let t=null,s=!1;n.setup=()=>{n.createCanvas(U.canvasSize,U.canvasSize).parent(U.canvasParent),n.background(0,0,0);let c=n.createInput(e.fen,"text");e.loadPieces(),c.input(f=>{n.background(0,0,0),n.clear(),e.fen=f.target.value})};const i=(g,c=!1)=>{const f=n.width,d=n.height,M=8;let E=g.file*f/M,k=(g.rank+7-g.rank*2)*d/M;return c&&(E+=f/(M*2),k+=d/(M*2)),[E,k]},o=(g,c)=>{if(g.pos){let f,d;if(c)f=c.x,d=c.y;else{const[M,E]=i(g.pos,!0);f=M,d=E}n.push(),n.fill(0,0,255),n.textSize(50),n.textAlign(n.CENTER,n.CENTER),n.text(g.unicodeChar,f,d),n.pop()}},h=(g,c,f,d)=>{n.fill(...f),n.square(g,c,n.width/8),n.fill(255,0,0),n.text(`${d.file}${d.rank}`,g,c+n.height/8)},a=(g,c=h)=>{const[f,d]=i(g.pos),M=g.shade==="dark"?[0,0,0]:[255,255,255],{rank:E,file:k}=g.chessPosition;n.push(),n.noStroke(),c(f,d,M,{rank:E,file:k}),n.pop()},u=g=>{g.forEach(c=>{c&&a(c)}),t&&t.piece&&(a(t,(c,f)=>{n.fill(0,0,120,175),n.square(c,f,n.width/8)}),t.piece.legalMoves.forEach(c=>{a(c,(f,d)=>{n.fill(0,255,0,150),c.piece&&!c.piece.canBeEaten&&n.fill(255,0,0,150),n.square(f,d,n.width/8)})})),g.pieces.forEach(c=>{c===(t==null?void 0:t.piece)&&s?o(c,{x:n.mouseX,y:n.mouseY}):o(c)})},p=g=>{const[c,f]=i(g.pos);return[n.mouseX>=c&&n.mouseX<=c+n.width/8&&n.mouseY>=f&&n.mouseY<=f+n.height/8,c,f]},K=()=>{var g;(g=t==null?void 0:t.piece)==null||g.legalMoves.forEach(c=>{const[f]=p(c);f&&(e.movePiece(c.pos,t.piece),t=null)}),e.forEach(c=>{c&&p(c)[0]&&(t=c)})};n.mousePressed=()=>{switch(n.mouseButton){case n.LEFT:K();break}},n.mouseDragged=()=>{switch(n.mouseButton){case n.LEFT:t&&t.piece?s=!0:K();break}},n.mouseReleased=()=>{s=!1,t&&K()},n.draw=()=>{u(e)}};new re(ke);
