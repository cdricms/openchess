var Qe=Object.defineProperty;var Se=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var te=(i,t,e)=>t in i?Qe(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,G=(i,t)=>{for(var e in t||(t={}))Ue.call(t,e)&&te(i,e,t[e]);if(Se)for(var e of Se(t))je.call(t,e)&&te(i,e,t[e]);return i};var h=(i,t,e)=>(te(i,typeof t!="symbol"?t+"":t,e),e),se=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var ie=(i,t,e)=>(se(i,t,"read from private field"),e?e.call(i):t.get(i)),$=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},I=(i,t,e,s)=>(se(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);var w=(i,t,e)=>(se(i,t,"access private method"),e);import{v as Be,t as ne,S as me,i as ye,s as Ee,e as N,a as X,b as q,c as W,d as b,f as E,g as ae,n as Te,h as ee,j as re,m as oe,k as he,l as le,o as ce,p as Ge,q as Ke,r as we,u as Xe,w as Ye}from"./vendor.0a061c33.js";const Je=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}};Je();var C;(function(i){i.LightKing="\u2654",i.LightQueen="\u2655",i.LightRook="\u2656",i.LightBishop="\u2657",i.LightKnight="\u2658",i.LightPawn="\u2659",i.DarkKing="\u265A",i.DarkQueen="\u265B",i.DarkRook="\u265C",i.DarkBishop="\u265D",i.DarkKnight="\u265E",i.DarkPawn="\u265F"})(C||(C={}));function Me(i,t){var s;const e=this.shade==="dark"?i.lightKing:i.darkKing;if(e){let a=!1;for(const n of t)if(((s=n.piece)==null?void 0:s.uuid)===e.uuid){a=!0;break}a&&(this.pathToEnemyKing=t)}return t}var f;(function(i){i[i.NORTH=0]="NORTH",i[i.NE=1]="NE",i[i.EAST=2]="EAST",i[i.SE=3]="SE",i[i.SOUTH=4]="SOUTH",i[i.SW=5]="SW",i[i.WEST=6]="WEST",i[i.NW=7]="NW"})(f||(f={}));function We(i){switch(i){case f.NORTH:return{rank:1,file:0};case f.NE:return{rank:1,file:1};case f.EAST:return{rank:0,file:1};case f.SE:return{rank:-1,file:1};case f.SOUTH:return{rank:-1,file:0};case f.SW:return{rank:-1,file:-1};case f.WEST:return{rank:0,file:-1};case f.NW:return{rank:1,file:-1}}}function qe(i,t){return Re(this,i,t)}function Oe(i,t){return Re(this,i,t)}function Re(i,t,e){var r,o;const s=[],a=We(t);let n=e.getSquare((r=i.pos)==null?void 0:r.rank,(o=i.pos)==null?void 0:o.file);for(;n&&(n=e.getSquare(n.pos.rank+a.rank,n.pos.file+a.file));)s.push(n);return s}class He{constructor(t,e){h(this,"piece",null);h(this,"shade");h(this,"pos");h(this,"chessPosition");this.shade=t,this.pos=e,this.chessPosition=this.getChessPosition()}getChessPosition(){const e=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:e}}}var x,Y,De;class H{constructor(t,e,s,a,n){$(this,Y);h(this,"type");h(this,"shade");h(this,"pos");h(this,"unicodeChar");h(this,"fenChar");h(this,"defaultMoves",[]);h(this,"legalMoves",[]);h(this,"coverage",[]);h(this,"threatens",new Set);h(this,"threatenedBy",new Set);h(this,"protects",new Set);h(this,"protectedBy",new Set);h(this,"uuid",Be());h(this,"myKingIsUnderCheck",!1);$(this,x,[]);h(this,"timesMoved",0);h(this,"canBeEaten",!0);this.type=t,this.shade=e,this.pos=a;const{unicode:r,fenChar:o}=w(this,Y,De).call(this);this.unicodeChar=r,this.fenChar=o,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=n||[]}get initialSquares(){return ie(this,x)}set initialSquares(t){I(this,x,t)}getDefaultMoves(t){return[]}getLegalMoves(t){return[]}getCoverageMoves(t){return this.legalMoves}moveConditions(t){return!1}isMoveLegal(t){return this.legalMoves.includes(t)}threaten(){this.coverage.forEach(t=>{t.piece&&t.piece.shade!==this.shade&&(this.threatens.add(t.piece),t.piece.threatenedBy.add(this))})}doIIntersect(){const t=this.threatenedBy;for(const e of t)if(e.type==="Bishop"||e.type==="Queen"||e.type==="Rook"){const s=e;for(const a of s.pathToEnemyKing)if(a.piece===this)return!0}return!1}findMovesToProtectKing(t){const e=this.shade==="dark"?t.darkKing:t.lightKing;if(e&&e.threatenedBy.size<=1)for(const s of e.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(a=>{var n;return s.pathToEnemyKing.includes(a)||a.pos.rank===((n=s.pos)==null?void 0:n.rank)&&a.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(a=>{var n;return a.pos.rank===((n=s.pos)==null?void 0:n.rank)&&a.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(t,e,s){if(t instanceof He){let a=!1;return t.piece?(a=!1,t.piece.shade!==this.shade?a=!0:(a=!1,this.protects.add(t.piece),t.piece.protectedBy.add(this))):a=!0,s&&(a=s()),a}else{const a=[];for(const n of t)if(!n.piece)a.push(n);else if(n.piece.shade!==this.shade){a.push(n);break}else{this.protects.add(n.piece),n.piece.protectedBy.add(this);break}return a}}move(t,e){var u,p,g,l,c,k,m,v,d,M,_,L,y,K,S,Pe;let s=`${this.type==="Pawn"?"":this.fenChar.toUpperCase()}`;const a=this.shade==="dark"?-1:1,n=e.getSquare(t.rank,t.file);if(!n)return!1;const r=n==null?void 0:n.piece;if(n&&!this.isMoveLegal(n)||r&&!(r!=null&&r.canBeEaten))return!1;if(this.pos&&e.setPiece(null,this.pos.rank,this.pos.file),r&&r.canBeEaten){const T=e.getPiece(t.rank,t.file);e.pieces=e.pieces.filter(O=>O!==T),e.setPiece(null,t.rank,t.file),s+=`x${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank}`}else if(this.type==="Pawn"){const T=this;if(((p=(u=T.canTakeEnPassant)==null?void 0:u.pos)==null?void 0:p.file)===t.file&&T.canTakeEnPassant.pos.rank===t.rank-a){const O=e.getSquare((g=T.pos)==null?void 0:g.rank,(l=T.pos)==null?void 0:l.file);e.setPiece(null,T.canTakeEnPassant.pos.rank,T.canTakeEnPassant.pos.file),e.pieces=e.pieces.filter(P=>P!==T.canTakeEnPassant),T.canTakeEnPassant=null,T.timesEnPassant=T.timesEnPassant+1,s=`${O==null?void 0:O.chessPosition.file.toLowerCase()}x${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank} e.p`}else s=`${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank}`}else if(this.type==="King"&&this.timesMoved===0){const T=this.legalMoves.find(P=>{var D,A;return P.pos.file===((D=this.pos)==null?void 0:D.file)+2&&P.pos.rank===((A=this.pos)==null?void 0:A.rank)}),O=this.legalMoves.find(P=>{var D,A;return P.pos.file===((D=this.pos)==null?void 0:D.file)-2&&P.pos.rank===((A=this.pos)==null?void 0:A.rank)});if(T||O){if(T){const P=e.getPiece((c=this.pos)==null?void 0:c.rank,((k=this.pos)==null?void 0:k.file)+3);P&&(e.setPiece(null,(m=P.pos)==null?void 0:m.rank,(v=P.pos)==null?void 0:v.file),e.setPiece(P,(d=this.pos)==null?void 0:d.rank,((M=this.pos)==null?void 0:M.file)+1),s="O-O")}if(O){const P=e.getPiece((_=this.pos)==null?void 0:_.rank,((L=this.pos)==null?void 0:L.file)-4);P&&(e.setPiece(null,(y=P.pos)==null?void 0:y.rank,(K=P.pos)==null?void 0:K.file),e.setPiece(P,(S=this.pos)==null?void 0:S.rank,((Pe=this.pos)==null?void 0:Pe.file)-1),s="O-O-O")}}else s+=`${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank}`}else s+=`${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank}`;e.setPiece(this,t.rank,t.file),this.timesMoved++;let o=e.pieceHistory.get(this.uuid);return e.pieceHistory.set(this.uuid,o+1),e.totalMoves++,e.history.push({uuid:this.uuid,an:s}),!0}}x=new WeakMap,Y=new WeakSet,De=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:C.DarkKing,fenChar:"k"};case"Queen":return{unicode:C.DarkQueen,fenChar:"q"};case"Rook":return{unicode:C.DarkRook,fenChar:"r"};case"Bishop":return{unicode:C.DarkBishop,fenChar:"b"};case"Knight":return{unicode:C.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:C.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:C.LightKing,fenChar:"K"};case"Queen":return{unicode:C.LightQueen,fenChar:"Q"};case"Rook":return{unicode:C.LightRook,fenChar:"R"};case"Bishop":return{unicode:C.LightBishop,fenChar:"B"};case"Knight":return{unicode:C.LightKnight,fenChar:"N"};case"Pawn":return{unicode:C.LightPawn,fenChar:"P"}}}};class Ae extends H{constructor(e,s,a){const n=e==="dark"?7:0;super("Rook",e,s,a,[{rank:n,file:0},{rank:n,file:7}]);h(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}straightMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(f.NORTH,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(f.EAST,e))),n=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(f.SOUTH,e))),r=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(f.WEST,e)));return[...s,...a,...n,...r]}getDefaultMoves(e){const s=this.straightMove(f.NORTH,e),a=this.straightMove(f.EAST,e),n=this.straightMove(f.SOUTH,e),r=this.straightMove(f.WEST,e);return[...s,...a,...n,...r]}}Object.assign(Ae.prototype,{straightMove:Oe,getPathToEnemyKing:Me});class Ie extends H{constructor(e,s,a){const n=e==="dark"?7:0;super("Bishop",e,s,a,[{rank:n,file:2},{rank:n,file:5}]);h(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}diagonalMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(f.NE,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(f.SE,e))),n=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(f.SW,e))),r=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(f.NW,e)));return[...s,...a,...n,...r]}getDefaultMoves(e){const s=this.diagonalMove(f.NE,e),a=this.diagonalMove(f.SE,e),n=this.diagonalMove(f.SW,e),r=this.diagonalMove(f.NW,e);return[...s,...a,...n,...r]}}Object.assign(Ie.prototype,{diagonalMove:qe,getPathToEnemyKing:Me});var J,xe,V,ze;class Ce extends H{constructor(e,s,a){super("King",e,s,a,[{rank:e==="dark"?7:0,file:4}]);$(this,J);$(this,V);this.canBeEaten=!1}getLegalMoves(e){const s=this.shade==="dark"?e.lightCoverage:e.darkCoverage,a=[];return this.defaultMoves.forEach(n=>{this.checkMoveLegality(n)&&!s.has(n)&&!w(this,J,xe).call(this,n.piece)&&!w(this,V,ze).call(this,n)&&a.push(n)}),a}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var n,r,o,u,p,g,l,c,k,m,v,d,M,_;const s=[],a=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let L=0;L<8;L++){const y=We(f[a[L]]),K=e.getSquare(((n=this.pos)==null?void 0:n.rank)+y.rank,((r=this.pos)==null?void 0:r.file)+y.file);K&&s.push(K)}if(this.timesMoved===0){const L=e.getPiece((o=this.pos)==null?void 0:o.rank,((u=this.pos)==null?void 0:u.file)+3),y=e.getPiece((p=this.pos)==null?void 0:p.rank,((g=this.pos)==null?void 0:g.file)-4);if(L&&L.type==="Rook"&&L.shade===this.shade){let K=!0;for(let S=1;S<3;S++)if(e.getPiece((l=this.pos)==null?void 0:l.rank,((c=this.pos)==null?void 0:c.file)+S)){K=!1;break}if(K){const S=e.getSquare((k=this.pos)==null?void 0:k.rank,((m=this.pos)==null?void 0:m.file)+2);S&&s.push(S)}}if(y&&y.type==="Rook"&&y.shade===this.shade){let K=!0;for(let S=1;S<4;S++)if(e.getPiece((v=this.pos)==null?void 0:v.rank,((d=this.pos)==null?void 0:d.file)-S)){K=!1;break}if(K){const S=e.getSquare((M=this.pos)==null?void 0:M.rank,((_=this.pos)==null?void 0:_.file)-2);S&&s.push(S)}}}return s}}J=new WeakSet,xe=function(e){return e?this.threatenedBy.has(e)&&e.protectedBy.size>0:!1},V=new WeakSet,ze=function(e){for(const s of this.threatenedBy)if("getPathToEnemyKing"in s)return s.pathToEnemyKing.includes(e);return!1};class ge extends H{constructor(e,s,a){super("Queen",e,s,a,[{rank:e==="dark"?7:0,file:3}]);h(this,"pathToEnemyKing",[])}diagonalMove(e,s){return[]}straightMove(e,s){return[]}getPathToEnemyKing(e,s){return[]}getLegalMoves(e){const s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(f.NORTH,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(f.EAST,e)),e),n=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(f.SOUTH,e)),e),r=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(f.WEST,e)),e),o=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(f.NE,e)),e),u=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(f.SE,e)),e),p=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(f.SW,e)),e),g=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(f.NW,e)),e);return[...s,...o,...a,...u,...n,...p,...r,...g]}getDefaultMoves(e){const s=this.straightMove(f.NORTH,e),a=this.straightMove(f.EAST,e),n=this.straightMove(f.SOUTH,e),r=this.straightMove(f.WEST,e),o=this.diagonalMove(f.NE,e),u=this.diagonalMove(f.SE,e),p=this.diagonalMove(f.SW,e),g=this.diagonalMove(f.NW,e);return[...s,...o,...a,...u,...n,...p,...r,...g]}}Object.assign(ge.prototype,{diagonalMove:qe,straightMove:Oe,getPathToEnemyKing:Me});class Ve extends H{constructor(t,e,s){const a=t==="dark"?7:0,n=[{rank:a,file:1},{rank:a,file:6}];super("Knight",t,e,s,n)}getDefaultMoves(t){const e=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(a=>{const n=t.getSquare(this.pos.rank+a[0],this.pos.file+a[1]);n&&e.push(n)}),e}getLegalMoves(t){const e=this.defaultMoves,s=[];return e.forEach(a=>{a&&this.checkMoveLegality(a)&&s.push(a)}),s}}var z,fe;const Z=class extends H{constructor(e,s,a){const n=e==="light"?1:6,o=[0,1,2,3,4,5,6,7].map(u=>({rank:n,file:u}));super("Pawn",e,s,a,o);$(this,z);h(this,"canTakeEnPassant",null);h(this,"timesEnPassant",0)}getLegalMoves(e){const s=this.defaultMoves,a=[];return s.forEach(n=>{n&&this.checkMoveLegality(n,e,()=>this.moveConditions(n))&&a.push(n)}),a}moveConditions(e){var a,n,r,o,u,p;const s=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-s===((a=this.canTakeEnPassant.pos)==null?void 0:a.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((n=this.pos)==null?void 0:n.rank)+s||e.pos.rank===((r=this.pos)==null?void 0:r.rank)+s*2?e.pos.rank!==((o=this.pos)==null?void 0:o.rank)+s*2&&(e.pos.file===((u=this.pos)==null?void 0:u.file)+s||e.pos.file===((p=this.pos)==null?void 0:p.file)-s)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const s=this.shade==="light"?1:-1;return this.defaultMoves.filter(a=>{var n,r;return!(a.pos.file===((n=this.pos)==null?void 0:n.file)&&(a.pos.rank===((r=this.pos)==null?void 0:r.rank)+s||a.pos.rank===this.pos.rank+s*2))})}getDefaultMoves(e){const s=[];if(this.pos){this.canTakeEnPassant=null;const a=this.shade==="light"?1:-1,n=e.getSquare(this.pos.rank+a,this.pos.file),r=e.getSquare(this.pos.rank+a*2,this.pos.file),o=e.getSquare(this.pos.rank+a,this.pos.file+a),u=e.getSquare(this.pos.rank+a,this.pos.file-a);if(n&&!(n!=null&&n.piece)&&(s.push(n),this.timesMoved===0&&this.initialSquares.find(p=>{var g,l;return p.rank===((g=this.pos)==null?void 0:g.rank)&&p.file===((l=this.pos)==null?void 0:l.file)})&&r&&!(r!=null&&r.piece)&&s.push(r)),o&&s.push(o),u&&s.push(u),this.timesEnPassant===0){const p=e.getSquare(this.pos.rank,this.pos.file+a),g=e.getSquare(this.pos.rank,this.pos.file-a);o&&!o.piece&&p&&p.piece instanceof Z&&w(this,z,fe).call(this,p.piece,e)&&(s.includes(o)||s.push(o)),u&&!u.piece&&g&&g.piece instanceof Z&&w(this,z,fe).call(this,g.piece,e)&&(s.includes(u)||s.push(u))}}return s}};let ue=Z;z=new WeakSet,fe=function(e,s){return e.timesMoved===1&&s.history[s.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,console.log(e),!0):!1};var R,F,pe,Q,de,U,ke,j,ve;class Ze{constructor(t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){$(this,F);$(this,Q);$(this,U);$(this,j);h(this,"board");$(this,R,void 0);h(this,"pieces",[]);h(this,"lightKing",null);h(this,"darkKing",null);h(this,"darkCoverage",new Set);h(this,"lightCoverage",new Set);h(this,"pieceHistory",new Map);h(this,"totalMoves",0);h(this,"whoWon",null);h(this,"history",[]);h(this,"game",null);h(this,"strict",!0);this.board=w(this,U,ke).call(this),I(this,R,t)}get fen(){return ie(this,R)}set fen(t){this.legalFEN(t)&&(I(this,R,t),this.emptyBoard(),this.loadPieces())}legalFEN(t){let e=0,s=0;for(const a of t){const n=parseInt(a);a==="/"?e++:isNaN(n)?s++:s+=n}return e===7&&s===64}emptyBoard(){this.pieces=[],this.board=w(this,U,ke).call(this)}loadPieces(t){t&&this.legalFEN(t)&&(this.fen=t);let e=this.board.length-1,s=0,a=0,n="";for(;e>=0&&(n=this.fen[a]);){const r=parseInt(n);if(n==="/")e--,s=0;else if(isNaN(r)){let o=null;switch(n){case"K":this.lightKing=o=new Ce("light",this);break;case"k":this.darkKing=o=new Ce("dark",this);break;case"Q":case"q":o=new ge(n==="q"?"dark":"light",this);break;case"R":case"r":o=new Ae(n==="r"?"dark":"light",this);break;case"N":case"n":o=new Ve(n==="n"?"dark":"light",this);break;case"B":case"b":o=new Ie(n==="b"?"dark":"light",this);break;case"P":case"p":o=new ue(n==="p"?"dark":"light",this);break}this.board[e][s].piece=o,o&&(o.pos=this.board[e][s].pos,this.pieces.push(o),this.pieceHistory.set(o.uuid,0)),s++}else s+=r;a++}w(this,F,pe).call(this)}getKing(t){return this.pieces.find(s=>s.shade===t&&s.type==="King")||null}generateFEN(){let t="",e=0;return this.forEach((s,a,n)=>{!s||!s.piece?e++:(e>0&&(t+=e,e=0),t+=s.piece.fenChar),n===this.board[a].length-1&&(e>0&&(t+=e,e=0),a!=0&&(t+="/"))}),t}forEach(t){for(let e=this.board.length-1;e>=0;e--)for(let s=0;s<this.board[e].length;s++)t(this.getSquare(e,s),e,s)}setPiece(t,e,s){return w(this,j,ve).call(this,e,s)?(this.board[e][s].piece=t,t&&(t.pos=this.board[e][s].pos),I(this,R,this.generateFEN()),!0):!1}getPiece(t,e){const s=this.getSquare(t,e);return s?s.piece:null}getSquare(t,e){return w(this,j,ve).call(this,t,e)?this.board[t][e]:null}movePiece(t,e){var s,a,n,r,o;if(((s=this.game)==null?void 0:s.hasStarted)&&!((a=this.game)!=null&&a.isPaused)&&e){if(this.strict&&this.game&&e.shade!==this.game.currentPlayer.shade)return!1;const u=G({},e.pos),p=e.move(t,this);p&&(this.history.length===1&&this.game.start(),(n=this.game)==null||n.switch());const g=e.shade==="dark"?-1:1;if(e.type==="Pawn"&&t.rank===u.rank+g&&t.rank===(e.shade==="dark"?0:7)){const l=new ge(e.shade,this,e.pos);l.uuid=e.uuid,this.setPiece(l,(r=l.pos)==null?void 0:r.rank,(o=l.pos)==null?void 0:o.file),this.pieces=this.pieces.filter(c=>c!==e),this.pieces.push(l)}return w(this,F,pe).call(this),p}return!1}displayInConsole(){const t="\u2502",e="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",a="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",n=["a","b","c","d","e","f","g","h"];for(let r=this.board.length-1;r>=0;r--){let o=`${r+1} ${t} `;for(let u=0;u<this.board[r].length;u++){const p=this.getPiece(r,u);p?o+=p.unicodeChar:o+=" ",o+=` ${t} `}console.log(r===7?e:s),console.log(o),r===0&&console.log(a)}console.log(`  ${t} `+n.join(` ${t} `)+` ${t}`)}}R=new WeakMap,F=new WeakSet,pe=function(){this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(t=>{t.threatenedBy.clear(),t.threatens.clear(),t.protects.clear(),t.protectedBy.clear(),t.myKingIsUnderCheck=!1,"pathToEnemyKing"in t&&(t.pathToEnemyKing=[])}),this.pieces.forEach(t=>{t.defaultMoves=t.getDefaultMoves(this),t.legalMoves=t.getLegalMoves(this),t.coverage=t.getCoverageMoves(this),t.threaten()}),this.pieces.forEach(t=>{t.doIIntersect()&&t.threatenedBy.forEach(e=>{t.legalMoves=t.legalMoves.filter(s=>s.piece===e)}),t.shade==="light"?t.coverage.forEach(e=>this.lightCoverage.add(e)):t.coverage.forEach(e=>this.darkCoverage.add(e))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.isUnderCheck&&w(this,Q,de).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.isUnderCheck&&w(this,Q,de).call(this,this.lightKing)),this.darkCoverage.size===0&&(this.whoWon="light"),this.lightCoverage.size===0&&(this.whoWon="dark")},Q=new WeakSet,de=function(t){const e=t.shade==="dark"?this.darkCoverage:this.lightCoverage;this.pieces.forEach(s=>{s.shade===t.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this))}),e.clear(),this.pieces.forEach(s=>{s.shade===t.shade&&s.coverage.forEach(a=>{e.add(a)})})},U=new WeakSet,ke=function(){const t=new Array(8);for(let e=0;e<t.length;e++)t[e]=new Array(8);for(let e=t.length-1;e>=0;e--)for(let s=0;s<t[e].length;s++)t[e][s]=new He((s+e)%2===1?"light":"dark",{rank:e,file:s});return t},j=new WeakSet,ve=function(t,e){return 0<=t&&t<this.board.length&&0<=e&&e<this.board[t].length};class Le{constructor(t,e,s){h(this,"shade");h(this,"name","Default Name");h(this,"uuid",Be());h(this,"intervalID",null);h(this,"isPaused",!0);h(this,"game");h(this,"currentTime",ne.Duration.from({minutes:30}));h(this,"events",{ontimechanged(){}});this.shade=e,this.name=t,this.game=s,this.currentTime=ne.Duration.from(this.game.initialTime)}start(){return this.isPaused=!1,this.intervalID=setInterval(()=>{this.currentTime=this.currentTime.subtract({seconds:1}),this.events.ontimechanged(this.shade,this.currentTime)},1e3),this}pause(){return this.intervalID&&(clearInterval(this.intervalID),this.isPaused=!0),this}}class be{constructor(){h(this,"board");h(this,"initialTime",ne.Duration.from({minutes:30}));h(this,"light",new Le("light","light",this));h(this,"dark",new Le("dark","dark",this));h(this,"isPaused",!1);h(this,"hasStarted",!1);h(this,"currentPlayer",this.light);h(this,"events",{light:G({},this.light.events),dark:G({},this.dark.events)});this.board=new Ze,this.board.game=this}addLightPlayer(t){return this.light.name=t,this}addDarkPlayer(t){return this.dark.name=t,this}start(){return this.isPaused=!1,this.hasStarted=!0,this.currentPlayer.start(),this}pause(){return this.isPaused=!0,this.light.pause(),this.dark.pause(),this}reset(){return this.pause(),this}switch(){this.currentPlayer.pause(),this.currentPlayer=this.currentPlayer.shade==="dark"?this.light:this.dark,this.currentPlayer.start()}}const B={canvasSize:900,canvasParent:"app",game:new be},Fe={onpiecemove:(i,t,e)=>{}},et=i=>{const{board:t}=B.game;let e=null,s=!1;i.setup=()=>{i.createCanvas(B.canvasSize,B.canvasSize).parent(B.canvasParent),i.background(0,0,0),t.loadPieces()};const a=(l,c=!1)=>{const k=i.width,m=i.height,v=8;let d=l.file*k/v,M=(l.rank+7-l.rank*2)*m/v;return c&&(d+=k/(v*2),M+=m/(v*2)),[d,M]},n=(l,c)=>{if(l.pos){let k,m;if(c)k=c.x,m=c.y;else{const[v,d]=a(l.pos,!0);k=v,m=d}i.push(),i.fill(0,0,255),i.textSize(50),i.textAlign(i.CENTER,i.CENTER),i.text(l.unicodeChar,k,m),i.pop()}},r=(l,c,k,m)=>{i.fill(...k),i.square(l,c,i.width/8),i.fill(255,0,0),i.text(`${m.file}${m.rank}`,l,c+i.height/8)},o=(l,c=r)=>{const[k,m]=a(l.pos),v=l.shade==="dark"?[0,0,0]:[255,255,255],{rank:d,file:M}=l.chessPosition;i.push(),i.noStroke(),c(k,m,v,{rank:d,file:M}),i.pop()},u=l=>{l.forEach(c=>{c&&o(c)}),e&&e.piece&&(o(e,(c,k)=>{i.fill(0,0,120,175),i.square(c,k,i.width/8)}),e.piece.legalMoves.forEach(c=>{o(c,(k,m)=>{i.fill(0,255,0,150),c.piece&&!c.piece.canBeEaten&&i.fill(255,0,0,150),i.square(k,m,i.width/8)})})),l.pieces.forEach(c=>{c===(e==null?void 0:e.piece)&&s?n(c,{x:i.mouseX,y:i.mouseY}):n(c)})},p=l=>{const[c,k]=a(l.pos);return[i.mouseX>=c&&i.mouseX<=c+i.width/8&&i.mouseY>=k&&i.mouseY<=k+i.height/8,c,k]},g=()=>{var l;(l=e==null?void 0:e.piece)==null||l.legalMoves.forEach(c=>{const[k]=p(c);if(k){const m=e.piece;t.movePiece(c.pos,e.piece)&&(Fe.onpiecemove(m,c,B.game.board.history.length),e=null)}}),t.forEach(c=>{c&&p(c)[0]&&(e=c)})};i.mousePressed=()=>{switch(i.mouseButton){case i.LEFT:g();break}},i.mouseDragged=()=>{switch(i.mouseButton){case i.LEFT:e&&e.piece?s=!0:g();break}},i.mouseReleased=()=>{s=!1,e&&g()},i.draw=()=>{u(t)}};function tt(i){let t,e=i[0].name+"",s,a,n=`${i[1].minutes}:${i[1].seconds}`,r;return{c(){t=N("div"),s=X(e),a=q(),r=X(n),W(t,"id","player")},m(o,u){b(o,t,u),E(t,s),E(t,a),E(t,r)},p(o,[u]){u&1&&e!==(e=o[0].name+"")&&ae(s,e),u&2&&n!==(n=`${o[1].minutes}:${o[1].seconds}`)&&ae(r,n)},i:Te,o:Te,d(o){o&&ee(t)}}}function st(i,t,e){let s,{player:a}=t;return a.events.ontimechanged=(n,r)=>{e(1,s=r)},i.$$set=n=>{"player"in n&&e(0,a=n.player)},i.$$.update=()=>{i.$$.dirty&1&&e(1,s=a.currentTime)},[a,s]}class Ne extends me{constructor(t){super(),ye(this,t,st,tt,Ee,{player:0})}}function _e(i,t,e){const s=i.slice();return s[1]=t[e],s[3]=e,s}function $e(i){let t,e,s=i[3]+1+"",a,n,r,o=i[1].an+"",u,p;return{c(){t=N("tr"),e=N("td"),a=X(s),n=q(),r=N("td"),u=X(o),p=q()},m(g,l){b(g,t,l),E(t,e),E(e,a),E(t,n),E(t,r),E(r,u),E(t,p)},p(g,l){l&1&&o!==(o=g[1].an+"")&&ae(u,o)},d(g){g&&ee(t)}}}function it(i){let t,e,s,a,n,r,o,u,p,g,l,c,k;s=new Ne({props:{player:i[0].dark}}),o=new Ne({props:{player:i[0].light}});let m=i[0].board.history,v=[];for(let d=0;d<m.length;d+=1)v[d]=$e(_e(i,m,d));return{c(){t=N("section"),e=N("div"),re(s.$$.fragment),a=q(),n=N("div"),r=q(),re(o.$$.fragment),u=q(),p=N("div"),g=N("table"),l=N("tr"),l.innerHTML=`<th>Num. of Moves</th> 
        <th>Desc.</th>`,c=q();for(let d=0;d<v.length;d+=1)v[d].c();W(n,"id","game"),W(e,"id","game-wrapper"),W(e,"class","svelte-1xamruw"),W(g,"class","svelte-1xamruw"),W(p,"id","history"),W(p,"class","svelte-1xamruw"),W(t,"id","main"),W(t,"class","svelte-1xamruw")},m(d,M){b(d,t,M),E(t,e),oe(s,e,null),E(e,a),E(e,n),E(e,r),oe(o,e,null),E(t,u),E(t,p),E(p,g),E(g,l),E(g,c);for(let _=0;_<v.length;_+=1)v[_].m(g,null);k=!0},p(d,[M]){const _={};M&1&&(_.player=d[0].dark),s.$set(_);const L={};if(M&1&&(L.player=d[0].light),o.$set(L),M&1){m=d[0].board.history;let y;for(y=0;y<m.length;y+=1){const K=_e(d,m,y);v[y]?v[y].p(K,M):(v[y]=$e(K),v[y].c(),v[y].m(g,null))}for(;y<v.length;y+=1)v[y].d(1);v.length=m.length}},i(d){k||(he(s.$$.fragment,d),he(o.$$.fragment,d),k=!0)},o(d){le(s.$$.fragment,d),le(o.$$.fragment,d),k=!1},d(d){d&&ee(t),ce(s),ce(o),Ge(v,d)}}}function nt(i,t,e){let{game:s}=t;return i.$$set=a=>{"game"in a&&e(0,s=a.game)},[s]}class at extends me{constructor(t){super(),ye(this,t,nt,it,Ee,{game:0})}}function rt(i){let t,e,s,a,n,r,o,u,p;return e=new at({props:{game:i[1]}}),{c(){t=N("main"),re(e.$$.fragment),s=q(),a=N("button"),a.textContent="Start",n=q(),r=N("button"),r.textContent="Pause",Ke(t,"--game-height",i[0].canvasSize+"px"),W(t,"class","svelte-1910pwy")},m(g,l){b(g,t,l),oe(e,t,null),E(t,s),E(t,a),E(t,n),E(t,r),o=!0,u||(p=[we(a,"click",i[2]),we(r,"click",i[3])],u=!0)},p(g,[l]){const c={};l&2&&(c.game=g[1]),e.$set(c),(!o||l&1)&&Ke(t,"--game-height",g[0].canvasSize+"px")},i(g){o||(he(e.$$.fragment,g),o=!0)},o(g){le(e.$$.fragment,g),o=!1},d(g){g&&ee(t),ce(e),u=!1,Xe(p)}}}function ot(i,t,e){let s;const a=new URL(location.href);a.searchParams.get("fen")&&(B.game.board.fen=a.searchParams.get("fen")),B.canvasParent="game",B.canvasSize=700,Fe.onpiecemove=(o,u,p)=>{e(1,s=B.game)},new Ye(et);const n=o=>e(1,s.hasStarted=!0,s),r=o=>s.isPaused?s.start():s.pause();return i.$$.update=()=>{i.$$.dirty&1&&e(1,s=B.game)},[B,s,n,r]}class ht extends me{constructor(t){super(),ye(this,t,ot,rt,Ee,{})}}new ht({target:document.getElementById("app")});
