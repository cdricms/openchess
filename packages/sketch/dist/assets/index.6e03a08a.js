var te=Object.defineProperty;var se=(n,e,t)=>e in n?te(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>(se(n,typeof e!="symbol"?e+"":e,t),t),A=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var x=(n,e,t)=>(A(n,e,"read from private field"),t?t.call(n):e.get(n)),E=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},P=(n,e,t,s)=>(A(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);var k=(n,e,t)=>(A(n,e,"access private method"),t);import{v as ie,p as ne}from"./vendor.ada7163b.js";const ae=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}};ae();var v;(function(n){n.LightKing="\u2654",n.LightQueen="\u2655",n.LightRook="\u2656",n.LightBishop="\u2657",n.LightKnight="\u2658",n.LightPawn="\u2659",n.DarkKing="\u265A",n.DarkQueen="\u265B",n.DarkRook="\u265C",n.DarkBishop="\u265D",n.DarkKnight="\u265E",n.DarkPawn="\u265F"})(v||(v={}));function D(n,e){var s;const t=this.shade==="dark"?n.lightKing:n.darkKing;if(t){let i=!1;for(const a of e)if(((s=a.piece)==null?void 0:s.uuid)===t.uuid){i=!0;break}i&&(this.pathToEnemyKing=e)}return e}var r;(function(n){n[n.NORTH=0]="NORTH",n[n.NE=1]="NE",n[n.EAST=2]="EAST",n[n.SE=3]="SE",n[n.SOUTH=4]="SOUTH",n[n.SW=5]="SW",n[n.WEST=6]="WEST",n[n.NW=7]="NW"})(r||(r={}));function j(n){switch(n){case r.NORTH:return{rank:1,file:0};case r.NE:return{rank:1,file:1};case r.EAST:return{rank:0,file:1};case r.SE:return{rank:-1,file:1};case r.SOUTH:return{rank:-1,file:0};case r.SW:return{rank:-1,file:-1};case r.WEST:return{rank:0,file:-1};case r.NW:return{rank:1,file:-1}}}function X(n,e){return G(this,n,e)}function Y(n,e){return G(this,n,e)}function G(n,e,t){var h,o;const s=[],i=j(e);let a=t.getSquare((h=n.pos)==null?void 0:h.rank,(o=n.pos)==null?void 0:o.file);for(;a&&(a=t.getSquare(a.pos.rank+i.rank,a.pos.file+i.file));)s.push(a);return s}class J{constructor(e,t){c(this,"piece",null);c(this,"shade");c(this,"pos");c(this,"chessPosition");this.shade=e,this.pos=t,this.chessPosition=this.getChessPosition()}getChessPosition(){const t=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:t}}}var m,O,oe;class K{constructor(e,t,s,i,a){E(this,O);c(this,"type");c(this,"shade");c(this,"pos");c(this,"unicodeChar");c(this,"fenChar");c(this,"defaultMoves",[]);c(this,"legalMoves",[]);c(this,"coverage",[]);c(this,"threatens",new Set);c(this,"threatenedBy",new Set);c(this,"protects",new Set);c(this,"protectedBy",new Set);c(this,"uuid",ie());c(this,"myKingIsUnderCheck",!1);E(this,m,[]);c(this,"timesMoved",0);c(this,"canBeEaten",!0);this.type=e,this.shade=t,this.pos=i;const{unicode:h,fenChar:o}=k(this,O,oe).call(this);this.unicodeChar=h,this.fenChar=o,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=a||[]}get initialSquares(){return x(this,m)}set initialSquares(e){P(this,m,e)}getDefaultMoves(e){return[]}getLegalMoves(e){return[]}getCoverageMoves(e){return this.legalMoves}moveConditions(e){return!1}isMoveLegal(e){return this.legalMoves.includes(e)}threaten(){this.coverage.forEach(e=>{e.piece&&e.piece.shade!==this.shade&&(this.threatens.add(e.piece),e.piece.threatenedBy.add(this))})}doIIntersect(){const e=this.threatenedBy;for(const t of e)if(t.type==="Bishop"||t.type==="Queen"||t.type==="Rook"){const s=t;for(const i of s.pathToEnemyKing)if(i.piece===this)return!0}return!1}findMovesToProtectKing(e){const t=this.shade==="dark"?e.darkKing:e.lightKing;if(t&&t.threatenedBy.size<=1)for(const s of t.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(i=>{var a;return s.pathToEnemyKing.includes(i)||i.pos.rank===((a=s.pos)==null?void 0:a.rank)&&i.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(i=>{var a;return i.pos.rank===((a=s.pos)==null?void 0:a.rank)&&i.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(e,t,s){if(e instanceof J){let i=!1;return e.piece?(i=!1,e.piece.shade!==this.shade?i=!0:(i=!1,this.protects.add(e.piece),e.piece.protectedBy.add(this))):i=!0,s&&(i=s()),i}else{const i=[];for(const a of e)if(!a.piece)i.push(a);else if(a.piece.shade!==this.shade){i.push(a);break}else{this.protects.add(a.piece),a.piece.protectedBy.add(this);break}return i}}move(e,t){var h,o;const s=t.getSquare(e.rank,e.file);if(!s)return;const i=s==null?void 0:s.piece;if(s&&!this.isMoveLegal(s)||i&&!(i!=null&&i.canBeEaten))return;if(this.pos&&t.setPiece(null,this.pos.rank,this.pos.file),i&&i.canBeEaten){const u=t.getPiece(e.rank,e.file);t.pieces=t.pieces.filter(g=>g!==u),t.setPiece(null,e.rank,e.file)}else if(this.type==="Pawn"){const u=this.shade==="dark"?-1:1,g=this;((o=(h=g.canTakeEnPassant)==null?void 0:h.pos)==null?void 0:o.file)===e.file&&g.canTakeEnPassant.pos.rank===e.rank-u&&(t.setPiece(null,g.canTakeEnPassant.pos.rank,g.canTakeEnPassant.pos.file),t.pieces=t.pieces.filter(M=>M!==g.canTakeEnPassant),g.canTakeEnPassant=null,g.timesEnPassant=g.timesEnPassant+1)}t.setPiece(this,e.rank,e.file),this.timesMoved++;let a=t.pieceHistory.get(this.uuid);t.pieceHistory.set(this.uuid,a+1),t.totalMoves++,t.history.push({uuid:this.uuid})}}m=new WeakMap,O=new WeakSet,oe=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:v.DarkKing,fenChar:"k"};case"Queen":return{unicode:v.DarkQueen,fenChar:"q"};case"Rook":return{unicode:v.DarkRook,fenChar:"r"};case"Bishop":return{unicode:v.DarkBishop,fenChar:"b"};case"Knight":return{unicode:v.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:v.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:v.LightKing,fenChar:"K"};case"Queen":return{unicode:v.LightQueen,fenChar:"Q"};case"Rook":return{unicode:v.LightRook,fenChar:"R"};case"Bishop":return{unicode:v.LightBishop,fenChar:"B"};case"Knight":return{unicode:v.LightKnight,fenChar:"N"};case"Pawn":return{unicode:v.LightPawn,fenChar:"P"}}}};class V extends K{constructor(e,t,s){const i=e==="dark"?7:0,a=[{rank:i,file:0},{rank:i,file:7}];super("Rook",e,t,s,a);c(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,t){return[]}straightMove(e,t){return[]}getLegalMoves(e){const t=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.NORTH,e))),s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.EAST,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.SOUTH,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.WEST,e)));return[...t,...s,...i,...a]}getDefaultMoves(e){const t=this.straightMove(r.NORTH,e),s=this.straightMove(r.EAST,e),i=this.straightMove(r.SOUTH,e),a=this.straightMove(r.WEST,e);return[...t,...s,...i,...a]}}Object.assign(V.prototype,{straightMove:Y,getPathToEnemyKing:D});class Z extends K{constructor(e,t,s){const i=e==="dark"?7:0,a=[{rank:i,file:2},{rank:i,file:5}];super("Bishop",e,t,s,a);c(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,t){return[]}diagonalMove(e,t){return[]}getLegalMoves(e){const t=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.NE,e))),s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.SE,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.SW,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.NW,e)));return[...t,...s,...i,...a]}getDefaultMoves(e){const t=this.diagonalMove(r.NE,e),s=this.diagonalMove(r.SE,e),i=this.diagonalMove(r.SW,e),a=this.diagonalMove(r.NW,e);return[...t,...s,...i,...a]}}Object.assign(Z.prototype,{diagonalMove:X,getPathToEnemyKing:D});var q,he,R,re;class F extends K{constructor(e,t,s){const a=[{rank:e==="dark"?7:0,file:4}];super("King",e,t,s,a);E(this,q);E(this,R);this.canBeEaten=!1}getLegalMoves(e){const t=this.shade==="dark"?e.lightCoverage:e.darkCoverage,s=[];return this.defaultMoves.forEach(i=>{this.checkMoveLegality(i)&&!t.has(i)&&!k(this,q,he).call(this,i.piece)&&!k(this,R,re).call(this,i)&&s.push(i)}),s}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var i,a;const t=[],s=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let h=0;h<8;h++){const o=j(r[s[h]]),u=e.getSquare(((i=this.pos)==null?void 0:i.rank)+o.rank,((a=this.pos)==null?void 0:a.file)+o.file);u&&t.push(u)}return t}}q=new WeakSet,he=function(e){return e?this.threatenedBy.has(e)&&e.protectedBy.size>0:!1},R=new WeakSet,re=function(e){for(const t of this.threatenedBy)if("getPathToEnemyKing"in t)return t.pathToEnemyKing.includes(e);return!1};class b extends K{constructor(e,t,s){const a=[{rank:e==="dark"?7:0,file:3}];super("Queen",e,t,s,a);c(this,"pathToEnemyKing",[])}diagonalMove(e,t){return[]}straightMove(e,t){return[]}getPathToEnemyKing(e,t){return[]}getLegalMoves(e){const t=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.NORTH,e)),e),s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.EAST,e)),e),i=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.SOUTH,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.WEST,e)),e),h=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.NE,e)),e),o=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.SE,e)),e),u=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.SW,e)),e),g=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.NW,e)),e);return[...t,...h,...s,...o,...i,...u,...a,...g]}getDefaultMoves(e){const t=this.straightMove(r.NORTH,e),s=this.straightMove(r.EAST,e),i=this.straightMove(r.SOUTH,e),a=this.straightMove(r.WEST,e),h=this.diagonalMove(r.NE,e),o=this.diagonalMove(r.SE,e),u=this.diagonalMove(r.SW,e),g=this.diagonalMove(r.NW,e);return[...t,...h,...s,...o,...i,...u,...a,...g]}}Object.assign(b.prototype,{diagonalMove:X,straightMove:Y,getPathToEnemyKing:D});class ce extends K{constructor(e,t,s){const i=e==="dark"?7:0,a=[{rank:i,file:1},{rank:i,file:6}];super("Knight",e,t,s,a)}getDefaultMoves(e){const t=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(i=>{const a=e.getSquare(this.pos.rank+i[0],this.pos.file+i[1]);a&&t.push(a)}),t}getLegalMoves(e){const t=this.defaultMoves,s=[];return t.forEach(i=>{i&&this.checkMoveLegality(i)&&s.push(i)}),s}}var C,Q;const H=class extends K{constructor(e,t,s){const i=e==="light"?1:6,h=[0,1,2,3,4,5,6,7].map(o=>({rank:i,file:o}));super("Pawn",e,t,s,h);E(this,C);c(this,"canTakeEnPassant",null);c(this,"timesEnPassant",0)}getLegalMoves(e){const t=this.defaultMoves,s=[];return t.forEach(i=>{i&&this.checkMoveLegality(i,e,()=>this.moveConditions(i))&&s.push(i)}),s}moveConditions(e){var s,i,a,h,o,u;const t=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-t===((s=this.canTakeEnPassant.pos)==null?void 0:s.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((i=this.pos)==null?void 0:i.rank)+t||e.pos.rank===((a=this.pos)==null?void 0:a.rank)+t*2?e.pos.rank!==((h=this.pos)==null?void 0:h.rank)+t*2&&(e.pos.file===((o=this.pos)==null?void 0:o.file)+t||e.pos.file===((u=this.pos)==null?void 0:u.file)-t)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const t=this.shade==="light"?1:-1;return this.defaultMoves.filter(s=>{var i,a;return!(s.pos.file===((i=this.pos)==null?void 0:i.file)&&(s.pos.rank===((a=this.pos)==null?void 0:a.rank)+t||s.pos.rank===this.pos.rank+t*2))})}getDefaultMoves(e){const t=[];if(this.pos){this.canTakeEnPassant=null;const s=this.shade==="light"?1:-1,i=e.getSquare(this.pos.rank+s,this.pos.file),a=e.getSquare(this.pos.rank+s*2,this.pos.file),h=e.getSquare(this.pos.rank+s,this.pos.file+s),o=e.getSquare(this.pos.rank+s,this.pos.file-s);if(i&&!(i!=null&&i.piece)&&(t.push(i),this.timesMoved===0&&this.initialSquares.find(u=>{var g,M;return u.rank===((g=this.pos)==null?void 0:g.rank)&&u.file===((M=this.pos)==null?void 0:M.file)})&&a&&!(a!=null&&a.piece)&&t.push(a)),h&&t.push(h),o&&t.push(o),this.timesEnPassant===0){const u=e.getSquare(this.pos.rank,this.pos.file+s),g=e.getSquare(this.pos.rank,this.pos.file-s);h&&!h.piece&&u&&u.piece instanceof H&&k(this,C,Q).call(this,u.piece,e)&&(t.includes(h)||t.push(h)),o&&!o.piece&&g&&g.piece instanceof H&&k(this,C,Q).call(this,g.piece,e)&&(t.includes(o)||t.push(o))}}return t}};let ee=H;C=new WeakSet,Q=function(e,t){return e.timesMoved===1&&t.history[t.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,console.log(e),!0):!1};var S,L,U,N,z,w,$,B,_;class le{constructor(e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){E(this,L);E(this,N);E(this,w);E(this,B);c(this,"board");E(this,S,void 0);c(this,"pieces",[]);c(this,"lightKing",null);c(this,"darkKing",null);c(this,"darkCoverage",new Set);c(this,"lightCoverage",new Set);c(this,"pieceHistory",new Map);c(this,"totalMoves",0);c(this,"whoWon",null);c(this,"history",[]);this.board=k(this,w,$).call(this),P(this,S,e)}get fen(){return x(this,S)}set fen(e){this.legalFEN(e)&&(P(this,S,e),this.emptyBoard(),this.loadPieces())}legalFEN(e){let t=0,s=0;for(const i of e){const a=parseInt(i);i==="/"?t++:isNaN(a)?s++:s+=a}return t===7&&s===64}emptyBoard(){this.board=k(this,w,$).call(this)}loadPieces(e){e&&this.legalFEN(e)&&(this.fen=e);let t=this.board.length-1,s=0,i=0,a="";for(;t>=0&&(a=this.fen[i]);){const h=parseInt(a);if(a==="/")t--,s=0;else if(isNaN(h)){let o=null;switch(a){case"K":this.lightKing=o=new F("light",this);break;case"k":this.darkKing=o=new F("dark",this);break;case"Q":case"q":o=new b(a==="q"?"dark":"light",this);break;case"R":case"r":o=new V(a==="r"?"dark":"light",this);break;case"N":case"n":o=new ce(a==="n"?"dark":"light",this);break;case"B":case"b":o=new Z(a==="b"?"dark":"light",this);break;case"P":case"p":o=new ee(a==="p"?"dark":"light",this);break}this.board[t][s].piece=o,o&&(o.pos=this.board[t][s].pos,this.pieces.push(o),this.pieceHistory.set(o.uuid,0)),s++}else s+=h;i++}k(this,L,U).call(this)}getKing(e){return this.pieces.find(s=>s.shade===e&&s.type==="King")||null}generateFEN(){let e="",t=0;return this.forEach((s,i,a)=>{!s||!s.piece?t++:(t>0&&(e+=t,t=0),e+=s.piece.fenChar),a===this.board[i].length-1&&(t>0&&(e+=t,t=0),i!=0&&(e+="/"))}),e}forEach(e){for(let t=this.board.length-1;t>=0;t--)for(let s=0;s<this.board[t].length;s++)e(this.getSquare(t,s),t,s)}setPiece(e,t,s){return k(this,B,_).call(this,t,s)?(this.board[t][s].piece=e,e&&(e.pos=this.board[t][s].pos),P(this,S,this.generateFEN()),!0):!1}getPiece(e,t){const s=this.getSquare(e,t);return s?s.piece:null}getSquare(e,t){return k(this,B,_).call(this,e,t)?this.board[e][t]:null}movePiece(e,t){t&&(t.move(e,this),k(this,L,U).call(this))}displayInConsole(){const e="\u2502",t="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",i="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",a=["a","b","c","d","e","f","g","h"];for(let h=this.board.length-1;h>=0;h--){let o=`${h+1} ${e} `;for(let u=0;u<this.board[h].length;u++){const g=this.getPiece(h,u);g?o+=g.unicodeChar:o+=" ",o+=` ${e} `}console.log(h===7?t:s),console.log(o),h===0&&console.log(i)}console.log(`  ${e} `+a.join(` ${e} `)+` ${e}`)}}S=new WeakMap,L=new WeakSet,U=function(){console.table(this.history),this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(e=>{e.threatenedBy.clear(),e.threatens.clear(),e.protects.clear(),e.protectedBy.clear(),e.myKingIsUnderCheck=!1,"pathToEnemyKing"in e&&(e.pathToEnemyKing=[])}),this.pieces.forEach(e=>{e.defaultMoves=e.getDefaultMoves(this),e.legalMoves=e.getLegalMoves(this),e.coverage=e.getCoverageMoves(this),e.threaten()}),this.pieces.forEach(e=>{e.doIIntersect()&&e.threatenedBy.forEach(t=>{e.legalMoves=e.legalMoves.filter(s=>s.piece===t)}),e.shade==="light"?e.coverage.forEach(t=>this.lightCoverage.add(t)):e.coverage.forEach(t=>this.darkCoverage.add(t))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.isUnderCheck&&k(this,N,z).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.isUnderCheck&&k(this,N,z).call(this,this.lightKing)),this.darkCoverage.size===0&&(this.whoWon="light"),this.lightCoverage.size===0&&(this.whoWon="dark")},N=new WeakSet,z=function(e){const t=e.shade==="dark"?this.darkCoverage:this.lightCoverage;this.pieces.forEach(s=>{s.shade===e.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this))}),t.clear(),this.pieces.forEach(s=>{s.shade===e.shade&&s.coverage.forEach(i=>{t.add(i)})})},w=new WeakSet,$=function(){const e=new Array(8);for(let t=0;t<e.length;t++)e[t]=new Array(8);for(let t=e.length-1;t>=0;t--)for(let s=0;s<e[t].length;s++)e[t][s]=new J((s+t)%2===1?"light":"dark",{rank:t,file:s});return e},B=new WeakSet,_=function(e,t){return 0<=e&&e<this.board.length&&0<=t&&t<this.board[e].length};const I={canvasSize:900,canvasParent:"app"},ge=n=>{const e=new le;let t=null,s=!1;n.setup=()=>{n.createCanvas(I.canvasSize,I.canvasSize).parent(I.canvasParent),n.background(0,0,0),e.loadPieces()};const i=(f,l=!1)=>{const p=n.width,d=n.height,y=8;let T=f.file*p/y,W=(f.rank+7-f.rank*2)*d/y;return l&&(T+=p/(y*2),W+=d/(y*2)),[T,W]},a=(f,l)=>{if(f.pos){let p,d;if(l)p=l.x,d=l.y;else{const[y,T]=i(f.pos,!0);p=y,d=T}n.push(),n.fill(0,0,255),n.textSize(50),n.textAlign(n.CENTER,n.CENTER),n.text(f.unicodeChar,p,d),n.pop()}},h=(f,l,p,d)=>{n.fill(...p),n.square(f,l,n.width/8),n.fill(255,0,0),n.text(`${d.file}${d.rank}`,f,l+n.height/8)},o=(f,l=h)=>{const[p,d]=i(f.pos),y=f.shade==="dark"?[0,0,0]:[255,255,255],{rank:T,file:W}=f.chessPosition;n.push(),n.noStroke(),l(p,d,y,{rank:T,file:W}),n.pop()},u=f=>{f.forEach(l=>{l&&o(l)}),t&&t.piece&&(o(t,(l,p)=>{n.fill(0,0,120,175),n.square(l,p,n.width/8)}),t.piece.legalMoves.forEach(l=>{o(l,(p,d)=>{n.fill(0,255,0,150),l.piece&&!l.piece.canBeEaten&&n.fill(255,0,0,150),n.square(p,d,n.width/8)})})),f.pieces.forEach(l=>{l===(t==null?void 0:t.piece)&&s?a(l,{x:n.mouseX,y:n.mouseY}):a(l)})},g=f=>{const[l,p]=i(f.pos);return[n.mouseX>=l&&n.mouseX<=l+n.width/8&&n.mouseY>=p&&n.mouseY<=p+n.height/8,l,p]},M=()=>{var f;(f=t==null?void 0:t.piece)==null||f.legalMoves.forEach(l=>{const[p]=g(l);p&&(e.movePiece(l.pos,t.piece),t=null)}),e.forEach(l=>{l&&g(l)[0]&&(t=l)})};n.mousePressed=()=>{switch(n.mouseButton){case n.LEFT:M();break}},n.mouseDragged=()=>{switch(n.mouseButton){case n.LEFT:t&&t.piece?s=!0:M();break}},n.mouseReleased=()=>{s=!1,t&&M()},n.draw=()=>{u(e)}};new ne(ge);
