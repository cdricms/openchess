var Xe=Object.defineProperty;var Ke=Object.getOwnPropertySymbols;var Ye=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var ae=(i,t,e)=>t in i?Xe(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Y=(i,t)=>{for(var e in t||(t={}))Ye.call(t,e)&&ae(i,e,t[e]);if(Ke)for(var e of Ke(t))Je.call(t,e)&&ae(i,e,t[e]);return i};var h=(i,t,e)=>(ae(i,typeof t!="symbol"?t+"":t,e),e),oe=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var re=(i,t,e)=>(oe(i,t,"read from private field"),e?e.call(i):t.get(i)),_=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},x=(i,t,e,s)=>(oe(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);var w=(i,t,e)=>(oe(i,t,"access private method"),e);import{v as qe,t as he,S as Me,i as Pe,s as Se,e as $,a as z,b as q,c as W,d as ie,f as E,g as J,n as we,h as ne,j as le,m as ce,k as ge,l as ue,o as fe,p as Ve,q as Ce,r as Le,u as Ze,w as be}from"./vendor.ea0c3b89.js";const et=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}};et();var N;(function(i){i.LightKing="\u2654",i.LightQueen="\u2655",i.LightRook="\u2656",i.LightBishop="\u2657",i.LightKnight="\u2658",i.LightPawn="\u2659",i.DarkKing="\u265A",i.DarkQueen="\u265B",i.DarkRook="\u265C",i.DarkBishop="\u265D",i.DarkKnight="\u265E",i.DarkPawn="\u265F"})(N||(N={}));function Te(i,t){var s;const e=this.shade==="dark"?i.lightKing:i.darkKing;if(e){let a=!1;for(const n of t)if(((s=n.piece)==null?void 0:s.uuid)===e.uuid){a=!0;break}a&&(this.pathToEnemyKing=t)}return t}var f;(function(i){i[i.NORTH=0]="NORTH",i[i.NE=1]="NE",i[i.EAST=2]="EAST",i[i.SE=3]="SE",i[i.SOUTH=4]="SOUTH",i[i.SW=5]="SW",i[i.WEST=6]="WEST",i[i.NW=7]="NW"})(f||(f={}));function Oe(i){switch(i){case f.NORTH:return{rank:1,file:0};case f.NE:return{rank:1,file:1};case f.EAST:return{rank:0,file:1};case f.SE:return{rank:-1,file:1};case f.SOUTH:return{rank:-1,file:0};case f.SW:return{rank:-1,file:-1};case f.WEST:return{rank:0,file:-1};case f.NW:return{rank:1,file:-1}}}function Re(i,t){return De(this,i,t)}function He(i,t){return De(this,i,t)}function De(i,t,e){var o,r;const s=[],a=Oe(t);let n=e.getSquare((o=i.pos)==null?void 0:o.rank,(r=i.pos)==null?void 0:r.file);for(;n&&(n=e.getSquare(n.pos.rank+a.rank,n.pos.file+a.file));)s.push(n);return s}class Ae{constructor(t,e){h(this,"piece",null);h(this,"shade");h(this,"pos");h(this,"chessPosition");this.shade=t,this.pos=e,this.chessPosition=this.getChessPosition()}getChessPosition(){const e=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:e}}}var F,V,Ie;class H{constructor(t,e,s,a,n){_(this,V);h(this,"type");h(this,"shade");h(this,"pos");h(this,"unicodeChar");h(this,"fenChar");h(this,"defaultMoves",[]);h(this,"legalMoves",[]);h(this,"coverage",[]);h(this,"threatens",new Set);h(this,"threatenedBy",new Set);h(this,"protects",new Set);h(this,"protectedBy",new Set);h(this,"uuid",qe());h(this,"myKingIsUnderCheck",!1);_(this,F,[]);h(this,"timesMoved",0);h(this,"canBeEaten",!0);this.type=t,this.shade=e,this.pos=a;const{unicode:o,fenChar:r}=w(this,V,Ie).call(this);this.unicodeChar=o,this.fenChar=r,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=n||[]}get initialSquares(){return re(this,F)}set initialSquares(t){x(this,F,t)}getDefaultMoves(t){return[]}getLegalMoves(t){return[]}getCoverageMoves(t){return this.legalMoves}moveConditions(t){return!1}isMoveLegal(t){return this.legalMoves.includes(t)}threaten(){this.coverage.forEach(t=>{t.piece&&t.piece.shade!==this.shade&&(this.threatens.add(t.piece),t.piece.threatenedBy.add(this))})}doIIntersect(){const t=this.threatenedBy;for(const e of t)if(e.type==="Bishop"||e.type==="Queen"||e.type==="Rook"){const s=e;for(const a of s.pathToEnemyKing)if(a.piece===this)return!0}return!1}findMovesToProtectKing(t){const e=this.shade==="dark"?t.darkKing:t.lightKing;if(e&&e.threatenedBy.size<=1)for(const s of e.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(a=>{var n;return s.pathToEnemyKing.includes(a)||a.pos.rank===((n=s.pos)==null?void 0:n.rank)&&a.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(a=>{var n;return a.pos.rank===((n=s.pos)==null?void 0:n.rank)&&a.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(t,e,s){if(t instanceof Ae){let a=!1;return t.piece?(a=!1,t.piece.shade!==this.shade?a=!0:(a=!1,this.protects.add(t.piece),t.piece.protectedBy.add(this))):a=!0,s&&(a=s()),a}else{const a=[];for(const n of t)if(!n.piece)a.push(n);else if(n.piece.shade!==this.shade){a.push(n);break}else{this.protects.add(n.piece),n.piece.protectedBy.add(this);break}return a}}move(t,e){var u,p,g,l,c,v,m,M,P,y,d,S,K,L,k,D;let s=`${this.type==="Pawn"?"":this.fenChar.toUpperCase()}`;const a=this.shade==="dark"?-1:1,n=e.getSquare(t.rank,t.file);if(!n)return!1;const o=n==null?void 0:n.piece;if(n&&!this.isMoveLegal(n)||o&&!(o!=null&&o.canBeEaten))return!1;if(this.pos&&e.setPiece(null,this.pos.rank,this.pos.file),o&&o.canBeEaten){const C=e.getPiece(t.rank,t.file);e.pieces=e.pieces.filter(O=>O!==C),e.setPiece(null,t.rank,t.file),s+=`x${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank}`}else if(this.type==="Pawn"){const C=this;if(((p=(u=C.canTakeEnPassant)==null?void 0:u.pos)==null?void 0:p.file)===t.file&&C.canTakeEnPassant.pos.rank===t.rank-a){const O=e.getSquare((g=C.pos)==null?void 0:g.rank,(l=C.pos)==null?void 0:l.file);e.setPiece(null,C.canTakeEnPassant.pos.rank,C.canTakeEnPassant.pos.file),e.pieces=e.pieces.filter(T=>T!==C.canTakeEnPassant),C.canTakeEnPassant=null,C.timesEnPassant=C.timesEnPassant+1,s=`${O==null?void 0:O.chessPosition.file.toLowerCase()}x${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank} e.p`}else s=`${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank}`}else if(this.type==="King"&&this.timesMoved===0){const C=this.legalMoves.find(T=>{var A,I;return T.pos.file===((A=this.pos)==null?void 0:A.file)+2&&T.pos.rank===((I=this.pos)==null?void 0:I.rank)}),O=this.legalMoves.find(T=>{var A,I;return T.pos.file===((A=this.pos)==null?void 0:A.file)-2&&T.pos.rank===((I=this.pos)==null?void 0:I.rank)});if(C||O){if(C){const T=e.getPiece((c=this.pos)==null?void 0:c.rank,((v=this.pos)==null?void 0:v.file)+3);T&&(e.setPiece(null,(m=T.pos)==null?void 0:m.rank,(M=T.pos)==null?void 0:M.file),e.setPiece(T,(P=this.pos)==null?void 0:P.rank,((y=this.pos)==null?void 0:y.file)+1),s="O-O")}if(O){const T=e.getPiece((d=this.pos)==null?void 0:d.rank,((S=this.pos)==null?void 0:S.file)-4);T&&(e.setPiece(null,(K=T.pos)==null?void 0:K.rank,(L=T.pos)==null?void 0:L.file),e.setPiece(T,(k=this.pos)==null?void 0:k.rank,((D=this.pos)==null?void 0:D.file)-1),s="O-O-O")}}else s+=`${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank}`}else s+=`${n.chessPosition.file.toLowerCase()}${n.chessPosition.rank}`;e.setPiece(this,t.rank,t.file),this.timesMoved++;let r=e.pieceHistory.get(this.uuid);return e.pieceHistory.set(this.uuid,r+1),e.totalMoves++,e.history.push({uuid:this.uuid,an:s}),!0}}F=new WeakMap,V=new WeakSet,Ie=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:N.DarkKing,fenChar:"k"};case"Queen":return{unicode:N.DarkQueen,fenChar:"q"};case"Rook":return{unicode:N.DarkRook,fenChar:"r"};case"Bishop":return{unicode:N.DarkBishop,fenChar:"b"};case"Knight":return{unicode:N.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:N.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:N.LightKing,fenChar:"K"};case"Queen":return{unicode:N.LightQueen,fenChar:"Q"};case"Rook":return{unicode:N.LightRook,fenChar:"R"};case"Bishop":return{unicode:N.LightBishop,fenChar:"B"};case"Knight":return{unicode:N.LightKnight,fenChar:"N"};case"Pawn":return{unicode:N.LightPawn,fenChar:"P"}}}};class xe extends H{constructor(e,s,a){const n=e==="dark"?7:0;super("Rook",e,s,a,[{rank:n,file:0},{rank:n,file:7}]);h(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}straightMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(f.NORTH,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(f.EAST,e))),n=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(f.SOUTH,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(f.WEST,e)));return[...s,...a,...n,...o]}getDefaultMoves(e){const s=this.straightMove(f.NORTH,e),a=this.straightMove(f.EAST,e),n=this.straightMove(f.SOUTH,e),o=this.straightMove(f.WEST,e);return[...s,...a,...n,...o]}}Object.assign(xe.prototype,{straightMove:He,getPathToEnemyKing:Te});class ze extends H{constructor(e,s,a){const n=e==="dark"?7:0;super("Bishop",e,s,a,[{rank:n,file:2},{rank:n,file:5}]);h(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}diagonalMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(f.NE,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(f.SE,e))),n=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(f.SW,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(f.NW,e)));return[...s,...a,...n,...o]}getDefaultMoves(e){const s=this.diagonalMove(f.NE,e),a=this.diagonalMove(f.SE,e),n=this.diagonalMove(f.SW,e),o=this.diagonalMove(f.NW,e);return[...s,...a,...n,...o]}}Object.assign(ze.prototype,{diagonalMove:Re,getPathToEnemyKing:Te});var Z,Fe,b,Qe,ee,Ue,te,je;class Ne extends H{constructor(e,s,a){super("King",e,s,a,[{rank:e==="dark"?7:0,file:4}]);_(this,Z);_(this,b);_(this,ee);_(this,te);this.canBeEaten=!1}getLegalMoves(e){const s=this.shade==="dark"?e.lightCoverage:e.darkCoverage,a=[];return this.defaultMoves.forEach(n=>{this.checkMoveLegality(n)&&!s.has(n)&&!w(this,Z,Fe).call(this,n.piece)&&!w(this,b,Qe).call(this,n)&&(w(this,te,je).call(this,n)?w(this,ee,Ue).call(this,n)&&a.push(n):a.push(n))}),a}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var n,o,r,u,p,g,l,c,v,m,M,P,y,d;const s=[],a=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let S=0;S<8;S++){const K=Oe(f[a[S]]),L=e.getSquare(((n=this.pos)==null?void 0:n.rank)+K.rank,((o=this.pos)==null?void 0:o.file)+K.file);L&&s.push(L)}if(this.timesMoved===0){const S=e.getPiece((r=this.pos)==null?void 0:r.rank,((u=this.pos)==null?void 0:u.file)+3),K=e.getPiece((p=this.pos)==null?void 0:p.rank,((g=this.pos)==null?void 0:g.file)-4);if(S&&S.type==="Rook"&&S.shade===this.shade){let L=!0;for(let k=1;k<3;k++)if(e.getPiece((l=this.pos)==null?void 0:l.rank,((c=this.pos)==null?void 0:c.file)+k)){L=!1;break}if(L){const k=e.getSquare((v=this.pos)==null?void 0:v.rank,((m=this.pos)==null?void 0:m.file)+2);k&&s.push(k)}}if(K&&K.type==="Rook"&&K.shade===this.shade){let L=!0;for(let k=1;k<4;k++)if(e.getPiece((M=this.pos)==null?void 0:M.rank,((P=this.pos)==null?void 0:P.file)-k)){L=!1;break}if(L){const k=e.getSquare((y=this.pos)==null?void 0:y.rank,((d=this.pos)==null?void 0:d.file)-2);k&&s.push(k)}}}return s}}Z=new WeakSet,Fe=function(e){return e?e.protectedBy.size>0:!1},b=new WeakSet,Qe=function(e){for(const s of this.threatenedBy)if("getPathToEnemyKing"in s)return s.pathToEnemyKing.includes(e);return!1},ee=new WeakSet,Ue=function(e){return this.timesMoved===0&&this.threatenedBy.size===0},te=new WeakSet,je=function(e){var s;return e&&e.pos.rank===((s=this.pos)==null?void 0:s.rank)&&(this.pos.file+2===e.pos.file||this.pos.file-2===e.pos.file)};class pe extends H{constructor(e,s,a){super("Queen",e,s,a,[{rank:e==="dark"?7:0,file:3}]);h(this,"pathToEnemyKing",[])}diagonalMove(e,s){return[]}straightMove(e,s){return[]}getPathToEnemyKing(e,s){return[]}getLegalMoves(e){const s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(f.NORTH,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(f.EAST,e)),e),n=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(f.SOUTH,e)),e),o=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(f.WEST,e)),e),r=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(f.NE,e)),e),u=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(f.SE,e)),e),p=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(f.SW,e)),e),g=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(f.NW,e)),e);return[...s,...r,...a,...u,...n,...p,...o,...g]}getDefaultMoves(e){const s=this.straightMove(f.NORTH,e),a=this.straightMove(f.EAST,e),n=this.straightMove(f.SOUTH,e),o=this.straightMove(f.WEST,e),r=this.diagonalMove(f.NE,e),u=this.diagonalMove(f.SE,e),p=this.diagonalMove(f.SW,e),g=this.diagonalMove(f.NW,e);return[...s,...r,...a,...u,...n,...p,...o,...g]}}Object.assign(pe.prototype,{diagonalMove:Re,straightMove:He,getPathToEnemyKing:Te});class tt extends H{constructor(t,e,s){const a=t==="dark"?7:0,n=[{rank:a,file:1},{rank:a,file:6}];super("Knight",t,e,s,n)}getDefaultMoves(t){const e=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(a=>{const n=t.getSquare(this.pos.rank+a[0],this.pos.file+a[1]);n&&e.push(n)}),e}getLegalMoves(t){const e=this.defaultMoves,s=[];return e.forEach(a=>{a&&this.checkMoveLegality(a)&&s.push(a)}),s}}var Q,ve;const se=class extends H{constructor(e,s,a){const n=e==="light"?1:6,r=[0,1,2,3,4,5,6,7].map(u=>({rank:n,file:u}));super("Pawn",e,s,a,r);_(this,Q);h(this,"canTakeEnPassant",null);h(this,"timesEnPassant",0)}getLegalMoves(e){const s=this.defaultMoves,a=[];return s.forEach(n=>{n&&this.checkMoveLegality(n,e,()=>this.moveConditions(n))&&a.push(n)}),a}moveConditions(e){var a,n,o,r,u,p;const s=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-s===((a=this.canTakeEnPassant.pos)==null?void 0:a.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((n=this.pos)==null?void 0:n.rank)+s||e.pos.rank===((o=this.pos)==null?void 0:o.rank)+s*2?e.pos.rank!==((r=this.pos)==null?void 0:r.rank)+s*2&&(e.pos.file===((u=this.pos)==null?void 0:u.file)+s||e.pos.file===((p=this.pos)==null?void 0:p.file)-s)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const s=this.shade==="light"?1:-1;return this.defaultMoves.filter(a=>{var n,o;return!(a.pos.file===((n=this.pos)==null?void 0:n.file)&&(a.pos.rank===((o=this.pos)==null?void 0:o.rank)+s||a.pos.rank===this.pos.rank+s*2))})}getDefaultMoves(e){const s=[];if(this.pos){this.canTakeEnPassant=null;const a=this.shade==="light"?1:-1,n=e.getSquare(this.pos.rank+a,this.pos.file),o=e.getSquare(this.pos.rank+a*2,this.pos.file),r=e.getSquare(this.pos.rank+a,this.pos.file+a),u=e.getSquare(this.pos.rank+a,this.pos.file-a);if(n&&!(n!=null&&n.piece)&&(s.push(n),this.timesMoved===0&&this.initialSquares.find(p=>{var g,l;return p.rank===((g=this.pos)==null?void 0:g.rank)&&p.file===((l=this.pos)==null?void 0:l.file)})&&o&&!(o!=null&&o.piece)&&s.push(o)),r&&s.push(r),u&&s.push(u),this.timesEnPassant===0){const p=e.getSquare(this.pos.rank,this.pos.file+a),g=e.getSquare(this.pos.rank,this.pos.file-a);r&&!r.piece&&p&&p.piece instanceof se&&w(this,Q,ve).call(this,p.piece,e)&&(s.includes(r)||s.push(r)),u&&!u.piece&&g&&g.piece instanceof se&&w(this,Q,ve).call(this,g.piece,e)&&(s.includes(u)||s.push(u))}}return s}};let de=se;Q=new WeakSet,ve=function(e,s){return e.timesMoved===1&&s.history[s.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,console.log(e),!0):!1};var R,U,ke,j,me,G,ye,X,Ee;class st{constructor(t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){_(this,U);_(this,j);_(this,G);_(this,X);h(this,"board");_(this,R,void 0);h(this,"pieces",[]);h(this,"lightKing",null);h(this,"darkKing",null);h(this,"darkCoverage",new Set);h(this,"lightCoverage",new Set);h(this,"pieceHistory",new Map);h(this,"totalMoves",0);h(this,"history",[]);h(this,"game",null);h(this,"strict",!0);this.board=w(this,G,ye).call(this),x(this,R,t)}get fen(){return re(this,R)}set fen(t){this.legalFEN(t)&&(x(this,R,t),this.emptyBoard(),this.loadPieces())}legalFEN(t){let e=0,s=0;for(const a of t){const n=parseInt(a);a==="/"?e++:isNaN(n)?s++:s+=n}return e===7&&s===64}emptyBoard(){this.pieces=[],this.board=w(this,G,ye).call(this)}loadPieces(t){t&&this.legalFEN(t)&&(this.fen=t);let e=this.board.length-1,s=0,a=0,n="";for(;e>=0&&(n=this.fen[a]);){const o=parseInt(n);if(n==="/")e--,s=0;else if(isNaN(o)){let r=null;switch(n){case"K":this.lightKing=r=new Ne("light",this);break;case"k":this.darkKing=r=new Ne("dark",this);break;case"Q":case"q":r=new pe(n==="q"?"dark":"light",this);break;case"R":case"r":r=new xe(n==="r"?"dark":"light",this);break;case"N":case"n":r=new tt(n==="n"?"dark":"light",this);break;case"B":case"b":r=new ze(n==="b"?"dark":"light",this);break;case"P":case"p":r=new de(n==="p"?"dark":"light",this);break}this.board[e][s].piece=r,r&&(r.pos=this.board[e][s].pos,this.pieces.push(r),this.pieceHistory.set(r.uuid,0)),s++}else s+=o;a++}w(this,U,ke).call(this)}getKing(t){return this.pieces.find(s=>s.shade===t&&s.type==="King")||null}generateFEN(){let t="",e=0;return this.forEach((s,a,n)=>{!s||!s.piece?e++:(e>0&&(t+=e,e=0),t+=s.piece.fenChar),n===this.board[a].length-1&&(e>0&&(t+=e,e=0),a!=0&&(t+="/"))}),t}forEach(t){for(let e=this.board.length-1;e>=0;e--)for(let s=0;s<this.board[e].length;s++)t(this.getSquare(e,s),e,s)}setPiece(t,e,s){return w(this,X,Ee).call(this,e,s)?(this.board[e][s].piece=t,t&&(t.pos=this.board[e][s].pos),x(this,R,this.generateFEN()),!0):!1}getPiece(t,e){const s=this.getSquare(t,e);return s?s.piece:null}getSquare(t,e){return w(this,X,Ee).call(this,t,e)?this.board[t][e]:null}movePiece(t,e){var s,a,n,o,r;if(((s=this.game)==null?void 0:s.hasStarted)&&!((a=this.game)!=null&&a.isPaused)&&e){if(this.strict&&this.game&&e.shade!==this.game.currentPlayer.shade)return!1;const u=Y({},e.pos),p=e.move(t,this);p&&(this.history.length===1&&this.game.start(),(n=this.game)==null||n.switch());const g=e.shade==="dark"?-1:1;if(e.type==="Pawn"&&t.rank===u.rank+g&&t.rank===(e.shade==="dark"?0:7)){const l=new pe(e.shade,this,e.pos);l.uuid=e.uuid,this.setPiece(l,(o=l.pos)==null?void 0:o.rank,(r=l.pos)==null?void 0:r.file),this.pieces=this.pieces.filter(c=>c!==e),this.pieces.push(l)}return w(this,U,ke).call(this),p}return!1}displayInConsole(){const t="\u2502",e="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",a="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",n=["a","b","c","d","e","f","g","h"];for(let o=this.board.length-1;o>=0;o--){let r=`${o+1} ${t} `;for(let u=0;u<this.board[o].length;u++){const p=this.getPiece(o,u);p?r+=p.unicodeChar:r+=" ",r+=` ${t} `}console.log(o===7?e:s),console.log(r),o===0&&console.log(a)}console.log(`  ${t} `+n.join(` ${t} `)+` ${t}`)}}R=new WeakMap,U=new WeakSet,ke=function(){this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(t=>{t.threatenedBy.clear(),t.threatens.clear(),t.protects.clear(),t.protectedBy.clear(),t.myKingIsUnderCheck=!1,"pathToEnemyKing"in t&&(t.pathToEnemyKing=[])}),this.pieces.forEach(t=>{t.defaultMoves=t.getDefaultMoves(this),t.legalMoves=t.getLegalMoves(this),t.coverage=t.getCoverageMoves(this),t.threaten()}),this.pieces.forEach(t=>{t.doIIntersect()&&t.threatenedBy.forEach(e=>{t.legalMoves=t.legalMoves.filter(s=>s.piece===e),t.coverage=t.getCoverageMoves(this)}),t.shade==="light"?t.coverage.forEach(e=>this.lightCoverage.add(e)):t.coverage.forEach(e=>this.darkCoverage.add(e))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.coverage=this.darkKing.getCoverageMoves(this),this.darkKing.isUnderCheck&&w(this,j,me).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.coverage=this.lightKing.getCoverageMoves(this),this.lightKing.isUnderCheck&&w(this,j,me).call(this,this.lightKing)),this.game&&(this.darkCoverage.size===0&&(this.game.whoWon="light"),this.lightCoverage.size===0&&(this.game.whoWon="dark"),(this.darkCoverage.size===0||this.lightCoverage.size===0)&&(this.history[this.history.length-1].an+="#",this.game.pause()))},j=new WeakSet,me=function(t){const e=t.shade==="dark"?this.darkCoverage:this.lightCoverage;this.pieces.forEach(s=>{s.shade===t.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this),s.type==="Pawn"&&s.legalMoves.length===0?s.coverage=[]:s.coverage=s.getCoverageMoves(this))}),e.clear(),this.pieces.forEach(s=>{s.shade===t.shade&&s.coverage.forEach(a=>{e.add(a)})})},G=new WeakSet,ye=function(){const t=new Array(8);for(let e=0;e<t.length;e++)t[e]=new Array(8);for(let e=t.length-1;e>=0;e--)for(let s=0;s<t[e].length;s++)t[e][s]=new Ae((s+e)%2===1?"light":"dark",{rank:e,file:s});return t},X=new WeakSet,Ee=function(t,e){return 0<=t&&t<this.board.length&&0<=e&&e<this.board[t].length};class _e{constructor(t,e,s){h(this,"shade");h(this,"name","Default Name");h(this,"uuid",qe());h(this,"intervalID",null);h(this,"isPaused",!0);h(this,"game");h(this,"currentTime",he.Duration.from({minutes:30}));h(this,"events",{ontimechanged(){}});this.shade=e,this.name=t,this.game=s,this.currentTime=he.Duration.from(this.game.initialTime)}start(){return this.isPaused=!1,this.intervalID=setInterval(()=>{this.currentTime=this.currentTime.subtract({seconds:1}),this.events.ontimechanged(this.shade,this.currentTime)},1e3),this}pause(){return this.intervalID&&(clearInterval(this.intervalID),this.isPaused=!0),this}}class it{constructor(){h(this,"board");h(this,"initialTime",he.Duration.from({minutes:30}));h(this,"light",new _e("light","light",this));h(this,"dark",new _e("dark","dark",this));h(this,"isPaused",!1);h(this,"hasStarted",!1);h(this,"currentPlayer",this.light);h(this,"events",{light:Y({},this.light.events),dark:Y({},this.dark.events)});h(this,"whoWon",null);this.board=new st,this.board.game=this}addLightPlayer(t){return this.light.name=t,this}addDarkPlayer(t){return this.dark.name=t,this}start(){return this.isPaused=!1,this.hasStarted=!0,this.currentPlayer.start(),this}pause(){return this.isPaused=!0,this.light.pause(),this.dark.pause(),this}reset(){return this.pause(),this}switch(){this.currentPlayer.pause(),this.currentPlayer=this.currentPlayer.shade==="dark"?this.light:this.dark,this.currentPlayer.start()}}const B={canvasSize:900,canvasParent:"app",game:new it},Ge={onpiecemove:(i,t,e)=>{}},nt=i=>{const{board:t}=B.game;let e=null,s=!1;i.setup=()=>{i.createCanvas(B.canvasSize,B.canvasSize).parent(B.canvasParent),i.background(0,0,0),t.loadPieces()};const a=(l,c=!1)=>{const v=i.width,m=i.height,M=8;let P=l.file*v/M,y=(l.rank+7-l.rank*2)*m/M;return c&&(P+=v/(M*2),y+=m/(M*2)),[P,y]},n=(l,c)=>{if(l.pos){let v,m;if(c)v=c.x,m=c.y;else{const[M,P]=a(l.pos,!0);v=M,m=P}i.push(),i.fill(0,0,255),i.textSize(50),i.textAlign(i.CENTER,i.CENTER),i.text(l.unicodeChar,v,m),i.pop()}},o=(l,c,v,m)=>{i.fill(...v),i.square(l,c,i.width/8),i.fill(255,0,0),i.text(`${m.file}${m.rank}`,l,c+i.height/8)},r=(l,c=o)=>{const[v,m]=a(l.pos),M=l.shade==="dark"?[0,0,0]:[255,255,255],{rank:P,file:y}=l.chessPosition;i.push(),i.noStroke(),c(v,m,M,{rank:P,file:y}),i.pop()},u=l=>{l.forEach(c=>{c&&r(c)}),e&&e.piece&&(r(e,(c,v)=>{i.fill(0,0,120,175),i.square(c,v,i.width/8)}),e.piece.legalMoves.forEach(c=>{r(c,(v,m)=>{i.fill(0,255,0,150),c.piece&&!c.piece.canBeEaten&&i.fill(255,0,0,150),i.square(v,m,i.width/8)})})),l.pieces.forEach(c=>{c===(e==null?void 0:e.piece)&&s?n(c,{x:i.mouseX,y:i.mouseY}):n(c)})},p=l=>{const[c,v]=a(l.pos);return[i.mouseX>=c&&i.mouseX<=c+i.width/8&&i.mouseY>=v&&i.mouseY<=v+i.height/8,c,v]},g=()=>{var l;(l=e==null?void 0:e.piece)==null||l.legalMoves.forEach(c=>{const[v]=p(c);if(v){const m=e.piece;t.movePiece(c.pos,e.piece)&&(Ge.onpiecemove(m,c,B.game.board.history.length),e=null)}}),t.forEach(c=>{c&&p(c)[0]&&(e=c)})};i.mousePressed=()=>{switch(i.mouseButton){case i.LEFT:g();break}},i.mouseDragged=()=>{switch(i.mouseButton){case i.LEFT:e&&e.piece?s=!0:g();break}},i.mouseReleased=()=>{s=!1,e&&g()},i.draw=()=>{u(t)}};function at(i){let t,e=i[0].name+"",s,a,n=`${i[1].minutes}:${i[1].seconds}`,o;return{c(){t=$("div"),s=z(e),a=q(),o=z(n),W(t,"id","player")},m(r,u){ie(r,t,u),E(t,s),E(t,a),E(t,o)},p(r,[u]){u&1&&e!==(e=r[0].name+"")&&J(s,e),u&2&&n!==(n=`${r[1].minutes}:${r[1].seconds}`)&&J(o,n)},i:we,o:we,d(r){r&&ne(t)}}}function ot(i,t,e){let s,{player:a}=t;return a.events.ontimechanged=(n,o)=>{e(1,s=o)},i.$$set=n=>{"player"in n&&e(0,a=n.player)},i.$$.update=()=>{i.$$.dirty&1&&e(1,s=a.currentTime)},[a,s]}class $e extends Me{constructor(t){super(),Pe(this,t,ot,at,Se,{player:0})}}function Be(i,t,e){const s=i.slice();return s[2]=t[e],s[4]=e,s}function We(i){let t,e,s=i[4]+1+"",a,n,o,r=i[2].an+"",u,p;return{c(){t=$("tr"),e=$("td"),a=z(s),n=q(),o=$("td"),u=z(r),p=q()},m(g,l){ie(g,t,l),E(t,e),E(e,a),E(t,n),E(t,o),E(o,u),E(t,p)},p(g,l){l&1&&r!==(r=g[2].an+"")&&J(u,r)},d(g){g&&ne(t)}}}function rt(i){let t,e,s,a,n,o,r,u,p,g,l,c,v,m,M;s=new $e({props:{player:i[0].dark}}),r=new $e({props:{player:i[0].light}});let P=i[0].board.history,y=[];for(let d=0;d<P.length;d+=1)y[d]=We(Be(i,P,d));return{c(){t=$("section"),e=$("div"),le(s.$$.fragment),a=q(),n=$("div"),o=q(),le(r.$$.fragment),u=q(),p=$("div"),g=$("table"),l=$("tr"),l.innerHTML=`<th>Num. of Moves</th> 
        <th>Desc.</th>`,c=q();for(let d=0;d<y.length;d+=1)y[d].c();v=q(),m=z(i[1]),W(n,"id","game"),W(e,"id","game-wrapper"),W(e,"class","svelte-1xamruw"),W(g,"class","svelte-1xamruw"),W(p,"id","history"),W(p,"class","svelte-1xamruw"),W(t,"id","main"),W(t,"class","svelte-1xamruw")},m(d,S){ie(d,t,S),E(t,e),ce(s,e,null),E(e,a),E(e,n),E(e,o),ce(r,e,null),E(t,u),E(t,p),E(p,g),E(g,l),E(g,c);for(let K=0;K<y.length;K+=1)y[K].m(g,null);E(t,v),E(t,m),M=!0},p(d,[S]){const K={};S&1&&(K.player=d[0].dark),s.$set(K);const L={};if(S&1&&(L.player=d[0].light),r.$set(L),S&1){P=d[0].board.history;let k;for(k=0;k<P.length;k+=1){const D=Be(d,P,k);y[k]?y[k].p(D,S):(y[k]=We(D),y[k].c(),y[k].m(g,null))}for(;k<y.length;k+=1)y[k].d(1);y.length=P.length}(!M||S&2)&&J(m,d[1])},i(d){M||(ge(s.$$.fragment,d),ge(r.$$.fragment,d),M=!0)},o(d){ue(s.$$.fragment,d),ue(r.$$.fragment,d),M=!1},d(d){d&&ne(t),fe(s),fe(r),Ve(y,d)}}}function ht(i,t,e){let s,{game:a}=t;return i.$$set=n=>{"game"in n&&e(0,a=n.game)},i.$$.update=()=>{i.$$.dirty&1&&e(1,s=a.whoWon)},[a,s]}class lt extends Me{constructor(t){super(),Pe(this,t,ht,rt,Se,{game:0})}}function ct(i){let t,e,s,a,n,o,r,u,p;return e=new lt({props:{game:i[1]}}),{c(){t=$("main"),le(e.$$.fragment),s=q(),a=$("button"),a.textContent="Start",n=q(),o=$("button"),o.textContent="Pause",Ce(t,"--game-height",i[0].canvasSize+"px"),W(t,"class","svelte-1910pwy")},m(g,l){ie(g,t,l),ce(e,t,null),E(t,s),E(t,a),E(t,n),E(t,o),r=!0,u||(p=[Le(a,"click",i[2]),Le(o,"click",i[3])],u=!0)},p(g,[l]){const c={};l&2&&(c.game=g[1]),e.$set(c),(!r||l&1)&&Ce(t,"--game-height",g[0].canvasSize+"px")},i(g){r||(ge(e.$$.fragment,g),r=!0)},o(g){ue(e.$$.fragment,g),r=!1},d(g){g&&ne(t),fe(e),u=!1,Ze(p)}}}function gt(i,t,e){let s;const a=new URL(location.href);a.searchParams.get("fen")&&(B.game.board.fen=a.searchParams.get("fen")),B.canvasParent="game",B.canvasSize=700,Ge.onpiecemove=(r,u,p)=>{e(1,s=B.game),console.log(s.board.darkCoverage.size)},new be(nt),console.table(B.game.board.darkKing);const n=r=>e(1,s.hasStarted=!0,s),o=r=>s.isPaused?s.start():s.pause();return i.$$.update=()=>{i.$$.dirty&1&&e(1,s=B.game)},[B,s,n,o]}class ut extends Me{constructor(t){super(),Pe(this,t,gt,ct,Se,{})}}new ut({target:document.getElementById("app")});
