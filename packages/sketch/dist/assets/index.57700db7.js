var ee=Object.defineProperty;var te=(n,e,t)=>e in n?ee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>(te(n,typeof e!="symbol"?e+"":e,t),t),R=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var A=(n,e,t)=>(R(n,e,"read from private field"),t?t.call(n):e.get(n)),E=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},P=(n,e,t,s)=>(R(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);var k=(n,e,t)=>(R(n,e,"access private method"),t);import{v as se,p as ie}from"./vendor.ada7163b.js";const ne=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};ne();var p;(function(n){n.LightKing="\u2654",n.LightQueen="\u2655",n.LightRook="\u2656",n.LightBishop="\u2657",n.LightKnight="\u2658",n.LightPawn="\u2659",n.DarkKing="\u265A",n.DarkQueen="\u265B",n.DarkRook="\u265C",n.DarkBishop="\u265D",n.DarkKnight="\u265E",n.DarkPawn="\u265F"})(p||(p={}));function I(n,e){var s;const t=this.shade==="dark"?n.lightKing:n.darkKing;if(t){let i=!1;for(const o of e)if(((s=o.piece)==null?void 0:s.uuid)===t.uuid){i=!0;break}i&&(this.pathToEnemyKing=e)}return e}var r;(function(n){n[n.NORTH=0]="NORTH",n[n.NE=1]="NE",n[n.EAST=2]="EAST",n[n.SE=3]="SE",n[n.SOUTH=4]="SOUTH",n[n.SW=5]="SW",n[n.WEST=6]="WEST",n[n.NW=7]="NW"})(r||(r={}));function _(n){switch(n){case r.NORTH:return{rank:1,file:0};case r.NE:return{rank:1,file:1};case r.EAST:return{rank:0,file:1};case r.SE:return{rank:-1,file:1};case r.SOUTH:return{rank:-1,file:0};case r.SW:return{rank:-1,file:-1};case r.WEST:return{rank:0,file:-1};case r.NW:return{rank:1,file:-1}}}function j(n,e){return Y(this,n,e)}function X(n,e){return Y(this,n,e)}function Y(n,e,t){var h,a;const s=[],i=_(e);let o=t.getSquare((h=n.pos)==null?void 0:h.rank,(a=n.pos)==null?void 0:a.file);for(;o&&(o=t.getSquare(o.pos.rank+i.rank,o.pos.file+i.file));)s.push(o);return s}class G{constructor(e,t){c(this,"piece",null);c(this,"shade");c(this,"pos");c(this,"chessPosition");this.shade=e,this.pos=t,this.chessPosition=this.getChessPosition()}getChessPosition(){const t=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:t}}}var m,q,oe;class K{constructor(e,t,s,i,o){E(this,q);c(this,"type");c(this,"shade");c(this,"pos");c(this,"unicodeChar");c(this,"fenChar");c(this,"defaultMoves",[]);c(this,"legalMoves",[]);c(this,"coverage",[]);c(this,"threatens",new Set);c(this,"threatenedBy",new Set);c(this,"protects",new Set);c(this,"protectedBy",new Set);c(this,"uuid",se());c(this,"myKingIsUnderCheck",!1);E(this,m,[]);c(this,"timesMoved",0);c(this,"canBeEaten",!0);this.type=e,this.shade=t,this.pos=i;const{unicode:h,fenChar:a}=k(this,q,oe).call(this);this.unicodeChar=h,this.fenChar=a,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=o||[]}get initialSquares(){return A(this,m)}set initialSquares(e){P(this,m,e)}getDefaultMoves(e){return[]}getLegalMoves(e){return[]}getCoverageMoves(e){return this.legalMoves}moveConditions(e){return!1}isMoveLegal(e){return this.legalMoves.includes(e)}threaten(){this.coverage.forEach(e=>{e.piece&&e.piece.shade!==this.shade&&(this.threatens.add(e.piece),e.piece.threatenedBy.add(this))})}doIIntersect(){const e=this.threatenedBy;for(const t of e)if(t.type==="Bishop"||t.type==="Queen"||t.type==="Rook"){const s=t;for(const i of s.pathToEnemyKing)if(i.piece===this)return!0}return!1}findMovesToProtectKing(e){const t=this.shade==="dark"?e.darkKing:e.lightKing;if(t&&t.threatenedBy.size<=1)for(const s of t.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(i=>{var o;return s.pathToEnemyKing.includes(i)||i.pos.rank===((o=s.pos)==null?void 0:o.rank)&&i.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(i=>{var o;return i.pos.rank===((o=s.pos)==null?void 0:o.rank)&&i.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(e,t,s){if(e instanceof G){let i=!1;return e.piece?(i=!1,e.piece.shade!==this.shade?i=!0:(i=!1,this.protects.add(e.piece),e.piece.protectedBy.add(this))):i=!0,s&&(i=s()),i}else{const i=[];for(const o of e)if(!o.piece)i.push(o);else if(o.piece.shade!==this.shade){i.push(o);break}else{this.protects.add(o.piece),o.piece.protectedBy.add(this);break}return i}}move(e,t){const s=t.getSquare(e.rank,e.file);if(!s)return;const i=s==null?void 0:s.piece;if(s&&!this.isMoveLegal(s)||i&&!(i!=null&&i.canBeEaten))return;if(this.pos&&t.setPiece(null,this.pos.rank,this.pos.file),i&&i.canBeEaten){const h=t.getPiece(e.rank,e.file);t.pieces=t.pieces.filter(a=>a!==h),t.setPiece(null,e.rank,e.file)}else if(this.type==="Pawn"&&(i==null?void 0:i.canBeEaten)){const h=this.shade==="dark"?-1:1,a=t.getSquare(e.rank-h,e.file);a&&(t.setPiece(null,a.pos.rank,a.pos.file),this.canTakeEnPassant=null,this.timesEnPassant++)}t.setPiece(this,e.rank,e.file),this.timesMoved++;let o=t.pieceHistory.get(this.uuid);t.pieceHistory.set(this.uuid,o+1),t.totalMoves++,t.history.push({uuid:this.uuid})}}m=new WeakMap,q=new WeakSet,oe=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:p.DarkKing,fenChar:"k"};case"Queen":return{unicode:p.DarkQueen,fenChar:"q"};case"Rook":return{unicode:p.DarkRook,fenChar:"r"};case"Bishop":return{unicode:p.DarkBishop,fenChar:"b"};case"Knight":return{unicode:p.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:p.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:p.LightKing,fenChar:"K"};case"Queen":return{unicode:p.LightQueen,fenChar:"Q"};case"Rook":return{unicode:p.LightRook,fenChar:"R"};case"Bishop":return{unicode:p.LightBishop,fenChar:"B"};case"Knight":return{unicode:p.LightKnight,fenChar:"N"};case"Pawn":return{unicode:p.LightPawn,fenChar:"P"}}}};class J extends K{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:0},{rank:i,file:7}];super("Rook",e,t,s,o);c(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,t){return[]}straightMove(e,t){return[]}getLegalMoves(e){const t=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.NORTH,e))),s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.EAST,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.SOUTH,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(r.WEST,e)));return[...t,...s,...i,...o]}getDefaultMoves(e){const t=this.straightMove(r.NORTH,e),s=this.straightMove(r.EAST,e),i=this.straightMove(r.SOUTH,e),o=this.straightMove(r.WEST,e);return[...t,...s,...i,...o]}}Object.assign(J.prototype,{straightMove:X,getPathToEnemyKing:I});class V extends K{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:2},{rank:i,file:5}];super("Bishop",e,t,s,o);c(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,t){return[]}diagonalMove(e,t){return[]}getLegalMoves(e){const t=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.NE,e))),s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.SE,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.SW,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(r.NW,e)));return[...t,...s,...i,...o]}getDefaultMoves(e){const t=this.diagonalMove(r.NE,e),s=this.diagonalMove(r.SE,e),i=this.diagonalMove(r.SW,e),o=this.diagonalMove(r.NW,e);return[...t,...s,...i,...o]}}Object.assign(V.prototype,{diagonalMove:j,getPathToEnemyKing:I});var O,ae;class D extends K{constructor(e,t,s){const o=[{rank:e==="dark"?7:0,file:4}];super("King",e,t,s,o);E(this,O);this.canBeEaten=!1}getLegalMoves(e){const t=this.shade==="dark"?e.lightCoverage:e.darkCoverage,s=[];return this.defaultMoves.forEach(i=>{this.checkMoveLegality(i)&&!t.has(i)&&!k(this,O,ae).call(this,i.piece)&&s.push(i)}),s}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var i,o;const t=[],s=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let h=0;h<8;h++){const a=_(r[s[h]]),u=e.getSquare(((i=this.pos)==null?void 0:i.rank)+a.rank,((o=this.pos)==null?void 0:o.file)+a.file);u&&t.push(u)}return t}}O=new WeakSet,ae=function(e){return e?this.threatenedBy.has(e)&&e.protectedBy.size>0:!1};class Z extends K{constructor(e,t,s){const o=[{rank:e==="dark"?7:0,file:3}];super("Queen",e,t,s,o);c(this,"pathToEnemyKing",[])}diagonalMove(e,t){return[]}straightMove(e,t){return[]}getPathToEnemyKing(e,t){return[]}getLegalMoves(e){const t=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.NORTH,e)),e),s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.EAST,e)),e),i=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.SOUTH,e)),e),o=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(r.WEST,e)),e),h=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.NE,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.SE,e)),e),u=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.SW,e)),e),v=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(r.NW,e)),e);return[...t,...h,...s,...a,...i,...u,...o,...v]}getDefaultMoves(e){const t=this.straightMove(r.NORTH,e),s=this.straightMove(r.EAST,e),i=this.straightMove(r.SOUTH,e),o=this.straightMove(r.WEST,e),h=this.diagonalMove(r.NE,e),a=this.diagonalMove(r.SE,e),u=this.diagonalMove(r.SW,e),v=this.diagonalMove(r.NW,e);return[...t,...h,...s,...a,...i,...u,...o,...v]}}Object.assign(Z.prototype,{diagonalMove:j,straightMove:X,getPathToEnemyKing:I});class he extends K{constructor(e,t,s){const i=e==="dark"?7:0,o=[{rank:i,file:1},{rank:i,file:6}];super("Knight",e,t,s,o)}getDefaultMoves(e){const t=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(i=>{const o=e.getSquare(this.pos.rank+i[0],this.pos.file+i[1]);o&&t.push(o)}),t}getLegalMoves(e){const t=this.defaultMoves,s=[];return t.forEach(i=>{i&&this.checkMoveLegality(i)&&s.push(i)}),s}}var C,F;const H=class extends K{constructor(e,t,s){const i=e==="light"?1:6,h=[0,1,2,3,4,5,6,7].map(a=>({rank:i,file:a}));super("Pawn",e,t,s,h);E(this,C);c(this,"canTakeEnPassant",null);c(this,"timesEnPassant",0)}getLegalMoves(e){const t=this.defaultMoves,s=[];return t.forEach(i=>{i&&this.checkMoveLegality(i,e,()=>this.moveConditions(i))&&s.push(i)}),s}moveConditions(e){var s,i,o,h,a,u;const t=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-t===((s=this.canTakeEnPassant.pos)==null?void 0:s.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((i=this.pos)==null?void 0:i.rank)+t||e.pos.rank===((o=this.pos)==null?void 0:o.rank)+t*2?e.pos.rank!==((h=this.pos)==null?void 0:h.rank)+t*2&&(e.pos.file===((a=this.pos)==null?void 0:a.file)+t||e.pos.file===((u=this.pos)==null?void 0:u.file)-t)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const t=this.shade==="light"?1:-1;return this.defaultMoves.filter(s=>{var i,o;return!(s.pos.file===((i=this.pos)==null?void 0:i.file)&&(s.pos.rank===((o=this.pos)==null?void 0:o.rank)+t||s.pos.rank===this.pos.rank+t*2))})}getDefaultMoves(e){const t=[];if(this.pos){this.canTakeEnPassant=null;const s=this.shade==="light"?1:-1,i=e.getSquare(this.pos.rank+s,this.pos.file),o=e.getSquare(this.pos.rank+s*2,this.pos.file),h=e.getSquare(this.pos.rank+s,this.pos.file+s),a=e.getSquare(this.pos.rank+s,this.pos.file-s);if(i&&!(i!=null&&i.piece)&&(t.push(i),this.timesMoved===0&&this.initialSquares.find(u=>{var v,S;return u.rank===((v=this.pos)==null?void 0:v.rank)&&u.file===((S=this.pos)==null?void 0:S.file)})&&o&&!(o!=null&&o.piece)&&t.push(o)),h&&t.push(h),a&&t.push(a),this.timesEnPassant===0){const u=e.getSquare(this.pos.rank,this.pos.file+s),v=e.getSquare(this.pos.rank,this.pos.file-s);h&&!h.piece&&u&&u.piece instanceof H&&k(this,C,F).call(this,u.piece,e)&&(t.includes(h)||t.push(h)),a&&!a.piece&&v&&v.piece instanceof H&&k(this,C,F).call(this,v.piece,e)&&(t.includes(a)||t.push(a))}}return t}};let b=H;C=new WeakSet,F=function(e,t){return t.pieceHistory.get(e.uuid)===1&&t.history[t.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,!0):!1};var y,L,Q,N,U,w,z,B,$;class re{constructor(e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){E(this,L);E(this,N);E(this,w);E(this,B);c(this,"board");E(this,y,void 0);c(this,"pieces",[]);c(this,"lightKing",null);c(this,"darkKing",null);c(this,"darkCoverage",new Set);c(this,"lightCoverage",new Set);c(this,"pieceHistory",new Map);c(this,"totalMoves",0);c(this,"whoWon",null);c(this,"history",[]);this.board=k(this,w,z).call(this),P(this,y,e)}get fen(){return A(this,y)}set fen(e){this.legalFEN(e)&&(P(this,y,e),this.emptyBoard(),this.loadPieces())}legalFEN(e){let t=0,s=0;for(const i of e){const o=parseInt(i);i==="/"?t++:isNaN(o)?s++:s+=o}return t===7&&s===64}emptyBoard(){this.board=k(this,w,z).call(this)}loadPieces(e){e&&this.legalFEN(e)&&(this.fen=e);let t=this.board.length-1,s=0,i=0,o="";for(;t>=0&&(o=this.fen[i]);){const h=parseInt(o);if(o==="/")t--,s=0;else if(isNaN(h)){let a=null;switch(o){case"K":this.lightKing=a=new D("light",this);break;case"k":this.darkKing=a=new D("dark",this);break;case"Q":case"q":a=new Z(o==="q"?"dark":"light",this);break;case"R":case"r":a=new J(o==="r"?"dark":"light",this);break;case"N":case"n":a=new he(o==="n"?"dark":"light",this);break;case"B":case"b":a=new V(o==="b"?"dark":"light",this);break;case"P":case"p":a=new b(o==="p"?"dark":"light",this);break}this.board[t][s].piece=a,a&&(a.pos=this.board[t][s].pos,this.pieces.push(a),this.pieceHistory.set(a.uuid,0)),s++}else s+=h;i++}k(this,L,Q).call(this)}getKing(e){return this.pieces.find(s=>s.shade===e&&s.type==="King")||null}generateFEN(){let e="",t=0;return this.forEach((s,i,o)=>{!s||!s.piece?t++:(t>0&&(e+=t,t=0),e+=s.piece.fenChar),o===this.board[i].length-1&&(t>0&&(e+=t,t=0),i!=0&&(e+="/"))}),e}forEach(e){for(let t=this.board.length-1;t>=0;t--)for(let s=0;s<this.board[t].length;s++)e(this.getSquare(t,s),t,s)}setPiece(e,t,s){return k(this,B,$).call(this,t,s)?(this.board[t][s].piece=e,e&&(e.pos=this.board[t][s].pos),P(this,y,this.generateFEN()),!0):!1}getPiece(e,t){const s=this.getSquare(e,t);return s?s.piece:null}getSquare(e,t){return k(this,B,$).call(this,e,t)?this.board[e][t]:null}movePiece(e,t){t&&(t.move(e,this),k(this,L,Q).call(this))}displayInConsole(){const e="\u2502",t="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",i="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",o=["a","b","c","d","e","f","g","h"];for(let h=this.board.length-1;h>=0;h--){let a=`${h+1} ${e} `;for(let u=0;u<this.board[h].length;u++){const v=this.getPiece(h,u);v?a+=v.unicodeChar:a+=" ",a+=` ${e} `}console.log(h===7?t:s),console.log(a),h===0&&console.log(i)}console.log(`  ${e} `+o.join(` ${e} `)+` ${e}`)}}y=new WeakMap,L=new WeakSet,Q=function(){this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(e=>{e.threatenedBy.clear(),e.threatens.clear(),e.protects.clear(),e.protectedBy.clear(),e.myKingIsUnderCheck=!1,"pathToEnemyKing"in e&&(e.pathToEnemyKing=[])}),this.pieces.forEach(e=>{e.defaultMoves=e.getDefaultMoves(this),e.legalMoves=e.getLegalMoves(this),e.coverage=e.getCoverageMoves(this),console.table(e),e.threaten()}),this.pieces.forEach(e=>{e.doIIntersect()&&e.threatenedBy.forEach(t=>{e.legalMoves=e.legalMoves.filter(s=>s.piece===t)}),e.shade==="light"?e.coverage.forEach(t=>this.lightCoverage.add(t)):e.coverage.forEach(t=>this.darkCoverage.add(t))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.isUnderCheck&&k(this,N,U).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.isUnderCheck&&k(this,N,U).call(this,this.lightKing)),this.darkCoverage.size===0&&(this.whoWon="light"),this.lightCoverage.size===0&&(this.whoWon="dark")},N=new WeakSet,U=function(e){const t=e.shade==="dark"?this.darkCoverage:this.lightCoverage;console.log("what"),this.pieces.forEach(s=>{s.shade===e.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this))}),t.clear(),this.pieces.forEach(s=>{s.shade===e.shade&&s.coverage.forEach(i=>{t.add(i)})})},w=new WeakSet,z=function(){const e=new Array(8);for(let t=0;t<e.length;t++)e[t]=new Array(8);for(let t=e.length-1;t>=0;t--)for(let s=0;s<e[t].length;s++)e[t][s]=new G((s+t)%2===1?"light":"dark",{rank:t,file:s});return e},B=new WeakSet,$=function(e,t){return 0<=e&&e<this.board.length&&0<=t&&t<this.board[e].length};const x={canvasSize:900,canvasParent:"app"},ce=n=>{const e=new re;let t=null,s=!1;n.setup=()=>{n.createCanvas(x.canvasSize,x.canvasSize).parent(x.canvasParent),n.background(0,0,0),e.loadPieces()};const i=(g,l=!1)=>{const f=n.width,d=n.height,M=8;let T=g.file*f/M,W=(g.rank+7-g.rank*2)*d/M;return l&&(T+=f/(M*2),W+=d/(M*2)),[T,W]},o=(g,l)=>{if(g.pos){let f,d;if(l)f=l.x,d=l.y;else{const[M,T]=i(g.pos,!0);f=M,d=T}n.push(),n.fill(0,0,255),n.textSize(50),n.textAlign(n.CENTER,n.CENTER),n.text(g.unicodeChar,f,d),n.pop()}},h=(g,l,f,d)=>{n.fill(...f),n.square(g,l,n.width/8),n.fill(255,0,0),n.text(`${d.file}${d.rank}`,g,l+n.height/8)},a=(g,l=h)=>{const[f,d]=i(g.pos),M=g.shade==="dark"?[0,0,0]:[255,255,255],{rank:T,file:W}=g.chessPosition;n.push(),n.noStroke(),l(f,d,M,{rank:T,file:W}),n.pop()},u=g=>{g.forEach(l=>{l&&a(l)}),t&&t.piece&&(a(t,(l,f)=>{n.fill(0,0,120,175),n.square(l,f,n.width/8)}),t.piece.legalMoves.forEach(l=>{a(l,(f,d)=>{n.fill(0,255,0,150),l.piece&&!l.piece.canBeEaten&&n.fill(255,0,0,150),n.square(f,d,n.width/8)})})),g.pieces.forEach(l=>{l===(t==null?void 0:t.piece)&&s?o(l,{x:n.mouseX,y:n.mouseY}):o(l)})},v=g=>{const[l,f]=i(g.pos);return[n.mouseX>=l&&n.mouseX<=l+n.width/8&&n.mouseY>=f&&n.mouseY<=f+n.height/8,l,f]},S=()=>{var g;(g=t==null?void 0:t.piece)==null||g.legalMoves.forEach(l=>{const[f]=v(l);f&&(e.movePiece(l.pos,t.piece),t=null)}),e.forEach(l=>{l&&v(l)[0]&&(t=l)})};n.mousePressed=()=>{switch(n.mouseButton){case n.LEFT:S();break}},n.mouseDragged=()=>{switch(n.mouseButton){case n.LEFT:t&&t.piece?s=!0:S();break}},n.mouseReleased=()=>{s=!1,t&&S()},n.draw=()=>{u(e)}};new ie(ce);
