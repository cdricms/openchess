var ke=Object.defineProperty;var se=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var $=(n,t,e)=>t in n?ke(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,ie=(n,t)=>{for(var e in t||(t={}))ve.call(t,e)&&$(n,e,t[e]);if(se)for(var e of se(t))de.call(t,e)&&$(n,e,t[e]);return n};var c=(n,t,e)=>($(n,typeof t!="symbol"?t+"":t,e),e),_=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var j=(n,t,e)=>(_(n,t,"read from private field"),e?e.call(n):t.get(n)),m=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},R=(n,t,e,s)=>(_(n,t,"write to private field"),s?s.call(n,e):t.set(n,e),e);var S=(n,t,e)=>(_(n,t,"access private method"),e);import{v as Ee,p as Me}from"./vendor.ada7163b.js";const ye=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}};ye();var T;(function(n){n.LightKing="\u2654",n.LightQueen="\u2655",n.LightRook="\u2656",n.LightBishop="\u2657",n.LightKnight="\u2658",n.LightPawn="\u2659",n.DarkKing="\u265A",n.DarkQueen="\u265B",n.DarkRook="\u265C",n.DarkBishop="\u265D",n.DarkKnight="\u265E",n.DarkPawn="\u265F"})(T||(T={}));function te(n,t){var s;const e=this.shade==="dark"?n.lightKing:n.darkKing;if(e){let i=!1;for(const o of t)if(((s=o.piece)==null?void 0:s.uuid)===e.uuid){i=!0;break}i&&(this.pathToEnemyKing=t)}return t}var l;(function(n){n[n.NORTH=0]="NORTH",n[n.NE=1]="NE",n[n.EAST=2]="EAST",n[n.SE=3]="SE",n[n.SOUTH=4]="SOUTH",n[n.SW=5]="SW",n[n.WEST=6]="WEST",n[n.NW=7]="NW"})(l||(l={}));function oe(n){switch(n){case l.NORTH:return{rank:1,file:0};case l.NE:return{rank:1,file:1};case l.EAST:return{rank:0,file:1};case l.SE:return{rank:-1,file:1};case l.SOUTH:return{rank:-1,file:0};case l.SW:return{rank:-1,file:-1};case l.WEST:return{rank:0,file:-1};case l.NW:return{rank:1,file:-1}}}function ae(n,t){return re(this,n,t)}function he(n,t){return re(this,n,t)}function re(n,t,e){var a,h;const s=[],i=oe(t);let o=e.getSquare((a=n.pos)==null?void 0:a.rank,(h=n.pos)==null?void 0:h.file);for(;o&&(o=e.getSquare(o.pos.rank+i.rank,o.pos.file+i.file));)s.push(o);return s}class le{constructor(t,e){c(this,"piece",null);c(this,"shade");c(this,"pos");c(this,"chessPosition");this.shade=t,this.pos=e,this.chessPosition=this.getChessPosition()}getChessPosition(){const e=["A","B","C","D","E","F","G","H"][this.pos.file];return{rank:this.pos.rank+1,file:e}}}var O,Q,ce;class B{constructor(t,e,s,i,o){m(this,Q);c(this,"type");c(this,"shade");c(this,"pos");c(this,"unicodeChar");c(this,"fenChar");c(this,"defaultMoves",[]);c(this,"legalMoves",[]);c(this,"coverage",[]);c(this,"threatens",new Set);c(this,"threatenedBy",new Set);c(this,"protects",new Set);c(this,"protectedBy",new Set);c(this,"uuid",Ee());c(this,"myKingIsUnderCheck",!1);m(this,O,[]);c(this,"timesMoved",0);c(this,"canBeEaten",!0);this.type=t,this.shade=e,this.pos=i;const{unicode:a,fenChar:h}=S(this,Q,ce).call(this);this.unicodeChar=a,this.fenChar=h,this.defaultMoves=this.getDefaultMoves(s),this.legalMoves=this.getLegalMoves(s),this.initialSquares=o||[]}get initialSquares(){return j(this,O)}set initialSquares(t){R(this,O,t)}getDefaultMoves(t){return[]}getLegalMoves(t){return[]}getCoverageMoves(t){return this.legalMoves}moveConditions(t){return!1}isMoveLegal(t){return this.legalMoves.includes(t)}threaten(){this.coverage.forEach(t=>{t.piece&&t.piece.shade!==this.shade&&(this.threatens.add(t.piece),t.piece.threatenedBy.add(this))})}doIIntersect(){const t=this.threatenedBy;for(const e of t)if(e.type==="Bishop"||e.type==="Queen"||e.type==="Rook"){const s=e;for(const i of s.pathToEnemyKing)if(i.piece===this)return!0}return!1}findMovesToProtectKing(t){const e=this.shade==="dark"?t.darkKing:t.lightKing;if(e&&e.threatenedBy.size<=1)for(const s of e.threatenedBy)"getPathToEnemyKing"in s?this.legalMoves=this.legalMoves.filter(i=>{var o;return s.pathToEnemyKing.includes(i)||i.pos.rank===((o=s.pos)==null?void 0:o.rank)&&i.pos.file===s.pos.file}):this.legalMoves=this.legalMoves.filter(i=>{var o;return i.pos.rank===((o=s.pos)==null?void 0:o.rank)&&i.pos.file===s.pos.file});else this.legalMoves=[]}checkMoveLegality(t,e,s){if(t instanceof le){let i=!1;return t.piece?(i=!1,t.piece.shade!==this.shade?i=!0:(i=!1,this.protects.add(t.piece),t.piece.protectedBy.add(this))):i=!0,s&&(i=s()),i}else{const i=[];for(const o of t)if(!o.piece)i.push(o);else if(o.piece.shade!==this.shade){i.push(o);break}else{this.protects.add(o.piece),o.piece.protectedBy.add(this);break}return i}}move(t,e){var h,f,p,d,P,g,r,u,k,y,K,L,N,C;const s=this.shade==="dark"?-1:1,i=e.getSquare(t.rank,t.file);if(!i)return;const o=i==null?void 0:i.piece;if(i&&!this.isMoveLegal(i)||o&&!(o!=null&&o.canBeEaten))return;if(this.pos&&e.setPiece(null,this.pos.rank,this.pos.file),o&&o.canBeEaten){const v=e.getPiece(t.rank,t.file);e.pieces=e.pieces.filter(E=>E!==v),e.setPiece(null,t.rank,t.file)}else if(this.type==="Pawn"){const v=this;((f=(h=v.canTakeEnPassant)==null?void 0:h.pos)==null?void 0:f.file)===t.file&&v.canTakeEnPassant.pos.rank===t.rank-s&&(e.setPiece(null,v.canTakeEnPassant.pos.rank,v.canTakeEnPassant.pos.file),e.pieces=e.pieces.filter(E=>E!==v.canTakeEnPassant),v.canTakeEnPassant=null,v.timesEnPassant=v.timesEnPassant+1)}else if(this.type==="King"&&this.timesMoved===0){const v=this.legalMoves.find(M=>{var W,q;return M.pos.file===((W=this.pos)==null?void 0:W.file)+2&&M.pos.rank===((q=this.pos)==null?void 0:q.rank)}),E=this.legalMoves.find(M=>{var W,q;return M.pos.file===((W=this.pos)==null?void 0:W.file)-2&&M.pos.rank===((q=this.pos)==null?void 0:q.rank)});if(v){const M=e.getPiece((p=this.pos)==null?void 0:p.rank,((d=this.pos)==null?void 0:d.file)+3);M&&(e.setPiece(null,(P=M.pos)==null?void 0:P.rank,(g=M.pos)==null?void 0:g.file),e.setPiece(M,(r=this.pos)==null?void 0:r.rank,((u=this.pos)==null?void 0:u.file)+1))}if(E){const M=e.getPiece((k=this.pos)==null?void 0:k.rank,((y=this.pos)==null?void 0:y.file)-4);M&&(e.setPiece(null,(K=M.pos)==null?void 0:K.rank,(L=M.pos)==null?void 0:L.file),e.setPiece(M,(N=this.pos)==null?void 0:N.rank,((C=this.pos)==null?void 0:C.file)-1))}}e.setPiece(this,t.rank,t.file),this.timesMoved++;let a=e.pieceHistory.get(this.uuid);e.pieceHistory.set(this.uuid,a+1),e.totalMoves++,e.history.push({uuid:this.uuid})}}O=new WeakMap,Q=new WeakSet,ce=function(){switch(this.shade){case"dark":switch(this.type){case"King":return{unicode:T.DarkKing,fenChar:"k"};case"Queen":return{unicode:T.DarkQueen,fenChar:"q"};case"Rook":return{unicode:T.DarkRook,fenChar:"r"};case"Bishop":return{unicode:T.DarkBishop,fenChar:"b"};case"Knight":return{unicode:T.DarkKnight,fenChar:"n"};case"Pawn":return{unicode:T.DarkPawn,fenChar:"p"}}case"light":switch(this.type){case"King":return{unicode:T.LightKing,fenChar:"K"};case"Queen":return{unicode:T.LightQueen,fenChar:"Q"};case"Rook":return{unicode:T.LightRook,fenChar:"R"};case"Bishop":return{unicode:T.LightBishop,fenChar:"B"};case"Knight":return{unicode:T.LightKnight,fenChar:"N"};case"Pawn":return{unicode:T.LightPawn,fenChar:"P"}}}};class ge extends B{constructor(e,s,i){const o=e==="dark"?7:0;super("Rook",e,s,i,[{rank:o,file:0},{rank:o,file:7}]);c(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}straightMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(l.NORTH,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(l.EAST,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(l.SOUTH,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.straightMove(l.WEST,e)));return[...s,...i,...o,...a]}getDefaultMoves(e){const s=this.straightMove(l.NORTH,e),i=this.straightMove(l.EAST,e),o=this.straightMove(l.SOUTH,e),a=this.straightMove(l.WEST,e);return[...s,...i,...o,...a]}}Object.assign(ge.prototype,{straightMove:he,getPathToEnemyKing:te});class fe extends B{constructor(e,s,i){const o=e==="dark"?7:0;super("Bishop",e,s,i,[{rank:o,file:2},{rank:o,file:5}]);c(this,"pathToEnemyKing",[])}getPathToEnemyKing(e,s){return[]}diagonalMove(e,s){return[]}getLegalMoves(e){const s=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(l.NE,e))),i=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(l.SE,e))),o=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(l.SW,e))),a=this.getPathToEnemyKing(e,this.checkMoveLegality(this.diagonalMove(l.NW,e)));return[...s,...i,...o,...a]}getDefaultMoves(e){const s=this.diagonalMove(l.NE,e),i=this.diagonalMove(l.SE,e),o=this.diagonalMove(l.SW,e),a=this.diagonalMove(l.NW,e);return[...s,...i,...o,...a]}}Object.assign(fe.prototype,{diagonalMove:ae,getPathToEnemyKing:te});var D,ue,U,pe;class ne extends B{constructor(e,s,i){super("King",e,s,i,[{rank:e==="dark"?7:0,file:4}]);m(this,D);m(this,U);this.canBeEaten=!1}getLegalMoves(e){const s=this.shade==="dark"?e.lightCoverage:e.darkCoverage,i=[];return this.defaultMoves.forEach(o=>{this.checkMoveLegality(o)&&!s.has(o)&&!S(this,D,ue).call(this,o.piece)&&!S(this,U,pe).call(this,o)&&i.push(o)}),i}get isUnderCheck(){return this.threatenedBy.size>0}getDefaultMoves(e){var o,a,h,f,p,d,P,g,r,u,k,y,K,L;const s=[],i=["NORTH","NE","EAST","SE","SOUTH","SW","WEST","NW"];for(let N=0;N<8;N++){const C=oe(l[i[N]]),v=e.getSquare(((o=this.pos)==null?void 0:o.rank)+C.rank,((a=this.pos)==null?void 0:a.file)+C.file);v&&s.push(v)}if(this.timesMoved===0){const N=e.getPiece((h=this.pos)==null?void 0:h.rank,((f=this.pos)==null?void 0:f.file)+3),C=e.getPiece((p=this.pos)==null?void 0:p.rank,((d=this.pos)==null?void 0:d.file)-4);if(N&&N.type==="Rook"&&N.shade===this.shade){let v=!0;for(let E=1;E<3;E++)if(e.getPiece((P=this.pos)==null?void 0:P.rank,((g=this.pos)==null?void 0:g.file)+E)){v=!1;break}if(v){const E=e.getSquare((r=this.pos)==null?void 0:r.rank,((u=this.pos)==null?void 0:u.file)+2);E&&s.push(E)}}if(C&&C.type==="Rook"&&C.shade===this.shade){let v=!0;for(let E=1;E<4;E++)if(e.getPiece((k=this.pos)==null?void 0:k.rank,((y=this.pos)==null?void 0:y.file)-E)){v=!1;break}if(v){const E=e.getSquare((K=this.pos)==null?void 0:K.rank,((L=this.pos)==null?void 0:L.file)-2);E&&s.push(E)}}}return s}}D=new WeakSet,ue=function(e){return e?this.threatenedBy.has(e)&&e.protectedBy.size>0:!1},U=new WeakSet,pe=function(e){for(const s of this.threatenedBy)if("getPathToEnemyKing"in s)return s.pathToEnemyKing.includes(e);return!1};class Y extends B{constructor(e,s,i){super("Queen",e,s,i,[{rank:e==="dark"?7:0,file:3}]);c(this,"pathToEnemyKing",[])}diagonalMove(e,s){return[]}straightMove(e,s){return[]}getPathToEnemyKing(e,s){return[]}getLegalMoves(e){const s=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(l.NORTH,e)),e),i=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(l.EAST,e)),e),o=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(l.SOUTH,e)),e),a=this.checkMoveLegality(this.getPathToEnemyKing(e,this.straightMove(l.WEST,e)),e),h=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(l.NE,e)),e),f=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(l.SE,e)),e),p=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(l.SW,e)),e),d=this.checkMoveLegality(this.getPathToEnemyKing(e,this.diagonalMove(l.NW,e)),e);return[...s,...h,...i,...f,...o,...p,...a,...d]}getDefaultMoves(e){const s=this.straightMove(l.NORTH,e),i=this.straightMove(l.EAST,e),o=this.straightMove(l.SOUTH,e),a=this.straightMove(l.WEST,e),h=this.diagonalMove(l.NE,e),f=this.diagonalMove(l.SE,e),p=this.diagonalMove(l.SW,e),d=this.diagonalMove(l.NW,e);return[...s,...h,...i,...f,...o,...p,...a,...d]}}Object.assign(Y.prototype,{diagonalMove:ae,straightMove:he,getPathToEnemyKing:te});class Se extends B{constructor(t,e,s){const i=t==="dark"?7:0,o=[{rank:i,file:1},{rank:i,file:6}];super("Knight",t,e,s,o)}getDefaultMoves(t){const e=[];return this.pos&&[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(i=>{const o=t.getSquare(this.pos.rank+i[0],this.pos.file+i[1]);o&&e.push(o)}),e}getLegalMoves(t){const e=this.defaultMoves,s=[];return e.forEach(i=>{i&&this.checkMoveLegality(i)&&s.push(i)}),s}}var H,J;const z=class extends B{constructor(e,s,i){const o=e==="light"?1:6,h=[0,1,2,3,4,5,6,7].map(f=>({rank:o,file:f}));super("Pawn",e,s,i,h);m(this,H);c(this,"canTakeEnPassant",null);c(this,"timesEnPassant",0)}getLegalMoves(e){const s=this.defaultMoves,i=[];return s.forEach(o=>{o&&this.checkMoveLegality(o,e,()=>this.moveConditions(o))&&i.push(o)}),i}moveConditions(e){var i,o,a,h,f,p;const s=this.shade==="light"?1:-1;return this.canTakeEnPassant&&e.pos.rank-s===((i=this.canTakeEnPassant.pos)==null?void 0:i.rank)&&e.pos.file===this.canTakeEnPassant.pos.file?!0:e.pos.rank===((o=this.pos)==null?void 0:o.rank)+s||e.pos.rank===((a=this.pos)==null?void 0:a.rank)+s*2?e.pos.rank!==((h=this.pos)==null?void 0:h.rank)+s*2&&(e.pos.file===((f=this.pos)==null?void 0:f.file)+s||e.pos.file===((p=this.pos)==null?void 0:p.file)-s)?e.piece!==null&&e.piece.shade!==this.shade:!e.piece:!1}getCoverageMoves(e){const s=this.shade==="light"?1:-1;return this.defaultMoves.filter(i=>{var o,a;return!(i.pos.file===((o=this.pos)==null?void 0:o.file)&&(i.pos.rank===((a=this.pos)==null?void 0:a.rank)+s||i.pos.rank===this.pos.rank+s*2))})}getDefaultMoves(e){const s=[];if(this.pos){this.canTakeEnPassant=null;const i=this.shade==="light"?1:-1,o=e.getSquare(this.pos.rank+i,this.pos.file),a=e.getSquare(this.pos.rank+i*2,this.pos.file),h=e.getSquare(this.pos.rank+i,this.pos.file+i),f=e.getSquare(this.pos.rank+i,this.pos.file-i);if(o&&!(o!=null&&o.piece)&&(s.push(o),this.timesMoved===0&&this.initialSquares.find(p=>{var d,P;return p.rank===((d=this.pos)==null?void 0:d.rank)&&p.file===((P=this.pos)==null?void 0:P.file)})&&a&&!(a!=null&&a.piece)&&s.push(a)),h&&s.push(h),f&&s.push(f),this.timesEnPassant===0){const p=e.getSquare(this.pos.rank,this.pos.file+i),d=e.getSquare(this.pos.rank,this.pos.file-i);h&&!h.piece&&p&&p.piece instanceof z&&S(this,H,J).call(this,p.piece,e)&&(s.includes(h)||s.push(h)),f&&!f.piece&&d&&d.piece instanceof z&&S(this,H,J).call(this,d.piece,e)&&(s.includes(f)||s.push(f))}}return s}};let G=z;H=new WeakSet,J=function(e,s){return e.timesMoved===1&&s.history[s.history.length-1].uuid===e.uuid?(this.canTakeEnPassant=e,console.log(e),!0):!1};var w,A,V,x,Z,I,b,F,ee;class Te{constructor(t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"){m(this,A);m(this,x);m(this,I);m(this,F);c(this,"board");m(this,w,void 0);c(this,"pieces",[]);c(this,"lightKing",null);c(this,"darkKing",null);c(this,"darkCoverage",new Set);c(this,"lightCoverage",new Set);c(this,"pieceHistory",new Map);c(this,"totalMoves",0);c(this,"whoWon",null);c(this,"history",[]);this.board=S(this,I,b).call(this),R(this,w,t)}get fen(){return j(this,w)}set fen(t){this.legalFEN(t)&&(R(this,w,t),this.emptyBoard(),this.loadPieces())}legalFEN(t){let e=0,s=0;for(const i of t){const o=parseInt(i);i==="/"?e++:isNaN(o)?s++:s+=o}return e===7&&s===64}emptyBoard(){this.pieces=[],this.board=S(this,I,b).call(this)}loadPieces(t){t&&this.legalFEN(t)&&(this.fen=t);let e=this.board.length-1,s=0,i=0,o="";for(;e>=0&&(o=this.fen[i]);){const a=parseInt(o);if(o==="/")e--,s=0;else if(isNaN(a)){let h=null;switch(o){case"K":this.lightKing=h=new ne("light",this);break;case"k":this.darkKing=h=new ne("dark",this);break;case"Q":case"q":h=new Y(o==="q"?"dark":"light",this);break;case"R":case"r":h=new ge(o==="r"?"dark":"light",this);break;case"N":case"n":h=new Se(o==="n"?"dark":"light",this);break;case"B":case"b":h=new fe(o==="b"?"dark":"light",this);break;case"P":case"p":h=new G(o==="p"?"dark":"light",this);break}this.board[e][s].piece=h,h&&(h.pos=this.board[e][s].pos,this.pieces.push(h),this.pieceHistory.set(h.uuid,0)),s++}else s+=a;i++}S(this,A,V).call(this)}getKing(t){return this.pieces.find(s=>s.shade===t&&s.type==="King")||null}generateFEN(){let t="",e=0;return this.forEach((s,i,o)=>{!s||!s.piece?e++:(e>0&&(t+=e,e=0),t+=s.piece.fenChar),o===this.board[i].length-1&&(e>0&&(t+=e,e=0),i!=0&&(t+="/"))}),t}forEach(t){for(let e=this.board.length-1;e>=0;e--)for(let s=0;s<this.board[e].length;s++)t(this.getSquare(e,s),e,s)}setPiece(t,e,s){return S(this,F,ee).call(this,e,s)?(this.board[e][s].piece=t,t&&(t.pos=this.board[e][s].pos),R(this,w,this.generateFEN()),!0):!1}getPiece(t,e){const s=this.getSquare(t,e);return s?s.piece:null}getSquare(t,e){return S(this,F,ee).call(this,t,e)?this.board[t][e]:null}movePiece(t,e){var s,i;if(e){const o=ie({},e.pos);e.move(t,this);const a=e.shade==="dark"?-1:1;if(e.type==="Pawn"&&t.rank===o.rank+a&&t.rank===(e.shade==="dark"?0:7)){const h=new Y(e.shade,this,e.pos);h.uuid=e.uuid,this.setPiece(h,(s=h.pos)==null?void 0:s.rank,(i=h.pos)==null?void 0:i.file),this.pieces=this.pieces.filter(f=>f.uuid!==e.uuid),this.pieces.push(h),console.table(this.pieces)}S(this,A,V).call(this)}}displayInConsole(){const t="\u2502",e="  \u250C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2510",s="  \u251C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2524",i="  \u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518",o=["a","b","c","d","e","f","g","h"];for(let a=this.board.length-1;a>=0;a--){let h=`${a+1} ${t} `;for(let f=0;f<this.board[a].length;f++){const p=this.getPiece(a,f);p?h+=p.unicodeChar:h+=" ",h+=` ${t} `}console.log(a===7?e:s),console.log(h),a===0&&console.log(i)}console.log(`  ${t} `+o.join(` ${t} `)+` ${t}`)}}w=new WeakMap,A=new WeakSet,V=function(){console.table(this.history),this.lightCoverage.clear(),this.darkCoverage.clear(),this.pieces.forEach(t=>{t.threatenedBy.clear(),t.threatens.clear(),t.protects.clear(),t.protectedBy.clear(),t.myKingIsUnderCheck=!1,"pathToEnemyKing"in t&&(t.pathToEnemyKing=[])}),this.pieces.forEach(t=>{t.defaultMoves=t.getDefaultMoves(this),t.legalMoves=t.getLegalMoves(this),t.coverage=t.getCoverageMoves(this),t.threaten()}),this.pieces.forEach(t=>{t.doIIntersect()&&t.threatenedBy.forEach(e=>{t.legalMoves=t.legalMoves.filter(s=>s.piece===e)}),t.shade==="light"?t.coverage.forEach(e=>this.lightCoverage.add(e)):t.coverage.forEach(e=>this.darkCoverage.add(e))}),this.darkKing&&(this.darkKing.legalMoves=this.darkKing.getLegalMoves(this),this.darkKing.isUnderCheck&&S(this,x,Z).call(this,this.darkKing)),this.lightKing&&(this.lightKing.legalMoves=this.lightKing.getLegalMoves(this),this.lightKing.isUnderCheck&&S(this,x,Z).call(this,this.lightKing)),this.darkCoverage.size===0&&(this.whoWon="light"),this.lightCoverage.size===0&&(this.whoWon="dark")},x=new WeakSet,Z=function(t){const e=t.shade==="dark"?this.darkCoverage:this.lightCoverage;this.pieces.forEach(s=>{s.shade===t.shade&&s.type!=="King"&&(s.myKingIsUnderCheck=!0,s.findMovesToProtectKing(this))}),e.clear(),this.pieces.forEach(s=>{s.shade===t.shade&&s.coverage.forEach(i=>{e.add(i)})})},I=new WeakSet,b=function(){const t=new Array(8);for(let e=0;e<t.length;e++)t[e]=new Array(8);for(let e=t.length-1;e>=0;e--)for(let s=0;s<t[e].length;s++)t[e][s]=new le((s+e)%2===1?"light":"dark",{rank:e,file:s});return t},F=new WeakSet,ee=function(t,e){return 0<=t&&t<this.board.length&&0<=e&&e<this.board[t].length};const X={canvasSize:900,canvasParent:"app"},Pe=n=>{const t=new Te;let e=null,s=!1,i=n.createInput(t.fen,"text");i.style("width","100%"),i.elt.onchange=()=>{const g=new URL(location.href);g.searchParams.set("fen",t.fen),history.replaceState("","",g)},n.setup=()=>{n.createCanvas(X.canvasSize,X.canvasSize).parent(X.canvasParent),n.background(0,0,0);const r=new URL(location.href).searchParams.get("fen");t.loadPieces(),r&&(t.fen=r),i.elt.value=t.fen,i.input(k=>{t.fen=k.target.value}),n.createButton("Reset FEN").mouseClicked(()=>{t.fen="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",i.elt.value=t.fen,i.elt.onchange()})};const o=(g,r=!1)=>{const u=n.width,k=n.height,y=8;let K=g.file*u/y,L=(g.rank+7-g.rank*2)*k/y;return r&&(K+=u/(y*2),L+=k/(y*2)),[K,L]},a=(g,r)=>{if(g.pos){let u,k;if(r)u=r.x,k=r.y;else{const[y,K]=o(g.pos,!0);u=y,k=K}n.push(),n.fill(0,0,255),n.textSize(50),n.textAlign(n.CENTER,n.CENTER),n.text(g.unicodeChar,u,k),n.pop()}},h=(g,r,u,k)=>{n.fill(...u),n.square(g,r,n.width/8),n.fill(255,0,0),n.text(`${k.file}${k.rank}`,g,r+n.height/8)},f=(g,r=h)=>{const[u,k]=o(g.pos),y=g.shade==="dark"?[0,0,0]:[255,255,255],{rank:K,file:L}=g.chessPosition;n.push(),n.noStroke(),r(u,k,y,{rank:K,file:L}),n.pop()},p=g=>{g.forEach(r=>{r&&f(r)}),e&&e.piece&&(f(e,(r,u)=>{n.fill(0,0,120,175),n.square(r,u,n.width/8)}),e.piece.legalMoves.forEach(r=>{f(r,(u,k)=>{n.fill(0,255,0,150),r.piece&&!r.piece.canBeEaten&&n.fill(255,0,0,150),n.square(u,k,n.width/8)})})),g.pieces.forEach(r=>{r===(e==null?void 0:e.piece)&&s?a(r,{x:n.mouseX,y:n.mouseY}):a(r)})},d=g=>{const[r,u]=o(g.pos);return[n.mouseX>=r&&n.mouseX<=r+n.width/8&&n.mouseY>=u&&n.mouseY<=u+n.height/8,r,u]},P=()=>{var g;(g=e==null?void 0:e.piece)==null||g.legalMoves.forEach(r=>{const[u]=d(r);u&&(t.movePiece(r.pos,e.piece),e=null)}),t.forEach(r=>{r&&d(r)[0]&&(e=r)}),i.elt.value=t.fen,i.elt.onchange()};n.mousePressed=()=>{switch(n.mouseButton){case n.LEFT:P();break}},n.mouseDragged=()=>{switch(n.mouseButton){case n.LEFT:e&&e.piece?s=!0:P();break}},n.mouseReleased=()=>{s=!1,e&&P()},n.draw=()=>{p(t)}};new Me(Pe);
